<!DOCTYPE html>
<html>
<head>
	<!--- Def jeu caracteres -->
	<meta charset="UTF-8" />
	<!--Titre-->
	<title>PlanteVet</title>
	<!--Favicon-->
	<link rel="icon" type="image/png" href="favicon.png">
	<!-- Page CSS -->
	<style>
		body {
			text-align: left;
			
			margin-top: 35px;
			margin-left: 35px;
			margin-bottom: 35px;
			margin-right: 35px;
		}
		.MatchResultClass:hover {
			color: red;
		}
		.tox.tox-tinymce {
			border-radius: 10px;
			border: 2px solid #3EB489; 
		}
		.tox.tox-tinymce.focused {
			border: 4px solid #3EB489; 
		}
		
		ul {
			margin-top: 0;
			margin-bottom: 0;
			margin-left: 15px;
		}
		p {
			margin-top: 0;
			margin-bottom: 0;
		}
		
		button {
		}
		.Product {
 			border: 0;
  			line-height: 2;
  			padding: 0 10px;
			background-color: #659EC7;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
			margin-bottom: 5px;
		}
		.Product:hover {
			background-color: #3090C7;
		}
		.Plant {
 			border: 0;
  			line-height: 2;
  			padding: 0 10px;
			background-color: #842DCE;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
			margin-bottom: 5px;
		}
		.Plant:hover {
			background-color: #342D7E;
		}
		.Species {
 			border: 0;
  			line-height: 2;
  			padding: 0 10px;
			background-color: #D462FF;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
			margin-bottom: 5px;
		}
		.Species:hover {
			background-color: #B93B8F;
		}
		.Fct {
 			border: 0;
  			line-height: 2;
  			padding: 0 10px;
			background-color: #FF69B4;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
			margin-bottom: 5px;
		}
		.Fct:hover {
			background-color: #E3319D;
		}
		.Tox {
 			border: 0;
  			line-height: 2;
  			padding: 0 10px;
			background-color: #C21E56;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
			margin-bottom: 5px;
		}
		.Tox:hover {
			background-color: #DC143C;
		}
		.Save:enabled {
 			border: 0;
  			line-height: 2.5;
  			padding: 0 20px;
			background-color: #3EB489;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		.Save:hover {
			background-color: #006A4E;
		}
		.Save:disabled {
 			border: 0;
  			line-height: 2.5;
  			padding: 0 20px;
			background-color: #7C9D8E;
			color: white;
			border-radius: 5px;
		}
		.Import {
 			border: 0;
  			line-height: 2.5;
  			padding: 0 20px;
			background-color: #3EB489;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		.Import:hover {
			background-color: #006A4E;
		}
		.Update {
 			border: 0;
  			line-height: 2.5;
  			padding: 0 20px;
			background-color: #3EB489;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		.Update:hover {
			background-color: #006A4E;
		}
		.Cancel {
 			border: 0;
  			line-height: 2.5;
  			padding: 0 20px;
			background-color: #F2A149;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		.Cancel:hover {
			background-color: #E08F38;
		}
		.Delete:enabled {
 			border: 0;
  			line-height: 2.5;
  			padding: 0 20px;
			background-color: #FF6347;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		.Delete:hover {
			background-color: #F70D1A;
		}
		.Delete:disabled {
 			border: 0;
  			line-height: 2.5;
  			padding: 0 20px;
			background-color: #CD5C5C;
			color: white;
			border-radius: 5px;
		}
		.Back {
 			border: 0;
  			line-height: 2.5;
  			padding: 0 20px;
			background-color: #3EB489;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		.Back:hover {
			background-color: #006A4E;
		}
		.New {
 			border: 0;
  			line-height: 2;
  			padding: 0 10px;
			background-color: #3EB489;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		.New:hover {
			background-color: #006A4E;
		}
		.append {
 			border: 0;
  			line-height: 2;
  			padding: 0 10px;
			background-color: #3EB489;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		.append:hover {
			background-color: #006A4E;
		}
		
		input::file-selector-button {
 			border: 0;
  			line-height: 2;
  			padding: 0 10px;
			background-color: #3EB489;
			color: white;
			border-radius: 5px;
			text-shadow: 1px 1px 1px black;
 			box-shadow: 
				inset 2px 2px 3px rgb(255 255 255 / 60%),
				inset -2px -2px 3px rgb(0 0 0 / 60%);
		}
		input::file-selector-button:hover {
			background-color: #006A4E;
		}

		td {
		}
		.species {
			text-align: left;
		}

		input[type=text] {
			border-radius: 5px;
			border: 2px solid #3EB489;
			padding-left: 10px;
			padding-right: 10px;
			padding-top: 5px;
			padding-bottom: 5px;
			margin-bottom: 5px;
			font-size: 14px;
		}
		input[type=text]:focus {
			outline: none;
			border: 4px solid #3EB489;
		}
		input[type=text]::placeholder {
			color: #DDDDDD;
		}

		select {
 			border: 1px solid black;
			background-color: #3EB489;
			color: white;
			height: 25px;
  			padding: 0 10px;
			border-radius: 5px;
			margin-bottom: 10px;
		}
		select:hover, select:focus {
			border: 2px solid black;
		}
		
		input[type="checkbox"]:not(:checked) {
			outline: 3px solid #3EB489;
			outline-radius: 5px;
		}
		input[type="checkbox"]:checked {
			outline: 3px solid #3EB489;
			outline-radius: 5px;
		}
	</style>
	
	<!-- Database interface script -->
	<!-- <script src="jswasm/sqlite3.js"></script>  -->
	<script src="jswasm/sqlite3_wasm.js"></script>
	<!-- Rich text interface text -->
	<script src="tinymce/js/tinymce/tinymce.min.js"></script>
	<!-- Application script -->
	<script>
		// Database schema for validation of imported database (cf. 'DemoDB_Reset.sql' file)
		globalThis.RefDatabaseSchema_Cte = ["CREATE TABLE LABO(Id integer primary key, Name text)",
												"CREATE TABLE GALENIQUE(Id integer primary key, Name text)",
												"CREATE TABLE CATEGORIE(Id integer primary key, Name text)",
												"CREATE TABLE ESPECE(Id integer primary key, Name text, IMG blob)",
												"CREATE TABLE PLANTE(Id integer primary key, Name text, Photo blob, Latin text, Famille text, Botanique blob, Molecules blob, PDyn blob, P1 text, P2 text, P3 text, PCin blob, Gestation blob, Surdosage blob, Sources blob, Interac blob, MAJ blob, Rchr int, Clin int, Reg int, RegEQ int, Dop int, Poso blob)",
												"CREATE TABLE USEPART(Id integer primary key, Name text)",
												"CREATE TABLE FCTS(Id integer primary key, Name text)",
												"CREATE TABLE USECASE(Id integer primary key, Name text, Fct integer not null, Syndrome bool, foreign key(Fct) references FCTS(Id))",
												"CREATE TABLE EFFET2(Id integer primary key, Name text)",
												"CREATE TABLE TOXICITE(Id integer primary key, Name text)",
												"CREATE TABLE CTRINDIC(Id integer primary key, Name text)",
												"CREATE TABLE PRODUCT(Id integer primary key, Name text, Photo blob, Galenique integer not null, Categorie integer not null, DMV bool, Labo integer not null, Proprietes blob, Precautions blob, MAJ blob, foreign key(Labo) references LABO(Id), foreign key(Galenique) references GALENIQUE(Id), foreign key(Categorie) references CATEGORIE(Id))",
												"CREATE TABLE PRODUCT_PLANTE(Product integer not null, Plante integer not null, UsePart integer not null, foreign key(Product) references PRODUCT(Id), foreign key(Plante) references PLANTE(Id),  foreign key(UsePart) references USEPART(Id))",
												"CREATE TABLE PRODUCT_FCTS(Id integer primary key, Product integer not null, Fct integer not null, foreign key(Product) references PRODUCT(Id), foreign key(Fct) references FCTS(Id))",
												"CREATE TABLE PRODUCT_FCTS2(Id integer primary key, Product integer not null, Fct integer not null, foreign key(Product) references PRODUCT(Id), foreign key(Fct) references FCTS(Id))",
												"CREATE TABLE PRODUCT_USECASE(Id integer primary key, Product integer not null, Usecase integer not null, foreign key(Product) references PRODUCT(Id), foreign key(Usecase) references USECASE(Id))",
												"CREATE TABLE PRODUCT_USECASE_PLANTE(Product_Usecase integer not null, Plante integer not null, foreign key(Product_Usecase) references PRODUCT_USECASE(Id), foreign key(Plante) references PLANTE(Id))",
												"CREATE TABLE PRODUCT_EFFET2(Product integer not null, Effet2 integer not null, foreign key(Product) references PRODUCT(Id), foreign key(Effet2) references EFFET2(Id))",
												"CREATE TABLE PRODUCT_TOXICITE(Product integer not null, Toxicite integer not null, foreign key(Product) references PRODUCT(Id), foreign key(Toxicite) references TOXICITE(Id))",
												"CREATE TABLE PRODUCT_CTRINDIC(Product integer not null, CtrIndic integer not null, foreign key(Product) references PRODUCT(Id), foreign key(CtrIndic) references CTRINDIC(Id))",
												"CREATE TABLE PRODUCT_POSO(Product integer not null, Espece integer not null, Posologie blob, TA blob, foreign key(Product) references PRODUCT(Id), foreign key(Espece) references ESPECE(Id))",
												"CREATE TABLE PLANTE_EFFET2(Plante integer not null, Effet2 integer not null, foreign key(Plante) references PLANTE(Id), foreign key(Effet2) references EFFET2(Id))",
												"CREATE TABLE PLANTE_CTRINDIC(Plante integer not null, CtrIndic integer not null, foreign key(Plante) references PLANTE(Id), foreign key(CtrIndic) references CTRINDIC(Id))",
												"CREATE TABLE PLANTE_USEPART(Plante integer not null, UsePart integer not null, foreign key(Plante) references PLANTE(Id), foreign key(UsePart) references USEPART(Id))",
												"CREATE TABLE PLANTE_FCTS(Id integer primary key, Plante integer not null, Fct integer not null, foreign key(Plante) references PLANTE(Id), foreign key(Fct) references FCTS(Id))",
												"CREATE TABLE PLANTE_USECASE(Id integer primary key, Plante integer not null, Usecase integer not null, foreign key(Plante) references PLANTE(Id), foreign key(Usecase) references USECASE(Id))",
												"CREATE TABLE PLANTE_ESPECE(Id integer primary key, Plante integer not null, EspeceId int, foreign key(Plante) references PLANTE(Id))"];

		// Reset sqlite3 and database info
		globalThis.WorkingDB = null;
		globalThis.sqlite3 = null;
		globalThis.WorkingDBName = null;
		// reset editor info
		// NOTA : ProductPlanteStateListObj array row is : PlanteId, PlanteName, FlgCurrentlyUsedByUsecase, FlgInCheckList
		globalThis.PrivateProductUsecasePlanteStateListObj = [];
		// NOTA : ProductFctStateListObj array row is : FctId, FctName, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivateProductFctStateListObj = [];
		// NOTA : ProductFct2StateListObj array row is : FctId, FctName, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivateProductFct2StateListObj = [];
		// NOTA : ProductUsecaseStateListObj array row is : UsecaseId, UsecaseName, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivateProductUsecaseStateListObj = [];
		// NOTA : ProductUsecasePlanteStateListObj array row is : UsecaseId, PlanteId, PlanteName, FlgCurrentlyUsedByUsecase, FlgInCheckList
		globalThis.PrivateProductUsecasePlanteStateListObj = [];
		// NOTA : ProductEffet2StateListObj array row is : Effet2Id, Effet2Name, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivateProductEffet2StateListObj = [];
		// NOTA : ProductToxiciteStateListObj array row is : ToxiciteId, ToxiciteName, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivateProductToxiciteStateListObj = [];
		// NOTA : ProductCtrIndicStateListObj array row is : CtrIndicId, CtrIndicName, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivateProductCtrIndicStateListObj = [];
		// NOTA : ProductPosoStateListObj array row is : EspeceName, EspeceId, FlgCurrentlyUsedByProduct
		globalThis.PrivateProductPosoStateListObj = [];
		// NOTA : PlanteEffet2StateListObj array row is : Effet2Id, Effet2Name, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivatePlanteEffet2StateListObj = [];
		// NOTA : PlanteCtrIndicStateListObj array row is : CtrIndicId, CtrIndicName, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivatePlanteCtrIndicStateListObj = [];
		// NOTA : PlanteUsePartStateListObj array row is : UsePartId, UsePartName, FlgCurrentlyUsedByProduct, FlgInCheckList
		globalThis.PrivatePlanteUsePartStateListObj = [];
		// NOTA : PlanteFctStateListObj array row is : FctId, FctName, FlgCurrentlyUsedByPlante, FlgInCheckList
		globalThis.PrivatePlanteFctStateListObj = [];
		// NOTA : PlanteUsecaseStateListObj array row is : UsecaseId, UsecaseName, FlgCurrentlyUsedByPlante, FlgInCheckList
		globalThis.PrivatePlanteUsecaseStateListObj = [];
		// NOTA : PlanteEspeceStateListObj array row is : EspeceId, EspeceName, FlgCurrentlyUsedByPlante
		globalThis.PrivatePlanteEspeceStateListObj = [];
		globalThis.PrivateWorkingEltId = 0;
		
		// associate Rich text to the specified textarea
		function ActivateRichTextOnTextArea(TextAreaNameTxt,InitHTMLRichText)
		{
			let TextAreaSelectorTxt = '#' + TextAreaNameTxt;
			
			// RichTextEditorObj = new tinymce.Editor(TextAreaNameTxt, {opts}, tinymce.EditorManager);
			// RichTextEditorObj.render();
			tinymce.init({
				selector: TextAreaSelectorTxt,
				height: 200,
				menubar: false,
				plugins: [
					'advlist lists charmap searchreplace paste table help autoresize'
				],
				autoresize_bottom_margin: 0,
				toolbar: 'undo | redo | ' +
					'bold italic underline ' +
					'forecolor backcolor | ' +
					'fontselect fontsizeselect formatselect | ' +
					'subscript superscript | ' +
					'alignleft aligncenter alignright alignjustify | ' +
					'bullist numlist | outdent indent | ' +
					'table | charmap | help',
				content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px };',
				setup: (RichTextEditorObj) => {
					RichTextEditorObj.on('init', (EventObj) => {
							console.log("MCE init done");
							EventObj.target.setContent(InitHTMLRichText);
					});
					//toggle focused state
					RichTextEditorObj.on('focus', (e) => {
					e.target.editorContainer.classList.toggle('focused');
					});
					RichTextEditorObj.on('blur', (e) => {
					e.target.editorContainer.classList.toggle('focused');
					});
				}
			});
			return;
		}
		
		// associate Rich text to the specified textarea
		function ActivateRichTextOnSmallTextArea(TextAreaNameTxt,InitHTMLRichText)
		{
			let TextAreaSelectorTxt = '#' + TextAreaNameTxt;
			
			// RichTextEditorObj = new tinymce.Editor(TextAreaNameTxt, {opts}, tinymce.EditorManager);
			// RichTextEditorObj.render();
			tinymce.init({
				selector: TextAreaSelectorTxt,
				width: 500,
				height: 100,
				menubar: false,
				plugins: [
					'advlist lists charmap searchreplace paste table help autoresize'
				],
				autoresize_bottom_margin: 0,
				toolbar: 'undo | redo | ' +
					'bold italic underline ' +
					'alignleft aligncenter alignright alignjustify | ',
				content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px };',
				setup: (RichTextEditorObj) => {
					RichTextEditorObj.on('init', (EventObj) => {
							console.log("MCE init done");
							EventObj.target.setContent(InitHTMLRichText);
					});
					//toggle focused state
					RichTextEditorObj.on('focus', (e) => {
					e.target.editorContainer.classList.toggle('focused');
					});
					RichTextEditorObj.on('blur', (e) => {
					e.target.editorContainer.classList.toggle('focused');
					});
				}
			});
			return;
		}
		
		// deactivate rich text on textarea
		function DeactivateRichTextOnTextArea(TextAreaNameTxt)
		{
			let TextAreaSelectorTxt = '#' + TextAreaNameTxt;

			tinymce.remove(TextAreaSelectorTxt);
			return;
		}

		// get rich text of a textarea in HTML format
		function GetRichTextContentAsHTML(TextAreaNameTxt)
		{
			let HTMLRichText = tinymce.get(TextAreaNameTxt).getContent();
			return HTMLRichText;
		}

		// set HTML as the rich text of a textarea
		function SetHTMLAsRichTextContent(TextAreaNameTxt,HTMLRichText)
		{
			tinymce.get(TextAreaNameTxt).setContent(HTMLRichText);
			return;
		}
		
		// Initialize sqlite3 interface
		function DoInitSqlite3Module()
		{
			document.getElementById("LoadingWasmInfo").innerHTML = "Loading SQLITE3 WASM module ...<br/>";
			globalThis.sqlite3InitModule().then((OpsResult) => {
				globalThis.sqlite3 = OpsResult;
				console.log("Success laoding SQLITE3 module");
				document.getElementById("LoadingWasmInfo").style.display = 'none';
				document.getElementById("DatabasePathForm").style.visibility = 'visible';			
			}).catch((OpsError) => {
				globalThis.sqlite3 = null;
				document.getElementById("LoadingWasmInfo").innerHTML = "Failled to load SQLITE3 module<br/>";
				alert("Failled to load SQLITE3 module");
			});			
			return;
		}
		
		// Read file
		function DoReadFileAsync(FileObj,ProgressBarObj)
		{
			let FileReaderObj = new FileReader();
			
			return new Promise((resolve,reject) => {
				// setup callbacks
				FileReaderObj.onprogress = (EventObj) => {
					ProgressBarObj.value = parseInt((100*EventObj.loaded)/EventObj.total);
					console.log("Progrees " + ProgressBarObj.value + "%");
				};
				FileReaderObj.onload = (EventObj) => {
					ProgressBarObj.value = 100;
					console.log("Success loading");
					resolve(EventObj.target.result);
				};
				FileReaderObj.onerror = () => {
					console.log("Some Error occured during load");
					reject(null);
				};
				// fire read ops
				FileReaderObj.readAsArrayBuffer(FileObj);			
			});
		}
		
		// read image as URL
		function DoReadImageFileAsURL(FileObj)
		{
			let FileReaderObj = new FileReader();
			
			return new Promise((resolve,reject) => {
				// setup callbacks
				FileReaderObj.onload = (EventObj) => {
					console.log("Success loading image");
					resolve(EventObj.target.result);
				};
				FileReaderObj.onerror = () => {
					console.log("Some Error occured during load image");
					reject(null);
				};
				// fire read ops
				FileReaderObj.readAsDataURL(FileObj);			
			});
		}
	
		// cast a buffer to an image URL data
		function CastBufferToImgURLData(ImageData)
		{
			// NOTA : fromCharCode() is limited in size so use an alternate method
			//let TmpByteStr = String.fromCharCode(...ImageData);	
			let TmpByteStr = Array.from(ImageData, (byte) =>
				String.fromCodePoint(byte),
			).join("");		
			let TmpDataURL = "data:image/*;base64," + btoa(TmpByteStr);
			return TmpDataURL;
		}
	
		// extract image data from URL data
		function CastImgURLDataToBuffer(DataURLtxt)
		{
			let TmpURLParts = DataURLtxt.split(",");
			let TmpByteStr = atob(TmpURLParts[TmpURLParts.length-1]);
			let SizeData = TmpByteStr.length;
			let TmpImageData = new Uint8Array(SizeData);
			for(let i = 0; i < SizeData; i++) TmpImageData[i] = TmpByteStr.charCodeAt(i);
			return TmpImageData;
		}

		// cast a buffer to rich text
		function CastBufferToRichText(RichTextData)
		{
			// NOTA : fromCharCode() is limited in size so use an alternate method
			//let TmpByteStr = String.fromCharCode(...RichTextData);
			let TmpByteStr = Array.from(RichTextData, (byte) =>
				String.fromCodePoint(byte),
			).join("");
			return TmpByteStr;
		}

		// cast rich text to buffer
		function CastRichTextToBuffer(RichTextStr)
		{
			let SizeData = RichTextStr.length;
			let TmpData = new Uint8Array(SizeData);
			for(let i = 0; i < SizeData; i++) TmpData[i] = RichTextStr.charCodeAt(i);
			return TmpData;
		}
		
		// validate Database schema		
		function IsDatabaseSchemaValid(SchemaInfoObj)
		{
			let NbSchemaTable = SchemaInfoObj.length;
		
			// nb table in database
			if(NbSchemaTable != globalThis.RefDatabaseSchema_Cte.length) return false;
			// check tables format
			for(let i = 0; i < NbSchemaTable; i++)
			{
				let TmpSchemaRow = SchemaInfoObj[i];
				let TmpTblFormat = TmpSchemaRow[4];
				if(TmpTblFormat != globalThis.RefDatabaseSchema_Cte[i]) return false;
			}
			return true;
		}

		// Import database
		// NOTA : this function does a fake upload
		function DoImportDatabase()
		{
			let ProgressBarObj = document.getElementById("DatabaseImportProgressBar");
			let ListFilePathObj = document.getElementById("DatabasePathBtn").files;
			let NbFile = ListFilePathObj.length;

			// check if a file was selected
			if(NbFile != 1)
			{
				alert("Select a database");
				return;
			}
			let FileObj = ListFilePathObj[0];
			
			// Load database
			document.getElementById("DatabasePathBtn").disabled = true;
			document.getElementById("DatabaseImportBtn").disabled = true;
			ProgressBarObj.value = 0;
			document.getElementById("DatabaseImportProgressTxt").innerHTML = 'Loading ...';
			document.getElementById("DatabaseImportProgress").style.visibility = 'visible';
			DoReadFileAsync(FileObj,ProgressBarObj).then((OpsResult) => {
				// get result
				let FileData = OpsResult;
				// feed sqlite3 with just loaded database
				document.getElementById("DatabaseImportProgressTxt").innerHTML = 'Parsing ...';
				try {
					let TmpData = globalThis.sqlite3.wasm.allocFromTypedArray(FileData);			
					globalThis.WorkingDB = new globalThis.sqlite3.oo1.DB();
					let RetCode = globalThis.sqlite3.capi.sqlite3_deserialize(globalThis.WorkingDB,
																			'main',
																			TmpData,
																			FileData.byteLength,
																			FileData.byteLength,
																			globalThis.sqlite3.capi.SQLITE_DESERIALIZE_FREEONCLOSE
																			|globalThis.sqlite3.capi.SQLITE_DESERIALIZE_RESIZEABLE);
					console.log("Deserialize status : " + RetCode);
					globalThis.WorkingDB.checkRc(RetCode);
					console.log("Deserialize OK");
					// try get database schema to validate its format
					console.log("Getting Database schema ...");
					let SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from sqlite_schema",
						rowMode: 'array',
					});
					console.log("DB schema : " + SQLRequestResultObj);
					if(!IsDatabaseSchemaValid(SQLRequestResultObj))
					{
						console.log("DB schema is invalid");
						alert("Database schema is invalid");
						if(globalThis.WorkingDB != null) globalThis.WorkingDB.close();
						globalThis.WorkingDB = null;
						document.getElementById("DatabasePathBtn").disabled = false;
						document.getElementById("DatabaseImportBtn").disabled = false;
						document.getElementById("DatabaseImportProgress").style.visibility = 'hidden';
						return;
					}
					console.log("DB schema is OK");
				} catch(ErrorObj) {
					console.log("Echec importing database");
					alert("Echec importing database");
					if(globalThis.WorkingDB != null) globalThis.WorkingDB.close();
					globalThis.WorkingDB = null;
					document.getElementById("DatabasePathBtn").disabled = false;
					document.getElementById("DatabaseImportBtn").disabled = false;
					document.getElementById("DatabaseImportProgress").style.visibility = 'hidden';
					return;
				}
				// save DB name (for export)
				globalThis.WorkingDBName = FileObj.name;				
				// disable import
				document.getElementById("DatabasePathForm").style.display = 'none';
				// activate edit
				//document.getElementById("DatabasePath").innerHTML = "Working with database : " + document.URL;
				document.getElementById("DatabasePath").innerHTML = "Working with database : " + ListFilePathObj[0].name;
				document.getElementById("DatabasePath").style.display = 'None';
				document.getElementById("DatabasePath").style.visibility = 'Hidden';
				document.getElementById("TableChoiceForm").style.visibility = 'visible';
				// enable/disable btn as needed
				if(IsLaboTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
			}).catch((OpsError) => {
				alert("Echec reading database");
				document.getElementById("DatabasePathBtn").disabled = false;
				document.getElementById("DatabaseImportBtn").disabled = false;
				document.getElementById("DatabaseImportProgress").style.visibility = 'hidden';
			});
			return;
		}
	
		// Export database
		// NOTA : this function does a fake download
		function DoExportDatabase()
		{
			let TmpByteArray = globalThis.sqlite3.capi.sqlite3_js_db_export(globalThis.WorkingDB);
			let TmpBlob = new Blob([TmpByteArray.buffer], {type:"application/x-sqlite3"});
			let TmpHyperlink = document.createElement('a');
			document.body.appendChild(TmpHyperlink);
			TmpHyperlink.href = window.URL.createObjectURL(TmpBlob);
			TmpHyperlink.download = (globalThis.WorkingDBName);
			TmpHyperlink.addEventListener('click',function() {
				setTimeout(function() {
					console.log("DB Export done");
					// cleanup
					window.URL.revokeObjectURL(TmpHyperlink.href);
					TmpHyperlink.remove();
					// notify done
					alert("Save done");
					// disable save db btn
					document.getElementById("SaveDBBtn").disabled = true;
				}, 500);
			});
			TmpHyperlink.click();
			return;
		}

		//Get date
		function TodayDate()
		{
			let Today = new Date();
			
			let Year = Today.getFullYear();
			let Month = Today.getMonth() + 1; //Month start at 0
			let Day = Today.getDate();
			
			if (Day < 10) Day = '0' + Day;
			if (Month < 10) Month = '0' + Month;
			
			let FormattedToday = Day + '/' + Month + '/' + Year;
			
			return FormattedToday;
		}

		// check if labo can be deleted (aka. if used by a product or not)
		function IsLaboUsedBySomeProduct(LaboId)
		{
			console.log("Doing is labo used SQL request ...");
			let LaboSQLRequestResultObj = [];
			try {
				LaboSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case labo when $a then 1 else null end) from PRODUCT",
					rowMode: 'array',
					bind: {$a: LaboId},
				});
				console.log("End of is labo used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is labo used SQL request");
			};			
			let NbResultRow = LaboSQLRequestResultObj.length;
			if(NbResultRow != 1) return false;
			// fetch info
			let TmpResultRow = LaboSQLRequestResultObj[0];
			let NbUsedCount = TmpResultRow[0];
			if(NbUsedCount == 0) return false;
			return true;
		}

		// check if Galenique can be deleted (aka. if used by a product or not)
		function IsGaleniqueUsedBySomeProduct(GaleniqueId)
		{
			console.log("Doing is Galenique used SQL request ...");
			let GaleniqueSQLRequestResultObj = [];
			try {
				GaleniqueSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Galenique when $a then 1 else null end) from PRODUCT",
					rowMode: 'array',
					bind: {$a: GaleniqueId},
				});
				console.log("End of is Galenique used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Galenique used SQL request");
			};			
			let NbResultRow = GaleniqueSQLRequestResultObj.length;
			if(NbResultRow != 1) return false;
			// fetch info
			let TmpResultRow = GaleniqueSQLRequestResultObj[0];
			let NbUsedCount = TmpResultRow[0];
			if(NbUsedCount == 0) return false;
			return true;
		}
		
		// check if Categorie can be deleted (aka. if used by a product or not)
		function IsCategorieUsedBySomeProduct(CategorieId)
		{
			console.log("Doing is Categorie used SQL request ...");
			let CategorieSQLRequestResultObj = [];
			try {
				CategorieSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Categorie when $a then 1 else null end) from PRODUCT",
					rowMode: 'array',
					bind: {$a: CategorieId},
				});
				console.log("End of is Categorie used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Categorie used SQL request");
			};			
			let NbResultRow = CategorieSQLRequestResultObj.length;
			if(NbResultRow != 1) return false;
			// fetch info
			let TmpResultRow = CategorieSQLRequestResultObj[0];
			let NbUsedCount = TmpResultRow[0];
			if(NbUsedCount == 0) return false;
			return true;
		}
		
		// check if Espece can be deleted (aka. if used by a product or not)
		function IsEspeceUsedBySomeProduct(EspeceId)
		{
			console.log("Doing is Espece used SQL request ...");
			let EspeceSQLRequestResultObj = [];
			try {
				EspeceSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case EspeceId when $a then 1 else null end) from PLANTE_ESPECE",
					rowMode: 'array',
					bind: {$a: EspeceId},
				});
				console.log("End of is Espece used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Espece used SQL request");
			};			
			let NbResultRow = EspeceSQLRequestResultObj.length;
			if(NbResultRow != 1) return false;
			// fetch info
			let TmpResultRow = EspeceSQLRequestResultObj[0];
			let NbUsedCount = TmpResultRow[0];
			if(NbUsedCount == 0) return false;
			return true;
		}
		
		// check if Fcts can be deleted (aka. if used by a product or not)
		function IsFctsUsedBySomeProduct(FctsId)
		{
			console.log("Doing is Fcts used SQL request ...");
			let FctsSQLRequestResultObj = [];
			try {
				FctsSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Fct when $a then 1 else null end) from PRODUCT_FCTS",
					rowMode: 'array',
					bind: {$a: FctsId},
				});
				console.log("End of is Fcts used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Fcts used SQL request");
			};
			console.log("Doing is Fcts2 used SQL request ...");
			let Fcts2SQLRequestResultObj = [];
			try {
				Fcts2SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Fct when $a then 1 else null end) from PRODUCT_FCTS2",
					rowMode: 'array',
					bind: {$a: FctsId},
				});
				console.log("End of is Fcts2 used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Fcts2 used SQL request");
			};
			console.log("Doing is Fcts plante used SQL request ...");
			let FctsPlSQLRequestResultObj = [];
			try {
				FctsPlSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Fct when $a then 1 else null end) from PLANTE_FCTS",
					rowMode: 'array',
					bind: {$a: FctsId},
				});
				console.log("End of is Fcts plante used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Fcts plante used SQL request");
			};
			
			let NbResultRow = FctsSQLRequestResultObj.length;
			let NbResultRow2 = Fcts2SQLRequestResultObj.length;
			let NbResultRow3 = FctsPlSQLRequestResultObj.length;
			if((NbResultRow != 1) && (NbResultRow2 != 1) && (NbResultRow3 != 1)) return false;
			
			// fetch info
			let NbUsedCount = 0;
			let NbUsedCount2 = 0;
			let NbUsedCount3 = 0;
			if(NbResultRow == 1)
			{
				let TmpResultRow = FctsSQLRequestResultObj[0];
				NbUsedCount = TmpResultRow[0];
			}
			if(NbResultRow2 == 1)
			{
				let TmpResultRow2 = Fcts2SQLRequestResultObj[0];
				NbUsedCount2 = TmpResultRow2[0];
			}
			if(NbResultRow3 == 1)
			{
				let TmpResultRow3 = FctsPlSQLRequestResultObj[0];
				NbUsedCount3 = TmpResultRow3[0];
			}
			//console.log("Nb = " + NbUsedCount + "; Nb2 = " + NbUsedCount2 + "; Nb3 = " + NbUsedCount3);
			if((NbUsedCount == 0) && (NbUsedCount2 == 0) && (NbUsedCount3 == 0)) return false;
			
			return true;
		}
		
		// check if usecase can be deleted (aka. if used by a product or not)
		function IsUsecaseUsedBySomeProduct(UsecaseId)
		{
			console.log("Doing is usecase used SQL request ...");
			let UsecaseSQLRequestResultObj = [];
			try {
				UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case usecase when $a then 1 else null end) from PRODUCT_USECASE",
					rowMode: 'array',
					bind: {$a: UsecaseId},
				});
				console.log("End of is usecase used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is usecase used SQL request");
			};
			
			console.log("Doing is usecase plante used SQL request ...");
			let UsecasePlSQLRequestResultObj = [];
			try {
				UsecasePlSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case usecase when $a then 1 else null end) from PLANTE_USECASE",
					rowMode: 'array',
					bind: {$a: UsecaseId},
				});
				console.log("End of is usecase plante used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is usecase plante used SQL request");
			};
			
			let NbResultRow = UsecaseSQLRequestResultObj.length;
			let NbResultRow2 = UsecasePlSQLRequestResultObj.length;
			if((NbResultRow != 1) && (NbResultRow2 != 1)) return false;
			
			// fetch info
			let NbUsedCount = 0;
			let NbUsedCount2 = 0;
			if(NbResultRow == 1)
			{
				let TmpResultRow = UsecaseSQLRequestResultObj[0];
				NbUsedCount = TmpResultRow[0];
			}
			if(NbResultRow2 == 1)
			{
				let TmpResultRow2 = UsecasePlSQLRequestResultObj[0];
				NbUsedCount2 = TmpResultRow2[0];
			}
			//console.log("Nb = " + NbUsedCount + "; Nb2 = " + NbUsedCount2);
			if((NbUsedCount == 0) && (NbUsedCount2 == 0)) return false;
			
			return true;
		}
		
		// check if Toxicite can be deleted (aka. if used by a product or not)
		function IsToxiciteUsedBySomeProduct(ToxiciteId)
		{
			console.log("Doing is Toxicite used SQL request ...");
			let ToxiciteSQLRequestResultObj = [];
			try {
				ToxiciteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Toxicite when $a then 1 else null end) from PRODUCT_TOXICITE",
					rowMode: 'array',
					bind: {$a: ToxiciteId},
				});
				console.log("End of is Toxicite used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Toxicite used SQL request");
			};			
			let NbResultRow = ToxiciteSQLRequestResultObj.length;
			if(NbResultRow != 1) return false;
			// fetch info
			let TmpResultRow = ToxiciteSQLRequestResultObj[0];
			let NbUsedCount = TmpResultRow[0];
			if(NbUsedCount == 0) return false;
			return true;
		}

		// check if Plante can be deleted (aka. if used by a product or not)
		function IsPlanteUsedBySomeProduct(PlanteId)
		{
			console.log("Doing is Plante used SQL request ...");
			let PlanteSQLRequestResultObj = [];
			try {
				PlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Plante when $a then 1 else null end) from PRODUCT_PLANTE",
					rowMode: 'array',
					bind: {$a: PlanteId},
				});
				console.log("End of is Plante used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Plante used SQL request");
			};			
			let NbResultRow = PlanteSQLRequestResultObj.length;
			if(NbResultRow != 1) return false;
			// fetch info
			let TmpResultRow = PlanteSQLRequestResultObj[0];
			let NbUsedCount = TmpResultRow[0];
			if(NbUsedCount == 0) return false;
			return true;
		}
		
		// check if Plante can be deleted (aka. if used by a usecase or not)
		function IsPlanteUsedBySomeUsecase(PlanteId)
		{
			console.log("Doing is Plante used SQL request ...");
			let PlanteSQLRequestResultObj = [];
			try {
				PlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Plante when $a then 1 else null end) from PRODUCT_USECASE_PLANTE",
					rowMode: 'array',
					bind: {$a: PlanteId},
				});
				console.log("End of is Plante used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Plante used SQL request");
			};			
			let NbResultRow = PlanteSQLRequestResultObj.length;
			if(NbResultRow != 1) return false;
			// fetch info
			let TmpResultRow = PlanteSQLRequestResultObj[0];
			let NbUsedCount = TmpResultRow[0];
			if(NbUsedCount == 0) return false;
			return true;
		}
		
		// check if UsePart can be deleted (aka. if used by a product or not)
		function IsUsePartUsedBySomeProduct(UsePartId)
		{
			console.log("Doing is UsePart used SQL request ...");
			let UsePartSQLRequestResultObj = [];
			try {
				UsePartSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case UsePart when $a then 1 else null end) from PRODUCT_PLANTE",
					rowMode: 'array',
					bind: {$a: UsePartId},
				});
				console.log("End of is UsePart used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is UsePart used SQL request");
			};
			
			console.log("Doing is UsePart plante used SQL request ...");
			let UsePartPlSQLRequestResultObj = [];
			try {
				UsePartPlSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case UsePart when $a then 1 else null end) from PLANTE_USEPART",
					rowMode: 'array',
					bind: {$a: UsePartId},
				});
				console.log("End of is UsePart plante used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is UsePart plante used SQL request");
			};
			
			let NbResultRow = UsePartSQLRequestResultObj.length;
			let NbResultRow2 = UsePartPlSQLRequestResultObj.length;
			if((NbResultRow != 1) && (NbResultRow2 != 1)) return false;
			
			// fetch info
			let NbUsedCount = 0;
			let NbUsedCount2 = 0;
			if(NbResultRow == 1)
			{
				let TmpResultRow = UsePartSQLRequestResultObj[0];
				NbUsedCount = TmpResultRow[0];
			}
			if(NbResultRow2 == 1)
			{
				let TmpResultRow2 = UsePartPlSQLRequestResultObj[0];
				NbUsedCount2 = TmpResultRow2[0];
			}
			//console.log("Nb = " + NbUsedCount + "; Nb2 = " + NbUsedCount2);
			if((NbUsedCount == 0) && (NbUsedCount2 == 0)) return false;
			
			return true;
		}
		
		// check if Effet2 can be deleted (aka. if used by a product or not)
		function IsEffet2UsedBySomeProduct(Effet2Id)
		{
			console.log("Doing is Effet2 used SQL request ...");
			let Effet2SQLRequestResultObj = [];
			try {
				Effet2SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Effet2 when $a then 1 else null end) from PRODUCT_EFFET2",
					rowMode: 'array',
					bind: {$a: Effet2Id},
				});
				console.log("End of is Effet2 used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Effet2 used SQL request");
			};
			
			console.log("Doing is Effet2 plante used SQL request ...");
			let Effet2PlSQLRequestResultObj = [];
			try {
				Effet2PlSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case Effet2 when $a then 1 else null end) from PLANTE_EFFET2",
					rowMode: 'array',
					bind: {$a: Effet2Id},
				});
				console.log("End of is Effet2 plante used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Effet2 plante used SQL request");
			};
			
			let NbResultRow = Effet2SQLRequestResultObj.length;
			let NbResultRow2 = Effet2PlSQLRequestResultObj.length;
			if((NbResultRow != 1) && (NbResultRow2 != 1)) return false;
			
			// fetch info
			let NbUsedCount = 0;
			let NbUsedCount2 = 0;
			if(NbResultRow == 1)
			{
				let TmpResultRow = Effet2SQLRequestResultObj[0];
				NbUsedCount = TmpResultRow[0];
			}
			if(NbResultRow2 == 1)
			{
				let TmpResultRow2 = Effet2PlSQLRequestResultObj[0];
				NbUsedCount2 = TmpResultRow2[0];
			}
			//console.log("Nb = " + NbUsedCount + "; Nb2 = " + NbUsedCount2);
			if((NbUsedCount == 0) && (NbUsedCount2 == 0)) return false;
			
			return true;
		}
		
		// check if CtrIndic can be deleted (aka. if used by a product or not)
		function IsCtrIndicUsedBySomeProduct(CtrIndicId)
		{
			console.log("Doing is CtrIndic used SQL request ...");
			let CtrIndicSQLRequestResultObj = [];
			try {
				CtrIndicSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case CtrIndic when $a then 1 else null end) from PRODUCT_CTRINDIC",
					rowMode: 'array',
					bind: {$a: CtrIndicId},
				});
				console.log("End of is CtrIndic used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is CtrIndic used SQL request");
			};
			
			
			console.log("Doing is CtrIndic plante used SQL request ...");
			let CtrIndicPlSQLRequestResultObj = [];
			try {
				CtrIndicPlSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(case CtrIndic when $a then 1 else null end) from PLANTE_CTRINDIC",
					rowMode: 'array',
					bind: {$a: CtrIndicId},
				});
				console.log("End of is CtrIndic plante used SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is CtrIndic plante used SQL request");
			};
			
			let NbResultRow = CtrIndicSQLRequestResultObj.length;
			let NbResultRow2 = CtrIndicPlSQLRequestResultObj.length;
			if((NbResultRow != 1) && (NbResultRow2 != 1)) return false;
			
			// fetch info
			let NbUsedCount = 0;
			let NbUsedCount2 = 0;
			if(NbResultRow == 1)
			{
				let TmpResultRow = CtrIndicSQLRequestResultObj[0];
				NbUsedCount = TmpResultRow[0];
			}
			if(NbResultRow2 == 1)
			{
				let TmpResultRow2 = CtrIndicPlSQLRequestResultObj[0];
				NbUsedCount2 = TmpResultRow2[0];
			}
			//console.log("Nb = " + NbUsedCount + "; Nb2 = " + NbUsedCount2);
			if((NbUsedCount == 0) && (NbUsedCount2 == 0)) return false;
			
			return true;
		}
		
		// check if labo exist (aka. if labo can be edited)
		function IsLaboTblEmpty()
		{
			console.log("Doing is labo empty SQL request ...");
			let LaboSQLRequestResultObj = [];
			try {
				LaboSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(*) from LABO",
					rowMode: 'array',
				});
				console.log("End of is labo empty SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is labo empty SQL request");
			};			
			let NbResultRow = LaboSQLRequestResultObj.length;
			if(NbResultRow != 1) return true;
			// fetch info
			let TmpResultRow = LaboSQLRequestResultObj[0];
			let NbCount = TmpResultRow[0];
			if(NbCount == 0) return true;
			return false;
		}

		// check if Galenique exist (aka. if galenique can be edited)
		function IsGaleniqueTblEmpty()
		{
			console.log("Doing is Galenique empty SQL request ...");
			let GaleniqueSQLRequestResultObj = [];
			try {
				GaleniqueSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(*) from Galenique",
					rowMode: 'array',
				});
				console.log("End of is Galenique empty SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Galenique empty SQL request");
			};			
			let NbResultRow = GaleniqueSQLRequestResultObj.length;
			if(NbResultRow != 1) return true;
			// fetch info
			let TmpResultRow = GaleniqueSQLRequestResultObj[0];
			let NbCount = TmpResultRow[0];
			if(NbCount == 0) return true;
			return false;
		}
		
		// check if Categorie exist (aka. if categorie can be edited)
		function IsCategorieTblEmpty()
		{
			console.log("Doing is Categorie empty SQL request ...");
			let CategorieSQLRequestResultObj = [];
			try {
				CategorieSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(*) from Categorie",
					rowMode: 'array',
				});
				console.log("End of is Categorie empty SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Categorie empty SQL request");
			};			
			let NbResultRow = CategorieSQLRequestResultObj.length;
			if(NbResultRow != 1) return true;
			// fetch info
			let TmpResultRow = CategorieSQLRequestResultObj[0];
			let NbCount = TmpResultRow[0];
			if(NbCount == 0) return true;
			return false;
		}
		
		// check if Espece exist (aka. if Espece can be edited)
		function IsEspeceTblEmpty()
		{
			console.log("Doing is Espece empty SQL request ...");
			let EspeceSQLRequestResultObj = [];
			try {
				EspeceSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(*) from ESPECE",
					rowMode: 'array',
				});
				console.log("End of is Espece empty SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Espece empty SQL request");
			};			
			let NbResultRow = EspeceSQLRequestResultObj.length;
			if(NbResultRow != 1) return true;
			// fetch info
			let TmpResultRow = EspeceSQLRequestResultObj[0];
			let NbCount = TmpResultRow[0];
			if(NbCount == 0) return true;
			return false;
		}
		
		// check if Plante exist (aka. if product can be edited)
		function IsPlanteTblEmpty()
		{
			console.log("Doing is Plante empty SQL request ...");
			let PlanteSQLRequestResultObj = [];
			try {
				PlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(*) from Plante",
					rowMode: 'array',
				});
				console.log("End of is Plante empty SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Plante empty SQL request");
			};			
			let NbResultRow = PlanteSQLRequestResultObj.length;
			if(NbResultRow != 1) return true;
			// fetch info
			let TmpResultRow = PlanteSQLRequestResultObj[0];
			let NbCount = TmpResultRow[0];
			if(NbCount == 0) return true;
			return false;
		}
		
		// check if UsePart exist (aka. if usepart can be edited)
		function IsUsePartTblEmpty()
		{
			console.log("Doing is UsePart empty SQL request ...");
			let UsePartSQLRequestResultObj = [];
			try {
				UsePartSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(*) from UsePart",
					rowMode: 'array',
				});
				console.log("End of is UsePart empty SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is UsePart empty SQL request");
			};			
			let NbResultRow = UsePartSQLRequestResultObj.length;
			if(NbResultRow != 1) return true;
			// fetch info
			let TmpResultRow = UsePartSQLRequestResultObj[0];
			let NbCount = TmpResultRow[0];
			if(NbCount == 0) return true;
			return false;
		}
		
		// check if Fcts exist (aka. if fcts can be edited)
		function IsFctsTblEmpty()
		{
			console.log("Doing is Fcts empty SQL request ...");
			let FctsSQLRequestResultObj = [];
			try {
				FctsSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select count(*) from Fcts",
					rowMode: 'array',
				});
				console.log("End of is Fcts empty SQL request.");
			} catch(ErrorObj) {
				console.log("Echec is Fcts empty SQL request");
			};			
			let NbResultRow = FctsSQLRequestResultObj.length;
			if(NbResultRow != 1) return true;
			// fetch info
			let TmpResultRow = FctsSQLRequestResultObj[0];
			let NbCount = TmpResultRow[0];
			if(NbCount == 0) return true;
			return false;
		}
		
		// delete product
		function GoDeleteProduct(ProductId)
		{
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this product ?")) return;
				// delete entry
				console.log("Doing delete product SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from PRODUCT where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete product SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete product SQL request");
					alert("Delete product failled");
					return;
				};
				// delete product usecase list
				console.log("Doing delete product usecase SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from PRODUCT_USECASE where Product = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete usecase product SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete usecase product SQL request");
					alert("Delete product usecase failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
			}		
			// back to select row
			DoEditProductTable();
			return;
		}

		// update product
		function GoUpdateProduct(ProductId)
		{
			let OldPrivateWorkingEltId = globalThis.PrivateWorkingEltId;
		
			// fecth value to save
			let ProductNameTxt = document.getElementById("EltNameInput").value;
			let ProductPhotoBlob = CastImgURLDataToBuffer(document.getElementById("ProductPhotoView").src);
			let GaleniqueId = document.getElementById("GaleniqueInputCombo").value;
			let CategorieId = document.getElementById("CategorieInputCombo").value;
			let DMVId = false;
			if(document.getElementById("DMV1").checked) DMVId = true;
			let LaboId = document.getElementById("LaboInputCombo").value;
			let ProductProprietesBlob = CastRichTextToBuffer(GetRichTextContentAsHTML("ProductProprietesInput"));
			let ProductPrecautionsBlob = CastRichTextToBuffer(GetRichTextContentAsHTML("ProductPrecautionsInput"));
			let Today = CastRichTextToBuffer(TodayDate());
			
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert product SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into PRODUCT values(null, $a, $b, $c, $d, $e, $f, $g, $h, $i) returning Id",
						rowMode: 'array',
						bind: {$a: ProductNameTxt, $b: ProductPhotoBlob, $c: GaleniqueId, $d: CategorieId, $e: DMVId, $f: LaboId, $g: ProductProprietesBlob, $h: ProductPrecautionsBlob, $i: Today},
					});
					console.log("End of insert product SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert product SQL request");
					alert("Insert product failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted product Id = " + globalThis.PrivateWorkingEltId);
			}
			else
			{
				// do update
				console.log("Doing update product SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update PRODUCT set Name = $a, Photo = $b, Galenique = $c, Categorie = $d, DMV = $e, Labo = $f, Proprietes = $g, Precautions = $h where Id = $i",
						rowMode: 'array',
						bind: {$a: ProductNameTxt, $b: ProductPhotoBlob, $c: GaleniqueId, $d: CategorieId, $e: DMVId, $f: LaboId, $g: ProductProprietesBlob, $h: ProductPrecautionsBlob, $i: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update product SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update product SQL request");
					alert("Update failed");
					return;
				};
			}
			
			// update product Plantes
			// NOTA : ProductPlanteStateListObj array row is : PlanteId, PlanteName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbPlante = globalThis.PrivateProductPlanteStateListObj.length;
			for(let i = 0; i < NbPlante; i++)
			{
				let ProductPlanteStateObj = globalThis.PrivateProductPlanteStateListObj[i];
				
				// check if in check list
				if(ProductPlanteStateObj.FlgInCheckList)
				{
					// get check state
					let PlanteId = ProductPlanteStateObj.PlanteId;
					let FlgPlanteChecked = document.getElementById("PlanteCheckListId_" + PlanteId).checked;
					// check if this Plante is removed from list of product Plante or added to
					if(ProductPlanteStateObj.FlgCurrentlyUsedByProduct && (!FlgPlanteChecked))
					{
						// HERE : this Plante is to be removed form list of product Plante
						console.log("Doing delete product Plante SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PRODUCT_PLANTE where Product = $a and Plante = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: PlanteId},
							});
							console.log("End of delete Plante product SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete Plante product SQL request");
							alert("Delete product Plante failled");
							return;
						};
						// update state
						ProductPlanteStateObj.FlgCurrentlyUsedByProduct = false;
					}
					else if((!ProductPlanteStateObj.FlgCurrentlyUsedByProduct) && FlgPlanteChecked)
					{
						let UsePartId = document.getElementById("UsePartInputCombo_" + PlanteId).value;
						// HERE : this Plante is to be added form list of product Plante
						console.log("Doing insert product Plante SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PRODUCT_PLANTE values($a, $b, $c)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: PlanteId, $c: UsePartId},
							});
							console.log("End of insert product Plante SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert product Plante SQL request");
							alert("Insert product Plante failled");
							return;
						};
						// update state
						ProductPlanteStateObj.FlgCurrentlyUsedByProduct = true;
					}
					else
					{
						let UsePartId = document.getElementById("UsePartInputCombo_" + PlanteId).value;
						// do update
						console.log("Doing update product plantes info SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "update PRODUCT_PLANTE set UsePart = $a where Product = $b and Plante = $c",
								rowMode: 'array',
								bind: {$a: UsePartId, $b: globalThis.PrivateWorkingEltId, $c: PlanteId},
							});
							console.log("End of update product plante info SQL request.");
						} catch(ErrorObj) {
							console.log("Echec update product plante info SQL request");
							alert("Update failed");
							return;
						};
					}
				}
			}
			
			// update product usecase
			// NOTA : ProductUsecaseStateListObj array row is : UsecaseId, UsecaseName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbUsecase = globalThis.PrivateProductUsecaseStateListObj.length;
			for(let i = 0; i < NbUsecase; i++)
			{
				let ProductUsecaseStateObj = globalThis.PrivateProductUsecaseStateListObj[i];
				
				// check if in check list
				if(ProductUsecaseStateObj.FlgInCheckList)
				{
					// get check state
					let UsecaseId = ProductUsecaseStateObj.UsecaseId;
					let FlgChecked = document.getElementById("UsecaseCheckListId_" + UsecaseId).checked;
					
					// check if this usecase is removed from list of product usecase or added to
					if(ProductUsecaseStateObj.FlgCurrentlyUsedByProduct && (!FlgChecked))
					{
						//fetch product usecase Id
						let ProductUsecasesSQLRequestResultObj = [];
						console.log("Start of product usecases SQL request.");
						try {
							ProductUsecasesSQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "select Id from PRODUCT_USECASE where Product = $a and Usecase = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
							});
							console.log("End of product usecases SQL request.");
						} catch(ErrorObj) {
							console.log("Echec product usecases SQL request");
						};
						let Product_UsecaseId = ProductUsecasesSQLRequestResultObj[0][0];
						
						// HERE : this usecase is to be removed form list of product usecase
						console.log("Doing delete product usecase SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PRODUCT_USECASE where Product = $a and Usecase = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
							});
							console.log("End of delete usecase product SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete usecase product SQL request");
							alert("Delete product usecase failled");
							return;
						};
						// update state
						ProductUsecaseStateObj.FlgCurrentlyUsedByProduct = false;
						
						//NOW: retirer les plantes associes
						console.log("Doing delete product usecase plantes SQL request ...");						
						//deletion
						console.log("Doing delete product usecase plante SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PRODUCT_USECASE_PLANTE where Product_Usecase = $a",
								rowMode: 'array',
								bind: {$a: Product_UsecaseId},
							});
							console.log("End of delete product usecase plante SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete product usecase SQL request");
							alert("Delete product usecase failled");
							return;
						};
						
						//update state
						let ProductUsecasePlanteListStateObj = globalThis.PrivateProductUsecasePlanteStateListObj;
						let NEWProductUsecasePlanteListStateObj = [];
						let ListLength = ProductUsecasePlanteListStateObj.length;
						for(let j = 0; j < ListLength; j++)
						{
							let ProductUsecasePlanteStateObj = ProductUsecasePlanteListStateObj[j];
							if(ProductUsecasePlanteStateObj.UsecaseId != UsecaseId)
							{
								NEWProductUsecasePlanteListStateObj.push(ProductUsecasePlanteStateObj);
							}
						}
						globalThis.PrivateProductUsecasePlanteStateListObj = NEWProductUsecasePlanteListStateObj;
					}
					else if((!ProductUsecaseStateObj.FlgCurrentlyUsedByProduct) && FlgChecked)
					{
						// HERE : this usecase is to be added form list of product usecase
						console.log("Doing insert product usecase SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PRODUCT_USECASE values(null,$a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
							});
							console.log("End of insert product usecase SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert product usecase SQL request");
							alert("Insert product usecase failled");
							return;
						};
						// update state
						ProductUsecaseStateObj.FlgCurrentlyUsedByProduct = true;
						
						//NOW: ajouter les plantes associes
						console.log("Doing insert product usecase plantes SQL request ...");
						
						//fetch product usecase Id
						let ProductUsecasesSQLRequestResultObj = [];
						console.log("Start of product usecases SQL request.");
						try {
							ProductUsecasesSQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "select Id from PRODUCT_USECASE where Product = $a and Usecase = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
							});
							console.log("End of product usecases SQL request.");
						} catch(ErrorObj) {
							console.log("Echec product usecases SQL request");
						};
						let Product_UsecaseId = ProductUsecasesSQLRequestResultObj[0][0];
						
						let ProductUsecasePlanteStateListObj = globalThis.PrivateProductUsecasePlanteStateListObj;
						for(let j = 0; j < ProductUsecasePlanteStateListObj.length; j++)
						{
							let UsecasePlanteStateListObj = ProductUsecasePlanteStateListObj[j];
							if(UsecasePlanteStateListObj.UsecaseId == UsecaseId)
							{
								let PlanteId = UsecasePlanteStateListObj.PlanteId;
								//check if in checklist
								if(UsecasePlanteStateListObj.FlgInCheckList)
								{
									let FlgChecked = document.getElementById("PlanteCheckListId_" + UsecaseId + "_" + PlanteId).checked;
									if(FlgChecked)
									{
										let SQLRequestPlanteResultObj = [];
										try {
											SQLRequestPlanteResultObj = globalThis.WorkingDB.exec({
												sql: "insert into PRODUCT_USECASE_PLANTE values($a, $b)",
												rowMode: 'array',
												bind: {$a: Product_UsecaseId, $b: PlanteId},
											});
											console.log("End of insert product usecase plante SQL request.");
										} catch(ErrorObj) {
											console.log("Echec insert product usecase plante SQL request");
											alert("Insert product usecase plante failled");
											return;
										};
										// update state
										UsecasePlanteStateListObj.FlgCurrentlyUsedByUsecase = true;
									}
								}
							}
						}
					}
					
					else
					{
						//HERE: Usecase unchanged
						//update product usecase plante
						
						//fetch product usecase Id
						let ProductUsecasesSQLRequestResultObj = [];
						console.log("Start of product usecases SQL request.");
						try {
							ProductUsecasesSQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "select Id from PRODUCT_USECASE where Product = $a and Usecase = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
							});
							console.log("End of product usecases SQL request.");
						} catch(ErrorObj) {
							console.log("Echec product usecases SQL request");
						};
						let Product_UsecaseId = ProductUsecasesSQLRequestResultObj[0][0];
						
						//get list usecase plantes
						let ProductUsecasePlanteStateListObj = globalThis.PrivateProductUsecasePlanteStateListObj;
						let FullListLength = ProductUsecasePlanteStateListObj.length;
						let UsecasePlanteStateListObj = [];
						for(let j = 0; j < FullListLength; j++)
						{
							if(ProductUsecasePlanteStateListObj[j].UsecaseId == UsecaseId)
							{
								UsecasePlanteStateListObj.push(ProductUsecasePlanteStateListObj[j]);
							}
						}
						
						//update
						let NbPlante = UsecasePlanteStateListObj.length;
						for(let j = 0; j < NbPlante; j++)
						{
							let PlanteStateObj = UsecasePlanteStateListObj[j];
							
							//check if in checklist
							if(PlanteStateObj.FlgInCheckList)
							{
								//get check state
								let PlanteId = PlanteStateObj.PlanteId;
								let FlgChecked = document.getElementById("PlanteCheckListId_" + UsecaseId + "_" + PlanteId).checked;
								// check if this plante is to be removed from list of usecase or added to
								if(PlanteStateObj.FlgCurrentlyUsedByUsecase && (!FlgChecked))
								{
									// HERE : this plante is to be removed form list of usecase
									console.log("Doing delete product usecase plante SQL request ...");
									try {
										globalThis.WorkingDB.exec({
											sql: "delete from PRODUCT_USECASE_PLANTE where Product_Usecase = $a and Plante = $b",
											rowMode: 'array',
											bind: {$a: Product_UsecaseId, $b: PlanteId},
										});
										console.log("End of delete product usecase plante SQL request.");
									} catch(ErrorObj) {
										console.log("Echec delete product usecase plante SQL request");
										alert("Delete product usecase plante failed");
										return;
									};
									// update state
									PlanteStateObj.FlgCurrentlyUsedByUsecase = false;
								}
								else if((!PlanteStateObj.FlgCurrentlyUsedByUsecase) && FlgChecked)
								{
									// HERE : this plante is to be added form list of product usecase
									console.log("Doing insert product usecase plante SQL request ...");
									let SQLRequestResultObj = [];
									try {
										SQLRequestResultObj = globalThis.WorkingDB.exec({
											sql: "insert into PRODUCT_USECASE_PLANTE values($a, $b)",
											rowMode: 'array',
											bind: {$a: Product_UsecaseId, $b: PlanteId},
										});
										console.log("End of insert product usecase plante SQL request.");
									} catch(ErrorObj) {
										console.log("Echec insert product usecase plante SQL request");
										alert("Insert product usecase plante failed");
										return;
									};
									// update state
									PlanteStateObj.FlgCurrentlyUsedByUsecase = true;
								}
							}
						}
					}
				}
			}
			
			//update product Fcts
			// NOTA : ProductFctStateListObj array row is : FctId, FctName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbFct = globalThis.PrivateProductFctStateListObj.length;
			for(let i = 0; i < NbFct; i++)
			{
				let ProductFctStateObj = globalThis.PrivateProductFctStateListObj[i];
				
				// check if in check list
				if(ProductFctStateObj.FlgInCheckList)
				{
					// get check state
					let FctId = ProductFctStateObj.FctId;
					let FlgFctChecked = document.getElementById("FctCheckListId_" + FctId).checked;
					
					// check if this fct is removed from list of product fct or added to
					if(ProductFctStateObj.FlgCurrentlyUsedByProduct && (!FlgFctChecked))
					{
						// HERE : this Fct is to be removed form list of product Fct
						console.log("Doing delete product Fct SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PRODUCT_FCTS where Product = $a and Fct = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: FctId},
							});
							console.log("End of delete Fct product SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete Fct product SQL request");
							alert("Delete product Fct failled");
							return;
						};
						// update state
						ProductFctStateObj.FlgCurrentlyUsedByProduct = false;
						
						//NOW: retirer usecase et plantes associes
						// fetch all usecase linked to fct
						console.log("Doing list usecase SQL request ...");
						let UsecaseSQLRequestResultObj = [];
						try {
							UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "select Id from USECASE where Fct = $a",
								rowMode: 'array',
								bind: {$a: FctId},
							});
							console.log("End of list usecase SQL request.");
						} catch(ErrorObj) {
							console.log("Echec list usecase SQL request");
						};
						
						let NbUsecases = UsecaseSQLRequestResultObj.length;
						for(let j=0; j < NbUsecases; j++)
						{
							let UsecaseId = UsecaseSQLRequestResultObj[j][0];
							
							let ProductUsecaseStateObj = [];
							for(let k=0; k < globalThis.PrivateProductUsecaseStateListObj.length; k++)
							{
								ProductUsecaseStateObj = globalThis.PrivateProductUsecaseStateListObj[k];
								if(ProductUsecaseStateObj.UsecaseId == UsecaseId) break;
							}
							
							if(ProductUsecaseStateObj.FlgCurrentlyUsedByProduct)
							{							
								//fetch product usecase Id
								let ProductUsecasesSQLRequestResultObj = [];
								console.log("Start of product usecases SQL request.");
								try {
									ProductUsecasesSQLRequestResultObj = globalThis.WorkingDB.exec({
										sql: "select Id from PRODUCT_USECASE where Product = $a and Usecase = $b",
										rowMode: 'array',
										bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
									});
									console.log("End of product usecases SQL request.");
								} catch(ErrorObj) {
									console.log("Echec product usecases SQL request");
								};
								let Product_UsecaseId = ProductUsecasesSQLRequestResultObj[0][0];
								
								// HERE : this usecase is to be removed form list of product usecase
								console.log("Doing delete product usecase SQL request ...");
								try {
									globalThis.WorkingDB.exec({
										sql: "delete from PRODUCT_USECASE where Product = $a and Usecase = $b",
										rowMode: 'array',
										bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
									});
									console.log("End of delete usecase product SQL request.");
								} catch(ErrorObj) {
									console.log("Echec delete usecase product SQL request");
									alert("Delete product usecase failled");
									return;
								};
								// update state
								let TmpUsecaseIdx = 0;
								let NbUsecases = globalThis.PrivateProductUsecaseStateListObj.length;
								for(let k=0; k < NbUsecases; k++)
								{
									if(globalThis.PrivateProductUsecaseStateListObj[k].UsecaseId == UsecaseId)
									{
										TmpUsecaseIdx = k;
									}
								}
								let ProductUsecaseStateObj = globalThis.PrivateProductUsecaseStateListObj[TmpUsecaseIdx];
								ProductUsecaseStateObj.FlgCurrentlyUsedByProduct = false;
								
								//NOW: retirer les plantes associes
								console.log("Doing delete product usecase plantes SQL request ...");						
								//deletion
								console.log("Doing delete product usecase plante SQL request ...");
								try {
									globalThis.WorkingDB.exec({
										sql: "delete from PRODUCT_USECASE_PLANTE where Product_Usecase = $a",
										rowMode: 'array',
										bind: {$a: Product_UsecaseId},
									});
									console.log("End of delete product usecase plante SQL request.");
								} catch(ErrorObj) {
									console.log("Echec delete product usecase plante SQL request");
									alert("Delete product usecase plante failed");
									return;
								};
								
								//update state
								let ProductUsecasePlanteListStateObj = globalThis.PrivateProductUsecasePlanteStateListObj;
								let NEWProductUsecasePlanteListStateObj = [];
								let ListLength = ProductUsecasePlanteListStateObj.length;
								for(let k=0; k < ListLength; k++)
								{
									let ProductUsecasePlanteStateObj = ProductUsecasePlanteListStateObj[k];
									if(ProductUsecasePlanteStateObj.UsecaseId != UsecaseId)
									{
										NEWProductUsecasePlanteListStateObj.push(ProductUsecasePlanteStateObj);
									}
								}
								globalThis.PrivateProductUsecasePlanteStateListObj = NEWProductUsecasePlanteListStateObj;
							}
						}
					}
					else if((!ProductFctStateObj.FlgCurrentlyUsedByProduct) && FlgFctChecked)
					{
						// HERE : this Fct is to be added form list of product Fct
						console.log("Doing insert product Fct SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PRODUCT_FCTS values(null, $a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: FctId},
							});
							console.log("End of insert product Fct SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert product Fct SQL request");
							alert("Insert product Fct failled");
							return;
						};
						// update state
						ProductFctStateObj.FlgCurrentlyUsedByProduct = true;
					}
				}
			}
			
			//update product Fcts2
			// NOTA : ProductFct2StateListObj array row is : FctId, FctName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbFct2 = globalThis.PrivateProductFct2StateListObj.length;
			for(let i = 0; i < NbFct2; i++)
			{
				let ProductFct2StateObj = globalThis.PrivateProductFct2StateListObj[i];
				
				// check if in check list
				if(ProductFct2StateObj.FlgInCheckList)
				{
					// get check state
					let Fct2Id = ProductFct2StateObj.FctId;
					let FlgFct2Checked = document.getElementById("Fct2CheckListId_" + Fct2Id).checked;
					
					// check if this fct is removed from list of product fct or added to
					if(ProductFct2StateObj.FlgCurrentlyUsedByProduct && (!FlgFct2Checked))
					{
						// HERE : this Fct2 is to be removed form list of product Fct
						console.log("Doing delete product Fct2 SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PRODUCT_FCTS2 where Product = $a and Fct = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: Fct2Id},
							});
							console.log("End of delete Fct2 product SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete Fct2 product SQL request");
							alert("Delete product Fct2 failed");
							return;
						};
						// update state
						ProductFct2StateObj.FlgCurrentlyUsedByProduct = false;
						
						//NOW: retirer usecase et plantes associes
						// fetch all usecase linked to fct
						console.log("Doing list usecase SQL request ...");
						let UsecaseSQLRequestResultObj = [];
						try {
							UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "select Id from USECASE where Fct = $a",
								rowMode: 'array',
								bind: {$a: Fct2Id},
							});
							console.log("End of list usecase SQL request.");
						} catch(ErrorObj) {
							console.log("Echec list usecase SQL request");
						};
						
						let NbUsecases = UsecaseSQLRequestResultObj.length;
						for(let j=0; j < NbUsecases; j++)
						{
							let UsecaseId = UsecaseSQLRequestResultObj[j][0];
							
							let ProductUsecaseStateObj = [];
							for(let k=0; k < globalThis.PrivateProductUsecaseStateListObj.length; k++)
							{
								ProductUsecaseStateObj = globalThis.PrivateProductUsecaseStateListObj[k];
								if(ProductUsecaseStateObj.UsecaseId == UsecaseId) break;
							}
							
							if(ProductUsecaseStateObj.FlgCurrentlyUsedByProduct)
							{
								//fetch product usecase Id
								let ProductUsecasesSQLRequestResultObj = [];
								console.log("Start of product usecases SQL request.");
								try {
									ProductUsecasesSQLRequestResultObj = globalThis.WorkingDB.exec({
										sql: "select Id from PRODUCT_USECASE where Product = $a and Usecase = $b",
										rowMode: 'array',
										bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
									});
									console.log("End of product usecases SQL request.");
								} catch(ErrorObj) {
									console.log("Echec product usecases SQL request");
								};
								let Product_UsecaseId = ProductUsecasesSQLRequestResultObj[0][0];
								
								// HERE : this usecase is to be removed form list of product usecase
								console.log("Doing delete product usecase SQL request ...");
								try {
									globalThis.WorkingDB.exec({
										sql: "delete from PRODUCT_USECASE where Product = $a and Usecase = $b",
										rowMode: 'array',
										bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
									});
									console.log("End of delete usecase product SQL request.");
								} catch(ErrorObj) {
									console.log("Echec delete usecase product SQL request");
									alert("Delete product usecase failled");
									return;
								};
								// update state
								let TmpUsecaseIdx = 0;
								let NbUsecases = globalThis.PrivateProductUsecaseStateListObj.length;
								for(let k=0; k < NbUsecases; k++)
								{
									if(globalThis.PrivateProductUsecaseStateListObj[k].UsecaseId == UsecaseId)
									{
										TmpUsecaseIdx = k;
									}
								}
								let ProductUsecaseStateObj = globalThis.PrivateProductUsecaseStateListObj[TmpUsecaseIdx];
								ProductUsecaseStateObj.FlgCurrentlyUsedByProduct = false;
								
								//NOW: retirer les plantes associes
								console.log("Doing delete product usecase plantes SQL request ...");						
								//deletion
								console.log("Doing delete product usecase plante SQL request ...");
								try {
									globalThis.WorkingDB.exec({
										sql: "delete from PRODUCT_USECASE_PLANTE where Product_Usecase = $a",
										rowMode: 'array',
										bind: {$a: Product_UsecaseId},
									});
									console.log("End of delete product usecase plante SQL request.");
								} catch(ErrorObj) {
									console.log("Echec delete product usecase plante SQL request");
									alert("Delete product usecase plante failed");
									return;
								};
								
								//update state
								let ProductUsecasePlanteListStateObj = globalThis.PrivateProductUsecasePlanteStateListObj;
								let NEWProductUsecasePlanteListStateObj = [];
								let ListLength = ProductUsecasePlanteListStateObj.length;
								for(let k=0; k < ListLength; k++)
								{
									let ProductUsecasePlanteStateObj = ProductUsecasePlanteListStateObj[k];
									if(ProductUsecasePlanteStateObj.UsecaseId != UsecaseId)
									{
										NEWProductUsecasePlanteListStateObj.push(ProductUsecasePlanteStateObj);
									}
								}
								globalThis.PrivateProductUsecasePlanteStateListObj = NEWProductUsecasePlanteListStateObj;
							}
						}
					}
					else if((!ProductFct2StateObj.FlgCurrentlyUsedByProduct) && FlgFct2Checked)
					{
						// HERE : this Fct2 is to be added form list of product Fct
						console.log("Doing insert product Fct2 SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PRODUCT_FCTS2 values(null, $a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: Fct2Id},
							});
							console.log("End of insert product Fct2 SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert product Fct2 SQL request");
							alert("Insert product Fct2 failed");
							return;
						};
						// update state
						ProductFct2StateObj.FlgCurrentlyUsedByProduct = true;
					}
				}
			}
			
			// update product Effet2
			// NOTA : ProductEffet2StateListObj array row is : Effet2Id, Effet2Name, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbEffet2 = globalThis.PrivateProductEffet2StateListObj.length;
			for(let i = 0; i < NbEffet2; i++)
			{
				let ProductEffet2StateObj = globalThis.PrivateProductEffet2StateListObj[i];
				
				// check if in check list
				if(ProductEffet2StateObj.FlgInCheckList)
				{
					// get check state
					let Effet2Id = ProductEffet2StateObj.Effet2Id;
					let FlgEffet2Checked = document.getElementById("Effet2CheckListId_" + Effet2Id).checked;
					// check if this Effet2 is removed from list of product Effet2 or added to
					if(ProductEffet2StateObj.FlgCurrentlyUsedByProduct && (!FlgEffet2Checked))
					{
						// HERE : this Effet2 is to be removed form list of product Effet2
						console.log("Doing delete product Effet2 SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PRODUCT_EFFET2 where Product = $a and Effet2 = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: Effet2Id},
							});
							console.log("End of delete Effet2 product SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete Effet2 product SQL request");
							alert("Delete product Effet2 failled");
							return;
						};
						// update state
						ProductEffet2StateObj.FlgCurrentlyUsedByProduct = false;
					}
					else if((!ProductEffet2StateObj.FlgCurrentlyUsedByProduct) && FlgEffet2Checked)
					{
						// HERE : this Effet2 is to be added form list of product Effet2
						console.log("Doing insert product Effet2 SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PRODUCT_EFFET2 values($a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: Effet2Id},
							});
							console.log("End of insert product Effet2 SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert product Effet2 SQL request");
							alert("Insert product Effet2 failled");
							return;
						};
						// update state
						ProductEffet2StateObj.FlgCurrentlyUsedByProduct = true;
					}
				}
			}
			
			// update product toxicite
			// NOTA : ProductToxiciteStateListObj array row is : ToxiciteId, ToxiciteName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbToxicite = globalThis.PrivateProductToxiciteStateListObj.length;
			for(let i = 0; i < NbToxicite; i++)
			{
				let ProductToxiciteStateObj = globalThis.PrivateProductToxiciteStateListObj[i];
				
				// check if in check list
				if(ProductToxiciteStateObj.FlgInCheckList)
				{
					// get check state
					let ToxiciteId = ProductToxiciteStateObj.ToxiciteId;
					let FlgToxChecked = document.getElementById("ToxiciteCheckListId_" + ToxiciteId).checked;
					// check if this Toxicite is removed from list of product Toxicite or added to
					if(ProductToxiciteStateObj.FlgCurrentlyUsedByProduct && (!FlgToxChecked))
					{
						// HERE : this Toxicite is to be removed form list of product Toxicite
						console.log("Doing delete product Toxicite SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PRODUCT_TOXICITE where Product = $a and Toxicite = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: ToxiciteId},
							});
							console.log("End of delete Toxicite product SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete Toxicite product SQL request");
							alert("Delete product Toxicite failled");
							return;
						};
						// update state
						ProductToxiciteStateObj.FlgCurrentlyUsedByProduct = false;
					}
					else if((!ProductToxiciteStateObj.FlgCurrentlyUsedByProduct) && FlgToxChecked)
					{
						// HERE : this Toxicite is to be added form list of product Toxicite
						console.log("Doing insert product Toxicite SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PRODUCT_TOXICITE values($a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: ToxiciteId},
							});
							console.log("End of insert product Toxicite SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert product Toxicite SQL request");
							alert("Insert product Toxicite failled");
							return;
						};
						// update state
						ProductToxiciteStateObj.FlgCurrentlyUsedByProduct = true;
					}
				}
			}
			
			// update product CtrIndic
			// NOTA : ProductCtrIndicStateListObj array row is : CtrIndicId, CtrIndicName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbCtrIndic = globalThis.PrivateProductCtrIndicStateListObj.length;
			for(let i = 0; i < NbCtrIndic; i++)
			{
				let ProductCtrIndicStateObj = globalThis.PrivateProductCtrIndicStateListObj[i];
				
				// check if in check list
				if(ProductCtrIndicStateObj.FlgInCheckList)
				{
					// get check state
					let CtrIndicId = ProductCtrIndicStateObj.CtrIndicId;
					let FlgCtrIndicChecked = document.getElementById("CtrIndicCheckListId_" + CtrIndicId).checked;
					// check if this CtrIndic is removed from list of product CtrIndic or added to
					if(ProductCtrIndicStateObj.FlgCurrentlyUsedByProduct && (!FlgCtrIndicChecked))
					{
						// HERE : this CtrIndic is to be removed form list of product CtrIndic
						console.log("Doing delete product CtrIndic SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PRODUCT_CTRINDIC where Product = $a and CtrIndic = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: CtrIndicId},
							});
							console.log("End of delete CtrIndic product SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete CtrIndic product SQL request");
							alert("Delete product CtrIndic failled");
							return;
						};
						// update state
						ProductCtrIndicStateObj.FlgCurrentlyUsedByProduct = false;
					}
					else if((!ProductCtrIndicStateObj.FlgCurrentlyUsedByProduct) && FlgCtrIndicChecked)
					{
						// HERE : this CtrIndic is to be added form list of product CtrIndic
						console.log("Doing insert product CtrIndic SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PRODUCT_CTRINDIC values($a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: CtrIndicId},
							});
							console.log("End of insert product CtrIndic SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert product CtrIndic SQL request");
							alert("Insert product CtrIndic failled");
							return;
						};
						// update state
						ProductCtrIndicStateObj.FlgCurrentlyUsedByProduct = true;
					}
				}
			}
			
			// update product poso
			// NOTA : ProductPosoStateListObj array row is : EspeceId, EspeceName, FlgCurrentlyUsedByProduct
			let NbPoso = globalThis.PrivateProductPosoStateListObj.length;
			for(let i = 0; i < NbPoso; i++)
			{
				let ProductPosoStateObj = globalThis.PrivateProductPosoStateListObj[i];
				
				// get check state
				let EspeceName = ProductPosoStateObj.EspeceName;
				let EspeceId = ProductPosoStateObj.EspeceId;
				let Poso = CastRichTextToBuffer(GetRichTextContentAsHTML("ProductPoso" + EspeceName + "Input"));
				let TA = CastRichTextToBuffer(GetRichTextContentAsHTML("ProductTA" + EspeceName + "Input"));
				let FlgPosoChecked = document.getElementById(EspeceName).checked;
				// check if this Poso is removed from list of product Poso or added to
				if(ProductPosoStateObj.FlgCurrentlyUsedByProduct && (!FlgPosoChecked))
				{
					// HERE : this Poso is to be removed form list of product Poso
					console.log("Doing delete product Poso SQL request ...");
					try {
						globalThis.WorkingDB.exec({
							sql: "delete from PRODUCT_POSO where Product = $a and Espece = $b",
							rowMode: 'array',
							bind: {$a: globalThis.PrivateWorkingEltId, $b: EspeceId},
						});
						console.log("End of delete Poso product SQL request.");
					} catch(ErrorObj) {
						console.log("Echec delete Poso product SQL request");
						alert("Delete product Poso failed");
						return;
					};
					// update state
					ProductPosoStateObj.FlgCurrentlyUsedByProduct = false;
				}
				else if((!ProductPosoStateObj.FlgCurrentlyUsedByProduct) && FlgPosoChecked)
				{
					// HERE : this Poso is to be added form list of product Poso
					console.log("Doing insert product Poso SQL request ...");
					let SQLRequestResultObj = [];
					try {
						SQLRequestResultObj = globalThis.WorkingDB.exec({
							sql: "insert into PRODUCT_POSO values($a, $b, $c, $d)",
							rowMode: 'array',
							bind: {$a: globalThis.PrivateWorkingEltId, $b: EspeceId, $c: Poso, $d: TA},
						});
						console.log("End of insert product Poso SQL request.");
					} catch(ErrorObj) {
						console.log("Echec insert product Poso SQL request");
						alert("Insert product Poso failed");
						return;
					};
					// update state
					ProductPosoStateObj.FlgCurrentlyUsedByProduct = true;
				}
				else if(ProductPosoStateObj.FlgCurrentlyUsedByProduct && FlgPosoChecked)
				{
					// HERE : this Poso is to be updated form list of product Poso
					console.log("Doing update product poso info SQL request ...");
					try {
						globalThis.WorkingDB.exec({
							sql: "update PRODUCT_POSO set Posologie = $a, TA = $b where Product = $c and Espece = $d",
							rowMode: 'array',
							bind: {$a: Poso, $b: TA, $c: globalThis.PrivateWorkingEltId, $d: EspeceId},
						});
						console.log("End of update product poso info SQL request.");
					} catch(ErrorObj) {
						console.log("Echec update product poso info SQL request");
						alert("Update poso failed");
						return;
					};
				}
			}
			
			// notify done
			if(OldPrivateWorkingEltId == 0) alert("Insert done");
			else alert("Update done");
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			return;
		}

		// update product photo
		function DoUpdateProductPhoto()
		{
			let ListFilePathObj = document.getElementById("SelectedPhotoInput").files;

			// get selected file
			let FileObj = ListFilePathObj[0];
			// Load file
			DoReadImageFileAsURL(FileObj).then((OpsResult) => {
				// get result
				let FileDataURL = OpsResult;
				// set data on image view
				document.getElementById("ProductPhotoView").src = FileDataURL;
			}).catch((OpsError) => {
				alert("Echec reading image");
			});
			return;
		}
		
		// Sanitize Name
		function DoSanitizeNameTxt(EltNameValue)
		{
			// filter out special chars
			EltNameValue = EltNameValue.replace(/[&\\#,+$~%":*?<>{}]/g, '');
			// remove leading and trailing space
			EltNameValue = EltNameValue.trim();
			return EltNameValue;
		}

		// check name validity
		function DoCheckNameValidity()
		{
			let EltNameObj = document.getElementById("EltNameInput");
			let EltNameValue = EltNameObj.value;

			// sanitize
			EltNameValue = DoSanitizeNameTxt(EltNameValue);
			// set filtered string
			document.getElementById("EltNameInput").value = EltNameValue;
			return;
		}
		
		//collapse Div Plante
		function CollapseDivPlFct(FctId)
		{
			let DivElt = document.getElementById("ListCheckedPlanteFctUsecase_" + FctId);
			let CheckId = document.getElementById("PlFctCheckListId_" + FctId).checked;
			console.log('hello');
			
			if(CheckId)
			{
				DivElt.style.display = "block";
			}
			else
			{
				DivElt.style.display = "none";
			}
		}
		
		//collapse Div Product Fct
		function CollapseDivPrdFct(FctId)
		{
			let DivElt = document.getElementById("ListCheckedProductFctUsecase_" + FctId);
			let CheckId = document.getElementById("FctCheckListId_" + FctId).checked;
			
			if(CheckId)
			{
				DivElt.style.display = "block";
			}
			else
			{
				DivElt.style.display = "none";
			}
		}
		
		//collapse Div Product Fct2
		function CollapseDivPrdFct2(FctId)
		{
			let DivElt = document.getElementById("ListCheckedProductFctUsecase_" + FctId);
			let CheckId = document.getElementById("Fct2CheckListId_" + FctId).checked;
			
			if(CheckId)
			{
				DivElt.style.display = "block";
			}
			else
			{
				DivElt.style.display = "none";
			}
		}
		
		//collapse Div Product Usecase
		function CollapseDivPrdUsecase(ProductId, UsecaseId)
		{
			let DivElt = document.getElementById("ListCheckedProductUsecasePlante" + ProductId + "_" + UsecaseId);
			let CheckId = document.getElementById("UsecaseCheckListId_" + UsecaseId).checked;
			
			if(CheckId)
			{
				DivElt.style.display = "block";
			}
			else
			{
				DivElt.style.display = "none";
			}
		}
		
		// build Labo combo
		function BuildLaboInputCombo(DfltLaboId)
		{
			let LaboInputComboTxt = "";
		
			// pre build combo
			LaboInputComboTxt += "<select id=\"LaboInputCombo\" style=\"width: 200px;\">";
			// fetch list labo
			console.log("Doing combo list labo SQL request ...");
			let LaboSQLRequestResultObj = [];
			try {
				LaboSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from LABO order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of combo list labo SQL request.");
			} catch(ErrorObj) {
				console.log("Echec combo list labo SQL request");
			};			
			let NbResultRow = LaboSQLRequestResultObj.length;
			console.log("Combo list labo : " + NbResultRow + " elts");
			if(NbResultRow == 0)
			{
				LaboInputComboTxt += "<option value=\"0\">*** NO LABO ***</option>";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					// fetch info
					let TmpResultRow = LaboSQLRequestResultObj[i];
					let LaboId = TmpResultRow[0];
					let LaboNameTxt = TmpResultRow[1];
					if(LaboNameTxt == null) LaboNameTxt = "UNKNOWN LABO ID " + LaboId;
					LaboNameTxt = DoSanitizeNameTxt(LaboNameTxt);
					// add to combo
					LaboInputComboTxt += "<option value=\"" + LaboId + "\"";
					if(LaboId == DfltLaboId) LaboInputComboTxt += " selected ";
					LaboInputComboTxt += ">" + LaboNameTxt + "</option>";
				}
			}
			// finalize
			LaboInputComboTxt += "</select>";
			return LaboInputComboTxt;
		}
		
		// build Galenique combo
		function BuildGaleniqueInputCombo(DfltGaleniqueId)
		{
			let GaleniqueInputComboTxt = "";
		
			// pre build combo
			GaleniqueInputComboTxt += "<select id=\"GaleniqueInputCombo\" style=\"width: 200px;\">";
			// fetch list Galenique
			console.log("Doing combo list Galenique SQL request ...");
			let GaleniqueSQLRequestResultObj = [];
			try {
				GaleniqueSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from Galenique order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of combo list Galenique SQL request.");
			} catch(ErrorObj) {
				console.log("Echec combo list Galenique SQL request");
			};			
			let NbResultRow = GaleniqueSQLRequestResultObj.length;
			console.log("Combo list Galenique : " + NbResultRow + " elts");
			if(NbResultRow == 0)
			{
				GaleniqueInputComboTxt += "<option value=\"0\">*** NO Galenique ***</option>";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					// fetch info
					let TmpResultRow = GaleniqueSQLRequestResultObj[i];
					let GaleniqueId = TmpResultRow[0];
					let GaleniqueNameTxt = TmpResultRow[1];
					if(GaleniqueNameTxt == null) GaleniqueNameTxt = "UNKNOWN Galenique ID " + GaleniqueId;
					GaleniqueNameTxt = DoSanitizeNameTxt(GaleniqueNameTxt);
					// add to combo
					GaleniqueInputComboTxt += "<option value=\"" + GaleniqueId + "\"";
					if(GaleniqueId == DfltGaleniqueId) GaleniqueInputComboTxt += " selected ";
					GaleniqueInputComboTxt += ">" + GaleniqueNameTxt + "</option>";
				}
			}
			// finalize
			GaleniqueInputComboTxt += "</select>";
			return GaleniqueInputComboTxt;
		}
		
		// build Categorie combo
		function BuildCategorieInputCombo(DfltCategorieId)
		{
			let CategorieInputComboTxt = "";
		
			// pre build combo
			CategorieInputComboTxt += "<select id=\"CategorieInputCombo\" style=\"width: 200px;\">";
			// fetch list Categorie
			console.log("Doing combo list Categorie SQL request ...");
			let CategorieSQLRequestResultObj = [];
			try {
				CategorieSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from Categorie order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of combo list Categorie SQL request.");
			} catch(ErrorObj) {
				console.log("Echec combo list Categorie SQL request");
			};			
			let NbResultRow = CategorieSQLRequestResultObj.length;
			console.log("Combo list Categorie : " + NbResultRow + " elts");
			if(NbResultRow == 0)
			{
				CategorieInputComboTxt += "<option value=\"0\">*** NO Categorie ***</option>";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					// fetch info
					let TmpResultRow = CategorieSQLRequestResultObj[i];
					let CategorieId = TmpResultRow[0];
					let CategorieNameTxt = TmpResultRow[1];
					if(CategorieNameTxt == null) CategorieNameTxt = "UNKNOWN Categorie ID " + CategorieId;
					CategorieNameTxt = DoSanitizeNameTxt(CategorieNameTxt);
					// add to combo
					CategorieInputComboTxt += "<option value=\"" + CategorieId + "\"";
					if(CategorieId == DfltCategorieId) CategorieInputComboTxt += " selected ";
					CategorieInputComboTxt += ">" + CategorieNameTxt + "</option>";
				}
			}
			// finalize
			CategorieInputComboTxt += "</select>";
			return CategorieInputComboTxt;
		}
		
		// build list Poso
		function BuildPosoList(ProductId)
		{
			//pre-build div
			let PlanteEspeceListObj = document.getElementById("TableCheckEspece");
			
			//init state list Poso
			// NOTA : ProductPosoStateListObj array row is : EspeceName, FlgCurrentlyUsedByProduct
			let ProductPosoStateListObj = [];
			
			// fetch all Espece
			console.log("Doing list Espece SQL request ...");
			let EspeceSQLRequestResultObj = [];
			try {
				EspeceSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from ESPECE",
					rowMode: 'array',
				});
				console.log("End of list Espece SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Espece SQL request");
			};
			
			// build list Espece state array and div
			let EspeceTxt = "<table border=1 cellspacing=0 cellpadding=5 valign=center><tr align=center><th>Espce</th><th>Posologie</th><th>Temps d'attente</th></tr><tr valign=center>";
			let NbResultRow = EspeceSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = EspeceSQLRequestResultObj[i];
				let EspeceId = TmpResultRow[0];
				let EspeceNameTxt = TmpResultRow[1];
				if(EspeceNameTxt == null) EspeceNameTxt = "UNKNOWN Espece ID " + EspeceId;
				EspeceNameTxt = DoSanitizeNameTxt(EspeceNameTxt);
				// add to Product poso state array
				let EspeceStateListObj = {EspeceId: EspeceId, EspeceName: EspeceNameTxt, FlgCurrentlyUsedByProduct: false};
				ProductPosoStateListObj.push(EspeceStateListObj);
				// add to Fct pool combo
				EspeceTxt += "<tr align=center><td class='species'><input type='checkbox' name='Espece' id='" + EspeceNameTxt + "' value='" + EspeceNameTxt +"'><label for '" + EspeceNameTxt + "'>" + EspeceNameTxt +"</label></td>";
				EspeceTxt += "<td><textarea id=\"ProductPoso" + EspeceNameTxt +"Input\">Initializing Rich text editor ...</textarea></td>";
				EspeceTxt += "<td><textarea id=\"ProductTA" + EspeceNameTxt +"Input\">Initializing Rich text editor ...</textarea></td></tr>";
			}
			EspeceTxt += "</table>";
			PlanteEspeceListObj.innerHTML = EspeceTxt;
			
			//fetch info poso
			let ProductPosoSQLRequestResultObj = [];
			console.log("Doing product poso SQL request ...");
			try {
				ProductPosoSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Espece, Posologie, TA from PRODUCT_POSO where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product poso SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product poso SQL request");
			};			
			
			//update poso state array
			let NbPoso = ProductPosoSQLRequestResultObj.length;
			for(let i = 0; i < NbPoso; i++)
			{
				//fetch poso info
				let TmpResultRow = ProductPosoSQLRequestResultObj[i];
				let EspeceId = TmpResultRow[0];
				let Poso = TmpResultRow[1];
				let TA = TmpResultRow[2];
				
				let EspeceNameTxt = EspeceSQLRequestResultObj[EspeceId-1][1];
				if(EspeceNameTxt == null) EspeceNameTxt = "UNKNOWN Espece ID " + EspeceId;
				EspeceNameTxt = DoSanitizeNameTxt(EspeceNameTxt);
				
				let ProductPosoBlob = CastRichTextToBuffer("");
				ProductPosoBlob = Poso;
				let ProductTABlob = CastRichTextToBuffer("");
				ProductTABlob = TA;
				
				document.getElementById(EspeceNameTxt).checked = true;
				ProductPosoStateListObj[EspeceId-1].FlgCurrentlyUsedByProduct = true;
				
				ActivateRichTextOnSmallTextArea("ProductPoso" + EspeceNameTxt + "Input",CastBufferToRichText(ProductPosoBlob));
				ActivateRichTextOnSmallTextArea("ProductTA" + EspeceNameTxt + "Input",CastBufferToRichText(ProductTABlob));
			}
			
			//activate richtext for unchecked species
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = EspeceSQLRequestResultObj[i];
				let EspeceId = TmpResultRow[0];
				let EspeceNameTxt = TmpResultRow[1];
				if(EspeceNameTxt == null) EspeceNameTxt = "UNKNOWN Espece ID " + EspeceId;
				EspeceNameTxt = DoSanitizeNameTxt(EspeceNameTxt);
				
				let ProductPosoBlob = CastRichTextToBuffer("");
				let ProductTABlob = CastRichTextToBuffer("");
				
				if(!document.getElementById(EspeceNameTxt).checked)
				{
					ActivateRichTextOnSmallTextArea("ProductPoso" + EspeceNameTxt + "Input",CastBufferToRichText(ProductPosoBlob));
					ActivateRichTextOnSmallTextArea("ProductTA" + EspeceNameTxt + "Input",CastBufferToRichText(ProductTABlob));
				}
			}
			
			//update global var
			globalThis.PrivateProductPosoStateListObj = ProductPosoStateListObj;
		}
		
		// append selected Plante to product list, and check it
		function DoAppendProductPlante()
		{
			let PlanteComboObj = document.getElementById("PlantePoolCombo");
			let ProductPlanteListObj = document.getElementById("ListCheckedProductPlante");
		
			// get combo selection
			let TmpPlanteIdx = PlanteComboObj.value;
			if(TmpPlanteIdx == null) return;
			// NOTA : ProductPlanteStateListObj array row is : PlanteId, PlanteName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductPlanteStateObj = globalThis.PrivateProductPlanteStateListObj[TmpPlanteIdx];
			// check if already in check list (should never happen)
			if(ProductPlanteStateObj.FlgInCheckList) return;
			// update check list
			PlanteId = ProductPlanteStateObj.PlanteId;
			
			let PlanteTab = document.createElement('text');
			PlanteTab.innerHTML = "&emsp;";
			ProductPlanteListObj.appendChild(PlanteTab);
			
			let PlanteCheckListObj = document.createElement('input');
			PlanteCheckListObj.type = 'checkbox';
			PlanteCheckListObj.id = "PlanteCheckListId_" + PlanteId;
			PlanteCheckListObj.checked = true;
			ProductPlanteListObj.appendChild(PlanteCheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += ProductPlanteStateObj.PlanteName;
			let PlanteCheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			ProductPlanteListObj.appendChild(PlanteCheckListTextObj);
			//...
			let PlanteInfo = document.createElement('text');
			PlanteInfo.innerHTML = "&nbsp;(partie utilise : " + BuildUsePartInputCombo(0,PlanteId) + ")";
			ProductPlanteListObj.appendChild(PlanteInfo);
			//...
			ProductPlanteListObj.appendChild(document.createElement('br'));
			
			// update combo
			let PlantePoolObj = document.getElementById("PlantePoolId_" + PlanteId);
			PlantePoolObj.disabled = true;			
			// update state array
			ProductPlanteStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivateProductPlanteStateListObj[TmpPlanteIdx] = ProductPlanteStateObj;
			return;
		}
		
		// build list product Plante
		function BuildProductPlanteListAndCombo(ProductId)
		{
			let PlanteComboObj = document.getElementById("PlantePoolCombo");
			let ProductPlanteListObj = document.getElementById("ListCheckedProductPlante");
			// NOTA : ProductPlanteStateListObj array row is : PlanteId, PlanteName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductPlanteStateListObj = [];

			// fetch all Plante
			console.log("Doing list Plante SQL request ...");
			let PlanteSQLRequestResultObj = [];
			try {
				PlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from PLANTE order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list Plante SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Plante SQL request");
			};
			// build list Plante state array AND Plante pool combo
			let PlantePoolComboTxt = "";
			let NbResultRow = PlanteSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = PlanteSQLRequestResultObj[i];
				let PlanteId = TmpResultRow[0];
				let PlanteNameTxt = TmpResultRow[1];
				if(PlanteNameTxt == null) PlanteNameTxt = "UNKNOWN Plante ID " + PlanteId;
				PlanteNameTxt = DoSanitizeNameTxt(PlanteNameTxt);
				// add to Plante state array
				let ProductPlanteStateObj = {PlanteId: PlanteId, PlanteName: PlanteNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				ProductPlanteStateListObj.push(ProductPlanteStateObj);
				// add to Plante pool combo
				PlantePoolComboTxt += "<option id=\"PlantePoolId_" + PlanteId + "\" value=\"" + i + "\" >" + PlanteNameTxt + "</option>";
			}
			// fill Plante combo
			PlanteComboObj.innerHTML = PlantePoolComboTxt;

			// fetch product Plante
			console.log("Doing product Plante SQL request ...");
			let ProductPlanteSQLRequestResultObj = [];
			try {
				ProductPlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Plante, Usepart from PRODUCT_PLANTE where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product Plante SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product Plante SQL request");
			};
			// update Plante state array AND Plante check list 
			let PlanteCheckListTxt = "";
			let NbPlante = ProductPlanteSQLRequestResultObj.length;
			for(let i = 0; i < NbPlante; i++)
			{
				// fetch Plante id
				let TmpResultRow = ProductPlanteSQLRequestResultObj[i];
				let PlanteId = TmpResultRow[0];
				let UsePartId = TmpResultRow[1];
				// get Plante state array IDX
				let PlantePoolObj = document.getElementById("PlantePoolId_" + PlanteId);
				let TmpPlanteIdx = PlantePoolObj.value;
				let ProductPlanteStateObj = ProductPlanteStateListObj[TmpPlanteIdx];
				// update check list
				PlanteCheckListTxt += "&emsp;<input type=\"checkbox\" id=\"PlanteCheckListId_" + PlanteId + "\" checked>" + ProductPlanteStateObj.PlanteName + "</input> (partie utilise : " + BuildUsePartInputCombo(UsePartId,PlanteId) + ")<br/>";
				// update combo
				PlantePoolObj.disabled = true;
				// update Plante state array
				ProductPlanteStateObj.FlgCurrentlyUsedByProduct = true;
				ProductPlanteStateObj.FlgInCheckList = true;
			}
			// fill Plante check list
			ProductPlanteListObj.innerHTML = PlanteCheckListTxt;
			// save Plante state array
			globalThis.PrivateProductPlanteStateListObj = ProductPlanteStateListObj;			
			return;
		}
		
		// build UsePart combo
		function BuildUsePartInputCombo(DfltUsePartId,PlanteId)
		{
			let UsePartInputComboTxt = "";
		
			// pre build combo
			UsePartInputComboTxt += "<select id=\"UsePartInputCombo_" + PlanteId + "\" style=\"width: 200px;\">";
			// fetch list UsePart
			console.log("Doing combo list UsePart SQL request ...");
			let UsePartSQLRequestResultObj = [];
			try {
				UsePartSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from UsePart order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of combo list UsePart SQL request.");
			} catch(ErrorObj) {
				console.log("Echec combo list UsePart SQL request");
			};			
			let NbResultRow = UsePartSQLRequestResultObj.length;
			console.log("Combo list UsePart : " + NbResultRow + " elts");
			if(NbResultRow == 0)
			{
				UsePartInputComboTxt += "<option value=\"0\">*** NO UsePart ***</option>";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					// fetch info
					let TmpResultRow = UsePartSQLRequestResultObj[i];
					let UsePartId = TmpResultRow[0];
					let UsePartNameTxt = TmpResultRow[1];
					if(UsePartNameTxt == null) UsePartNameTxt = "UNKNOWN UsePart ID " + UsePartId;
					UsePartNameTxt = DoSanitizeNameTxt(UsePartNameTxt);
					// add to combo
					UsePartInputComboTxt += "<option value=\"" + UsePartId + "\"";
					if(UsePartId == DfltUsePartId) UsePartInputComboTxt += " selected ";
					UsePartInputComboTxt += ">" + UsePartNameTxt + "</option>";
				}
			}
			// finalize
			UsePartInputComboTxt += "</select>";
			return UsePartInputComboTxt;
		}
		
		// build usecase Fct combo
		function BuildUsecaseFctInputCombo(DfltFctId)
		{
			let UsecaseFctInputComboTxt = "";
		
			// pre build combo
			UsecaseFctInputComboTxt += "<select id=\"UsecaseFctInputCombo\" style=\"width: 200px;\">";
			// fetch list labo
			console.log("Doing combo list Fct SQL request ...");
			let FctSQLRequestResultObj = [];
			try {
				FctSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from FCTS order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of combo list Fct SQL request.");
			} catch(ErrorObj) {
				console.log("Echec combo list Fct SQL request");
			};			
			let NbResultRow = FctSQLRequestResultObj.length;
			console.log("Combo list Fct : " + NbResultRow + " elts");
			if(NbResultRow == 0)
			{
				UsecaseFctInputComboTxt += "<option value=\"0\">*** NO FCT ***</option>";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					// fetch info
					let TmpResultRow = FctSQLRequestResultObj[i];
					let FctId = TmpResultRow[0];
					let FctNameTxt = TmpResultRow[1];
					if(FctNameTxt == null) FctNameTxt = "UNKNOWN FCT ID " + FctId;
					FctNameTxt = DoSanitizeNameTxt(FctNameTxt);
					// add to combo
					UsecaseFctInputComboTxt += "<option value=\"" + FctId + "\"";
					if(FctId == DfltFctId) UsecaseFctInputComboTxt += " selected ";
					UsecaseFctInputComboTxt += ">" + FctNameTxt + "</option>";
				}
			}
			// finalize
			UsecaseFctInputComboTxt += "</select>";
			return UsecaseFctInputComboTxt;
		}
		
		// build Product Usecase Plante combo
		function BuildPlantePoolCombo(UsecaseId)
		{
			let PlanteInputComboTxt = "";
		
			// pre build combo
			PlanteInputComboTxt += "<select id=\"PlantePoolCombo_" + UsecaseId + "\" style=\"width: 200px;\">";
			// fetch list Plante
			console.log("Doing combo list Plante SQL request ...");
			let PlanteSQLRequestResultObj = [];
			try {
				PlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from Plante order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of combo list Plante SQL request.");
			} catch(ErrorObj) {
				console.log("Echec combo list Plante SQL request");
			};			
			let NbResultRow = PlanteSQLRequestResultObj.length;
			console.log("Combo list Plante : " + NbResultRow + " elts");
			if(NbResultRow == 0)
			{
				PlanteInputComboTxt += "<option value=\"0\">*** NO Plante ***</option>";
			}
			else
			{				
				for(let i = 0; i < NbResultRow; i++)
				{
					// fetch info
					let TmpResultRow = PlanteSQLRequestResultObj[i];
					let PlanteId = TmpResultRow[0];
					let PlanteNameTxt = TmpResultRow[1];
					if(PlanteNameTxt == null) PlanteNameTxt = "UNKNOWN Plante ID " + PlanteId;
					PlanteNameTxt = DoSanitizeNameTxt(PlanteNameTxt);
					// add to combo
					PlanteInputComboTxt += "<option id=\"PlantePoolId" + UsecaseId + "_" + PlanteId + "\" value=\"" + PlanteId + "\" >" + PlanteNameTxt + "</option>";
				}
			}
			// finalize
			PlanteInputComboTxt += "</select>";
			return PlanteInputComboTxt;
		}
		
		// build list product Usecase Plante for addition
		function BuildProductUsecasePlanteListForAdd(ProductId,UsecaseId)
		{
			// fetch all Plante
			console.log("Doing list Plante SQL request ...");
			let PlanteSQLRequestResultObj = [];
			try {
				PlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from PLANTE order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list Plante SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Plante SQL request");
			};
			
			//Get Div Id
			let ProductUsecasePlanteListObj = document.getElementById("ListCheckedProductUsecasePlante" + ProductId + "_" + UsecaseId);
			//init text
			let PlanteCheckListTxt = "";
			// fill Plante check list
			ProductUsecasePlanteListObj.innerHTML = PlanteCheckListTxt;
			
			// build list Plante state array
			let NbPlanteResultRow = PlanteSQLRequestResultObj.length;
			for(let i = 0; i < NbPlanteResultRow; i++)
			{
				// fetch info
				let TmpPlanteResultRow = PlanteSQLRequestResultObj[i];
				let PlanteId = TmpPlanteResultRow[0];
				let PlanteNameTxt = TmpPlanteResultRow[1];
				if(PlanteNameTxt == null) PlanteNameTxt = "UNKNOWN Plante ID " + PlanteId;
				PlanteNameTxt = DoSanitizeNameTxt(PlanteNameTxt);
				// add to global Usecase Plante state array
				let ProductUsecasePlanteStateObj = {UsecaseId: UsecaseId, PlanteId: PlanteId, PlanteName: PlanteNameTxt, FlgCurrentlyUsedByUsecase: false, FlgInCheckList: false};
				globalThis.PrivateProductUsecasePlanteStateListObj.push(ProductUsecasePlanteStateObj);
			}
			return;
		}
		
		//append selected plante to plante list and check it
		function DoAppendPlante(UsecaseId)
		{
			let PlanteComboObj = document.getElementById("PlantePoolCombo_" + UsecaseId);
			let ProductId = globalThis.PrivateWorkingEltId;
			let ProductUsecasePlanteListObj = document.getElementById("ListCheckedProductUsecasePlante" + ProductId + "_" + UsecaseId);
			
			// get combo selection
			let TmpPlanteIdx = PlanteComboObj.value;
			if(TmpPlanteIdx == null) return;
			// NOTA : ProductUsecasePlanteStateListObj array row is : UsecaseId, PlanteId, PlanteName, FlgCurrentlyUsedByUsecase, FlgInCheckList
			let i = 0;
			let TMPStateObj = globalThis.PrivateProductUsecasePlanteStateListObj[i];
			//console.log("SEARCHING FOR: UsecaseId = " + UsecaseId + ", PlanteId = " + TmpPlanteIdx);
			//console.log("UsecaseId = " + TMPStateObj.UsecaseId + ", PlanteId = " + TMPStateObj.PlanteId);
			while((TMPStateObj.UsecaseId != UsecaseId) || (TMPStateObj.PlanteId != TmpPlanteIdx))
			{
				i++;
				TMPStateObj = globalThis.PrivateProductUsecasePlanteStateListObj[i];
				//console.log("UsecaseId = " + TMPStateObj.UsecaseId + ", PlanteId = " + TMPStateObj.PlanteId);
			}
			let ProductUsecasePlanteStateObj = globalThis.PrivateProductUsecasePlanteStateListObj[i];
			// check if already in check list (should never happen)
			if(ProductUsecasePlanteStateObj.FlgInCheckList) return;
			
			// update check list
			PlanteId = ProductUsecasePlanteStateObj.PlanteId;
			//let PlanteCheckListTxt = "";
			//PlanteCheckListTxt += "&emsp;<input type=\"checkbox\" id=\"PlanteCheckListId_" + UsecaseId + "_" + PlanteId + "\" checked>" + ProductUsecasePlanteStateObj.PlanteName + "</input><br/>";			
			//ProductUsecasePlanteListObj.innerHTML += PlanteCheckListTxt;
			
			let PlanteTabObj = document.createElement('text');
			PlanteTabObj.innerHTML = "&emsp;&emsp;&emsp;";
			ProductUsecasePlanteListObj.appendChild(PlanteTabObj);
			//...
			let PlanteCheckListObj = document.createElement('input');
			PlanteCheckListObj.type = 'checkbox';
			PlanteCheckListObj.id = "PlanteCheckListId_" + UsecaseId + "_" + PlanteId;
			PlanteCheckListObj.checked = true;
			ProductUsecasePlanteListObj.appendChild(PlanteCheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += ProductUsecasePlanteStateObj.PlanteName;
			let PlanteCheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			ProductUsecasePlanteListObj.appendChild(PlanteCheckListTextObj);
			//...
			ProductUsecasePlanteListObj.appendChild(document.createElement('br'));
			
			// update combo
			let PlantePoolObj = document.getElementById("PlantePoolId" + UsecaseId + "_" + PlanteId);
			PlantePoolObj.disabled = true;
			// update state array
			ProductUsecasePlanteStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivateProductUsecasePlanteStateListObj[i] = ProductUsecasePlanteStateObj;
			return;
		}
		
		// build list product Usecase for addition
		function BuildProductUsecaseListForAdd(FctId)
		{
			// fetch all Usecase
			console.log("Doing list Usecase SQL request ...");
			let UsecaseSQLRequestResultObj = [];
			try {
				UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from USECASE where Fct = $a order by Name ASC",
					rowMode: 'array',
					bind: {$a: FctId},
				});
				console.log("End of list Usecase SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Usecase SQL request");
			};
			
			//Get Div Id
			let ProductUsecaseListObj = document.getElementById("ListCheckedProductFctUsecase_" + FctId);
			//init text
			let UsecaseCheckListTxt = "";
			// fill Usecase check list
			ProductUsecaseListObj.innerHTML = UsecaseCheckListTxt;
			
			// build list Usecase state array
			let NbUsecaseResultRow = UsecaseSQLRequestResultObj.length;
			for(let i = 0; i < NbUsecaseResultRow; i++)
			{
				// fetch info
				let TmpUsecaseResultRow = UsecaseSQLRequestResultObj[i];
				let UsecaseId = TmpUsecaseResultRow[0];
				let UsecaseNameTxt = TmpUsecaseResultRow[1];
				if(UsecaseNameTxt == null) UsecaseNameTxt = "UNKNOWN Usecase ID " + UsecaseId;
				UsecaseNameTxt = DoSanitizeNameTxt(UsecaseNameTxt);
				// add to global Usecase state array
				let ProductUsecaseStateObj = {UsecaseId: UsecaseId, UsecaseName: UsecaseNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				globalThis.PrivateProductUsecaseStateListObj.push(ProductUsecaseStateObj);
			}
			return;
		}
		
		// append selected usecase to product list, and check it
		function DoAppendUsecase(FctId)
		{
			let UsecaseComboObj = document.getElementById("UsecaseInputCombo_" + FctId);
			let ProductUsecaseListObj = document.getElementById("ListCheckedProductFctUsecase_" + FctId);
			let ProductId = globalThis.PrivateWorkingEltId;
		
			// get combo selection
			let UsecaseId = UsecaseComboObj.value;
			if(UsecaseId == null) return;
			// NOTA : ProductUsecaseStateListObj array row is : UsecaseId, UsecaseName, FlgCurrentlyUsedByProduct, FlgInCheckList
			NbUsecases = globalThis.PrivateProductUsecaseStateListObj.length;
			let ProductUsecaseStateObj = [];
			let TmpUsecaseIdx = 0;
			for(let i=0; i < NbUsecases; i++)
			{
				if(globalThis.PrivateProductUsecaseStateListObj[i].UsecaseId == UsecaseId)
				{
					ProductUsecaseStateObj = globalThis.PrivateProductUsecaseStateListObj[i];
					TmpUsecaseIdx = i;
				}
			}
			
			// check if already in check list (should never happen)
			if(ProductUsecaseStateObj.FlgInCheckList) return;
			// update check list
			
			let UsecaseTabObj = document.createElement('text');
			UsecaseTabObj.innerHTML = "&emsp;&emsp;";
			ProductUsecaseListObj.appendChild(UsecaseTabObj);
			<!-- //... -->
			<!-- let UsecaseCheckListObj = document.createElement('input'); -->
			<!-- UsecaseCheckListObj.type = 'checkbox'; -->
			<!-- UsecaseCheckListObj.id = "UsecaseCheckListId_" + UsecaseId; -->
			<!-- UsecaseCheckListObj.checked = true; -->
			<!-- ProductUsecaseListObj.appendChild(UsecaseCheckListObj); -->
			<!-- //... -->
			<!-- let CheckBoxValueTxt = ""; -->
			<!-- CheckBoxValueTxt += ProductUsecaseStateObj.UsecaseName; -->
			<!-- let UsecaseCheckListTextObj = document.createTextNode(CheckBoxValueTxt); -->
			<!-- ProductUsecaseListObj.appendChild(UsecaseCheckListTextObj); -->
			
			//...
			let UsecaseCheckListObj = document.createElement('text');
			UsecaseCheckListObj.innerHTML = "<input type=\"checkbox\" id=\"UsecaseCheckListId_" + UsecaseId + "\" onclick=\"CollapseDivPrdUsecase(" + ProductId + "," + UsecaseId + ")\" checked>" + ProductUsecaseStateObj.UsecaseName + "</input>";
			ProductUsecaseListObj.appendChild(UsecaseCheckListObj);
			
			//...
			let UsecasePlanteCombo = document.createElement('text');
			UsecasePlanteCombo.innerHTML = "&nbsp;(en association avec : " + BuildPlantePoolCombo(UsecaseId) + " <input type=\"button\" value=\"Append\" onclick=\"DoAppendPlante(" + UsecaseId + ");\" class='append' />)<br/><div id=\"ListCheckedProductUsecasePlante" + ProductId + "_" + UsecaseId + "\">&emsp;Empty list checked plante</div>";
			ProductUsecaseListObj.appendChild(UsecasePlanteCombo);
			//...
			//ProductUsecaseListObj.appendChild(document.createElement('br'));
			
			// update combo
			let UsecasePoolObj = document.getElementById("UsecasePoolId" + UsecaseId);
			UsecasePoolObj.disabled = true;			
			// update state array
			ProductUsecaseStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivateProductUsecaseStateListObj[TmpUsecaseIdx] = ProductUsecaseStateObj;
			BuildProductUsecasePlanteListForAdd(ProductId,UsecaseId);
			return;
		}
		
		// build list product Usecase Plante
		function BuildProductUsecasePlanteList(ProductId)
		{
			// fetch product use cases
			console.log("Doing product usecases SQL request ...");
			let ProductUsecasesSQLRequestResultObj = [];
			try {
				ProductUsecasesSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Usecase from PRODUCT_USECASE where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product usecases SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product usecases SQL request");
			};
			
			// fetch all Plante
			console.log("Doing list Plante SQL request ...");
			let PlanteSQLRequestResultObj = [];
			try {
				PlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from PLANTE",
					rowMode: 'array',
				});
				console.log("End of list Plante SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Plante SQL request");
			};
			
			// NOTA : ProductUsecasePlanteStateListObj array row is : UseCaseId, PlanteId, PlanteName, FlgCurrentlyUsedByusecase, FlgInCheckList
			let ProductUsecasePlanteStateListObj = [];
			
			//pour tous les usecases affichs
			let NbResultRow = ProductUsecasesSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch usecase id
				let TmpResultRow = ProductUsecasesSQLRequestResultObj[i];
				let Product_UsecaseId = TmpResultRow[0];
				let UsecaseId = TmpResultRow[1];
				
				//Get Div Id
				let ProductUsecasePlanteListObj = document.getElementById("ListCheckedProductUsecasePlante" + ProductId + "_" + UsecaseId);
				//init text
				let PlanteCheckListTxt = "";
				
				// fetch product usecase plante
				console.log("Doing product usecase plante SQL request ...");
				let ProductUsecasePlanteSQLRequestResultObj = [];
				try {
					ProductUsecasePlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select Plante from PRODUCT_USECASE_PLANTE where Product_Usecase = $a",
						rowMode: 'array',
						bind: {$a: Product_UsecaseId},
					});
					console.log("End of product usecase plante SQL request.");
				} catch(ErrorObj) {
					console.log("Echec product usecase plante SQL request");
				};
				
				// build list Plante state array
				let NbPlanteResultRow = PlanteSQLRequestResultObj.length;
				for(let j = 0; j < NbPlanteResultRow; j++)
				{
					// fetch info
					let TmpPlanteResultRow = PlanteSQLRequestResultObj[j];
					let PlanteId = TmpPlanteResultRow[0];
					let PlanteNameTxt = TmpPlanteResultRow[1];
					if(PlanteNameTxt == null) PlanteNameTxt = "UNKNOWN Plante ID " + PlanteId;
					PlanteNameTxt = DoSanitizeNameTxt(PlanteNameTxt);
					// add to Usecase Plante state array
					let ProductUsecasePlanteStateObj = {UsecaseId: UsecaseId, PlanteId: PlanteId, PlanteName: PlanteNameTxt, FlgCurrentlyUsedByUsecase: false, FlgInCheckList: false};
					ProductUsecasePlanteStateListObj.push(ProductUsecasePlanteStateObj);
				}
				
				//pour toutes les plantes
				let NbResultPlanteRow = ProductUsecasePlanteSQLRequestResultObj.length;
				for(let j = 0; j < NbResultPlanteRow; j++)
				{
					// fetch plante id
					let TmpResultPlanteRow = ProductUsecasePlanteSQLRequestResultObj[j];
					let PlanteId = TmpResultPlanteRow[0];
					// get Plante state array IDX
					let PlantePoolObj = document.getElementById("PlantePoolId" + UsecaseId + "_" + PlanteId);
					let ProductUsecasePlanteStateObj = ProductUsecasePlanteStateListObj[NbPlanteResultRow*i + PlanteId-1];
					// update check list
					PlanteCheckListTxt += "&emsp;&emsp;&emsp;<input type=\"checkbox\" id=\"PlanteCheckListId_" + UsecaseId + "_" + PlanteId + "\" checked>" + ProductUsecasePlanteStateObj.PlanteName + "</input><br/>";
					// update combo
					PlantePoolObj.disabled = true;
					// update Plante state array
					ProductUsecasePlanteStateObj.FlgCurrentlyUsedByUsecase = true;
					ProductUsecasePlanteStateObj.FlgInCheckList = true;
				}
				
				// fill Plante check list
				ProductUsecasePlanteListObj.innerHTML = PlanteCheckListTxt;
			}
			
			// save usecase plante state array
			globalThis.PrivateProductUsecasePlanteStateListObj = ProductUsecasePlanteStateListObj;			
			
			return;
		}
		
		// build Usecase combo
		function BuildUsecasePoolCombo(FctId)
		{
			let UsecaseInputComboTxt = "";
		
			// pre build combo
			UsecaseInputComboTxt += "<select id=\"UsecaseInputCombo_" + FctId + "\" style=\"width: 200px;\">";
			// fetch list labo
			console.log("Doing combo list Usecase SQL request ...");
			let UsecaseSQLRequestResultObj = [];
			try {
				UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from USECASE where Fct = $a order by Name ASC",
					rowMode: 'array',
					bind: {$a: FctId},
				});
				console.log("End of combo list Usecase SQL request.");
			} catch(ErrorObj) {
				console.log("Echec combo list Usecase SQL request");
			};			
			let NbResultRow = UsecaseSQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				UsecaseInputComboTxt += "<option value=\"0\">*** NO USECASE ***</option>";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					// fetch info
					let TmpResultRow = UsecaseSQLRequestResultObj[i];
					let UsecaseId = TmpResultRow[0];
					let UsecaseNameTxt = TmpResultRow[1];
					if(UsecaseNameTxt == null) UsecaseNameTxt = "UNKNOWN USECASE ID " + UsecaseId;
					UsecaseNameTxt = DoSanitizeNameTxt(UsecaseNameTxt);
					// add to combo
					UsecaseInputComboTxt += "<option id=\"UsecasePoolId" + UsecaseId + "\" value=\"" + UsecaseId + "\" >" + UsecaseNameTxt + "</option>";
				}
			}
			// finalize
			UsecaseInputComboTxt += "</select>";
			return UsecaseInputComboTxt;
		}
		
		// build list product Fct
		function BuildProductFctListsAndCombos(ProductId)
		{
			let FctComboObj = document.getElementById("FctsPoolCombo");
			let Fct2ComboObj = document.getElementById("FctsPoolCombo2");
			let ProductFctListObj = document.getElementById("ListCheckedProductFcts");
			let ProductFct2ListObj = document.getElementById("ListCheckedProductFcts2");
			// NOTA : ProductFctStateListObj array row is : FctId, FctName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductFctStateListObj = [];
			let ProductFct2StateListObj = [];

			// fetch all Fct
			console.log("Doing list Fct SQL request ...");
			let FctSQLRequestResultObj = [];
			try {
				FctSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from FCTS order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list Fct SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Fct SQL request");
			};
			
			// build list Fct state array AND Fct pool combo
			let FctPoolComboTxt = "";
			let Fct2PoolComboTxt = "";
			let NbResultRow = FctSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = FctSQLRequestResultObj[i];
				let FctId = TmpResultRow[0];
				let FctNameTxt = TmpResultRow[1];
				if(FctNameTxt == null) FctNameTxt = "UNKNOWN Fct ID " + FctId;
				FctNameTxt = DoSanitizeNameTxt(FctNameTxt);
				// add to Fct state array
				let ProductFctStateObj = {FctId: FctId, FctName: FctNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				let ProductFct2StateObj = {FctId: FctId, FctName: FctNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				ProductFctStateListObj.push(ProductFctStateObj);
				ProductFct2StateListObj.push(ProductFct2StateObj);
				// add to Fct pool combo
				FctPoolComboTxt += "<option id=\"FctPoolId_" + FctId + "\" value=\"" + i + "\" >" + FctNameTxt + "</option>";
				Fct2PoolComboTxt += "<option id=\"Fct2PoolId_" + FctId + "\" value=\"" + i + "\" >" + FctNameTxt + "</option>";
			}
			// fill Fct combo
			FctComboObj.innerHTML = FctPoolComboTxt;
			Fct2ComboObj.innerHTML = Fct2PoolComboTxt;

			// fetch product Fct
			console.log("Doing product Fct SQL request ...");
			let ProductFctSQLRequestResultObj = [];
			try {
				ProductFctSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Fct from PRODUCT_FCTS where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product Fct SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product Fct SQL request");
			};
			// update Fct state array AND Fct check list 
			let FctCheckListTxt = "";
			let NbFct = ProductFctSQLRequestResultObj.length;
			for(let i = 0; i < NbFct; i++)
			{
				// fetch Fct id
				let TmpResultRow = ProductFctSQLRequestResultObj[i];
				let FctId = TmpResultRow[0];
				// get Fct state array IDX
				let FctPoolObj = document.getElementById("FctPoolId_" + FctId);
				let TmpFctIdx = FctPoolObj.value;
				let ProductFctStateObj = ProductFctStateListObj[TmpFctIdx];
				// update check list
				FctCheckListTxt += "&emsp;<input type=\"checkbox\" id=\"FctCheckListId_" + FctId + "\" onclick=\"CollapseDivPrdFct(" + FctId + ")\" checked>" + ProductFctStateObj.FctName + "</input> (utilisations : " + BuildUsecasePoolCombo(FctId) + " <input type=\"button\" value=\"Append\" onclick=\"DoAppendUsecase(" + FctId + ");\" class='append' />)<br/><div id=\"ListCheckedProductFctUsecase_" + FctId + "\">&emsp;&emsp;Empty list checked usecase</div>";
				// update combo
				FctPoolObj.disabled = true;
				let Fct2PoolObj = document.getElementById("Fct2PoolId_" + FctId);
				Fct2PoolObj.disabled = true;
				// update Plante state array
				ProductFctStateObj.FlgCurrentlyUsedByProduct = true;
				ProductFctStateObj.FlgInCheckList = true;
			}
			// fill Plante check list
			ProductFctListObj.innerHTML = FctCheckListTxt;
			// save Plante state array
			globalThis.PrivateProductFctStateListObj = ProductFctStateListObj;
			
			// fetch product Fct2
			console.log("Doing product Fct2 SQL request ...");
			let ProductFct2SQLRequestResultObj = [];
			try {
				ProductFct2SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Fct from PRODUCT_FCTS2 where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product Fct2 SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product Fct2 SQL request");
			};
			// update Fct2 state array AND Fct2 check list 
			let Fct2CheckListTxt = "";
			let NbFct2 = ProductFct2SQLRequestResultObj.length;
			for(let i = 0; i < NbFct2; i++)
			{
				// fetch Fct2 id
				let TmpResultRow2 = ProductFct2SQLRequestResultObj[i];
				let Fct2Id = TmpResultRow2[0];
				// get Fct2 state array IDX
				let Fct2PoolObj = document.getElementById("Fct2PoolId_" + Fct2Id);
				let TmpFct2Idx = Fct2PoolObj.value;
				let ProductFct2StateObj = ProductFct2StateListObj[TmpFct2Idx];
				// update check list
				Fct2CheckListTxt += "&emsp;<input type=\"checkbox\" id=\"Fct2CheckListId_" + Fct2Id + "\" onclick=\"CollapseDivPrdFct2(" + Fct2Id + ")\" checked>" + ProductFct2StateObj.FctName + "</input> (utilisations : " + BuildUsecasePoolCombo(Fct2Id) + " <input type=\"button\" value=\"Append\" onclick=\"DoAppendUsecase(" + Fct2Id + ");\" class='append' />)<br/><div id=\"ListCheckedProductFctUsecase_" + Fct2Id + "\">&emsp;&emsp;Empty list checked usecase</div>";
				// update combo
				Fct2PoolObj.disabled = true;
				let FctPoolObj = document.getElementById("FctPoolId_" + Fct2Id);
				FctPoolObj.disabled = true;
				// update Plante state array
				ProductFct2StateObj.FlgCurrentlyUsedByProduct = true;
				ProductFct2StateObj.FlgInCheckList = true;
			}
			// fill Plante check list
			ProductFct2ListObj.innerHTML = Fct2CheckListTxt;
			// save Plante state array
			globalThis.PrivateProductFct2StateListObj = ProductFct2StateListObj;
			return;
		}
		
		// append selected fcts to product list, and check it
		function DoAppendFcts()
		{
			let FctsComboObj = document.getElementById("FctsPoolCombo");
			let ProductFctListObj = document.getElementById("ListCheckedProductFcts");
		
			// get combo selection
			let TmpFctIdx = FctsComboObj.value;
			if(TmpFctIdx == null) return;
			// NOTA : ProductFctStateListObj array row is : FctId, FctName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductFctStateObj = globalThis.PrivateProductFctStateListObj[TmpFctIdx];
			// check if already in check list (should never happen)
			if(ProductFctStateObj.FlgInCheckList) return;
			// update check list
			FctId = ProductFctStateObj.FctId;
			
			let UsecaseFctTab = document.createElement('text');
			UsecaseFctTab.innerHTML = "&emsp;";
			ProductFctListObj.appendChild(UsecaseFctTab);
			
			<!-- let FctCheckListObj = document.createElement('input'); -->
			<!-- FctCheckListObj.type = 'checkbox'; -->
			<!-- FctCheckListObj.id = "FctCheckListId_" + FctId; -->
			<!-- FctCheckListObj.checked = true; -->
			<!-- ProductFctListObj.appendChild(FctCheckListObj); -->
			<!-- //... -->
			<!-- let CheckBoxValueTxt = ""; -->
			<!-- CheckBoxValueTxt += ProductFctStateObj.FctName; -->
			<!-- let FctCheckListTextObj = document.createTextNode(CheckBoxValueTxt); -->
			<!-- ProductFctListObj.appendChild(FctCheckListTextObj); -->
			
			//...
			let FctCheckListObj = document.createElement('text');
			FctCheckListObj.innerHTML = "<input type=\"checkbox\" id=\"FctCheckListId_" + FctId + "\" onclick=\"CollapseDivPrdFct(" + FctId + ")\" checked>" + ProductFctStateObj.FctName + "</input>";
			ProductFctListObj.appendChild(FctCheckListObj);
			
			//...
			let UsecaseFctCombo = document.createElement('text');
			UsecaseFctCombo.innerHTML = "&nbsp;(utilisations : " + BuildUsecasePoolCombo(FctId) + " <input type=\"button\" value=\"Append\" onclick=\"DoAppendUsecase(" + FctId + ");\" class='append' />)<br/><div id=\"ListCheckedProductFctUsecase_" + FctId + "\">&emsp;Empty list checked usecase</div>";
			ProductFctListObj.appendChild(UsecaseFctCombo);
			
			// update combo
			let FctPoolObj = document.getElementById("FctPoolId_" + FctId);
			FctPoolObj.disabled = true;
			let Fct2PoolObj = document.getElementById("Fct2PoolId_" + FctId);
			Fct2PoolObj.disabled = true;
			// update state array
			ProductFctStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivateProductFctStateListObj[TmpFctIdx] = ProductFctStateObj;
			BuildProductUsecaseListForAdd(FctId);
			return;
		}
		
		// append selected fcts to product list, and check it
		function DoAppendFcts2()
		{
			let Fcts2ComboObj = document.getElementById("FctsPoolCombo2");
			let ProductFct2ListObj = document.getElementById("ListCheckedProductFcts2");
		
			// get combo selection
			let TmpFct2Idx = Fcts2ComboObj.value;
			if(TmpFct2Idx == null) return;
			// NOTA : ProductFct2StateListObj array row is : FctId, FctName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductFct2StateObj = globalThis.PrivateProductFct2StateListObj[TmpFct2Idx];
			// check if already in check list (should never happen)
			if(ProductFct2StateObj.FlgInCheckList) return;
			// update check list
			Fct2Id = ProductFct2StateObj.FctId;
			
			let UsecaseFct2Tab = document.createElement('text');
			UsecaseFct2Tab.innerHTML = "&emsp;";
			ProductFct2ListObj.appendChild(UsecaseFct2Tab);
			
			<!-- let Fct2CheckListObj = document.createElement('input'); -->
			<!-- Fct2CheckListObj.type = 'checkbox'; -->
			<!-- Fct2CheckListObj.id = "Fct2CheckListId_" + Fct2Id; -->
			<!-- Fct2CheckListObj.checked = true; -->
			<!-- ProductFct2ListObj.appendChild(Fct2CheckListObj); -->
			<!-- //... -->
			<!-- let CheckBoxValueTxt = ""; -->
			<!-- CheckBoxValueTxt += ProductFct2StateObj.FctName; -->
			<!-- let Fct2CheckListTextObj = document.createTextNode(CheckBoxValueTxt); -->
			<!-- ProductFct2ListObj.appendChild(Fct2CheckListTextObj); -->
			
			//...
			let Fct2CheckListObj = document.createElement('text');
			Fct2CheckListObj.innerHTML = "<input type=\"checkbox\" id=\"Fct2CheckListId_" + Fct2Id + "\" onclick=\"CollapseDivPrdFct2(" + Fct2Id + ")\" checked>" + ProductFct2StateObj.FctName + "</input>";
			ProductFct2ListObj.appendChild(Fct2CheckListObj);
			
			//...
			let UsecaseFct2Combo = document.createElement('text');
			UsecaseFct2Combo.innerHTML = "&nbsp;(utilisations : " + BuildUsecasePoolCombo(Fct2Id) + " <input type=\"button\" value=\"Append\" onclick=\"DoAppendUsecase(" + Fct2Id + ");\" class='append' />)<br/><div id=\"ListCheckedProductFctUsecase_" + Fct2Id + "\">&emsp;Empty list checked usecase</div>";
			ProductFct2ListObj.appendChild(UsecaseFct2Combo);
			
			// update combo
			let FctPoolObj = document.getElementById("FctPoolId_" + Fct2Id);
			FctPoolObj.disabled = true;
			let Fct2PoolObj = document.getElementById("Fct2PoolId_" + Fct2Id);
			Fct2PoolObj.disabled = true;
			// update state array
			ProductFct2StateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivateProductFct2StateListObj[TmpFct2Idx] = ProductFct2StateObj;
			BuildProductUsecaseListForAdd(Fct2Id);
			return;
		}
		
		// build list product usecase
		function BuildProductUsecaseList(ProductId)
		{
			//fetch product fct
			console.log("Doing product fct SQL request ...");
			let ProductFctSQLRequestResultObj = [];
			try {
				ProductFctSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Fct from PRODUCT_FCTS where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product Fct SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product Fct SQL request");
			};
			//fetch product fct2
			console.log("Doing product fct2 SQL request ...");
			let ProductFct2SQLRequestResultObj = [];
			try {
				ProductFct2SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Fct from PRODUCT_FCTS2 where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product Fct2 SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product Fct2 SQL request");
			};
			
			// NOTA : ProductUsecaseStateListObj array row is : UsecaseId, UsecaseName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductUsecaseStateListObj = [];

			//pour tous les fcts affiches
			let NbResultRow1 = ProductFctSQLRequestResultObj.length;
			let NbResultRow = NbResultRow1 + ProductFct2SQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch fct id
				let TmpResultRow = [];
				if(i < NbResultRow1)
				{
					TmpResultRow = ProductFctSQLRequestResultObj[i];
				}
				else
				{
					TmpResultRow = ProductFct2SQLRequestResultObj[i-NbResultRow1];
				}
				let FctId = TmpResultRow[1];
				
				//Get Div Id
				let ProductFctListObj = document.getElementById("ListCheckedProductFctUsecase_" + FctId);
				//init text
				let UsecaseCheckListTxt = "";
				
				// fetch all usecase linked to fct
				console.log("Doing list usecase SQL request ...");
				let UsecaseSQLRequestResultObj = [];
				try {
					UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select Id,Name from USECASE where Fct = $a order by Name ASC",
						rowMode: 'array',
						bind: {$a: FctId},
					});
					console.log("End of list usecase SQL request.");
				} catch(ErrorObj) {
					console.log("Echec list usecase SQL request");
				};
			
				// build list usecase state array
				let CurrentUsecasesIds = [];
				let NbUsecaseResultRow = UsecaseSQLRequestResultObj.length;
				for(let j = 0; j < NbUsecaseResultRow; j++)
				{
					// fetch info
					let TmpUsecaseResultRow = UsecaseSQLRequestResultObj[j];
					let UsecaseId = TmpUsecaseResultRow[0];
					CurrentUsecasesIds.push(UsecaseId);
					let UsecaseNameTxt = TmpUsecaseResultRow[1];
					if(UsecaseNameTxt == null) UsecaseNameTxt = "UNKNOWN USECASE ID " + UsecaseId;
					UsecaseNameTxt = DoSanitizeNameTxt(UsecaseNameTxt);
					// add to usecase state array
					let ProductUsecaseStateObj = {UsecaseId: UsecaseId, UsecaseName: UsecaseNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
					ProductUsecaseStateListObj.push(ProductUsecaseStateObj);
				}

				// fetch product use cases
				console.log("Doing product usecases SQL request ...");
				let ProductUsecasesSQLRequestResultObj = [];
				try {
					ProductUsecasesSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select Usecase from PRODUCT_USECASE where Product = $a",
						rowMode: 'array',
						bind: {$a: ProductId},
					});
					console.log("End of product usecases SQL request.");
				} catch(ErrorObj) {
					console.log("Echec product usecases SQL request");
				};
				
				// update usecase state array AND usecase check list 
				let NbUsecase = ProductUsecasesSQLRequestResultObj.length;
				for(let j = 0; j < NbUsecase; j++)
				{
					// fetch usecase id
					let TmpResultRow = ProductUsecasesSQLRequestResultObj[j];
					let UsecaseId = TmpResultRow[0];
					let NbCurrentUsecase = CurrentUsecasesIds.length;
					for(let k=0; k < NbCurrentUsecase; k++)
					{
						if (UsecaseId == CurrentUsecasesIds[k])
						{
							// get usecase state array IDX
							let UsecasePoolObj = document.getElementById("UsecasePoolId" + UsecaseId);
							
							NbUsecases = ProductUsecaseStateListObj.length;
							let ProductUsecaseStateObj = [];
							let TmpUsecaseIdx = 0;
							for(let l=0; l < NbUsecases; l++)
							{
								if(ProductUsecaseStateListObj[l].UsecaseId == UsecaseId)
								{
									ProductUsecaseStateObj = ProductUsecaseStateListObj[l];
									TmpUsecaseIdx = l;
								}
							}
							// update check list
							UsecaseCheckListTxt += "&emsp;&emsp;<input type=\"checkbox\" id=\"UsecaseCheckListId_" + UsecaseId + "\" onclick=\"CollapseDivPrdUsecase(" + ProductId + "," + UsecaseId + ")\" checked>" + ProductUsecaseStateObj.UsecaseName + "</input> (en association avec : " + BuildPlantePoolCombo(UsecaseId) + " <input type=\"button\" value=\"Append\" onclick=\"DoAppendPlante(" + UsecaseId + ");\" class='append' />)<br/><div id=\"ListCheckedProductUsecasePlante" + ProductId + "_" + UsecaseId + "\">&emsp;&emsp;&emsp;Empty list checked usecase plante</div>";
							// update combo
							UsecasePoolObj.disabled = true;
							// update usecase state array
							ProductUsecaseStateObj.FlgCurrentlyUsedByProduct = true;
							ProductUsecaseStateObj.FlgInCheckList = true;
						}
					}
				}
				// fill usecase check list
				ProductFctListObj.innerHTML = UsecaseCheckListTxt;
			}
			// save usecase state array
			globalThis.PrivateProductUsecaseStateListObj = ProductUsecaseStateListObj;			
			return;
		}
		
		// append selected Toxicite to product list, and check it
		function DoAppendToxicite()
		{
			let ToxiciteComboObj = document.getElementById("ToxicitePoolCombo");
			let ProductToxiciteListObj = document.getElementById("ListCheckedProductToxicite");
		
			// get combo selection
			let TmpToxiciteIdx = ToxiciteComboObj.value;
			if(TmpToxiciteIdx == null) return;
			// NOTA : ProductToxiciteStateListObj array row is : ToxiciteId, ToxiciteName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductToxiciteStateObj = globalThis.PrivateProductToxiciteStateListObj[TmpToxiciteIdx];
			// check if already in check list (should never happen)
			if(ProductToxiciteStateObj.FlgInCheckList) return;
			// update check list
			ToxiciteId = ProductToxiciteStateObj.ToxiciteId;
			//let ToxiciteCheckListTxt = "";
			//ToxiciteCheckListTxt += "<input type=\"checkbox\" id=\"ToxiciteCheckListId_" + ToxiciteId + "\" checked>" + ProductToxiciteStateObj.ToxiciteName + "</input><br/>";			
			//ProductToxiciteListObj.innerHTML += ToxiciteCheckListTxt;
			
			let ToxTab = document.createElement('text');
			ToxTab.innerHTML = "&emsp;";
			ProductToxiciteListObj.appendChild(ToxTab);
			
			let ToxiciteCheckListObj = document.createElement('input');
			ToxiciteCheckListObj.type = 'checkbox';
			ToxiciteCheckListObj.id = "ToxiciteCheckListId_" + ToxiciteId;
			ToxiciteCheckListObj.checked = true;
			ProductToxiciteListObj.appendChild(ToxiciteCheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += ProductToxiciteStateObj.ToxiciteName;
			let ToxiciteCheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			ProductToxiciteListObj.appendChild(ToxiciteCheckListTextObj);
			//...
			ProductToxiciteListObj.appendChild(document.createElement('br'));
			
			// update combo
			let ToxicitePoolObj = document.getElementById("ToxicitePoolId_" + ToxiciteId);
			ToxicitePoolObj.disabled = true;			
			// update state array
			ProductToxiciteStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivateProductToxiciteStateListObj[TmpToxiciteIdx] = ProductToxiciteStateObj;
			return;
		}
		
		// build list product Toxicite
		function BuildProductToxiciteListAndCombo(ProductId)
		{
			let ToxiciteComboObj = document.getElementById("ToxicitePoolCombo");
			let ProductToxiciteListObj = document.getElementById("ListCheckedProductToxicite");
			// NOTA : ProductToxiciteStateListObj array row is : ToxiciteId, ToxiciteName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductToxiciteStateListObj = [];

			// fetch all Toxicite
			console.log("Doing list Toxicite SQL request ...");
			let ToxiciteSQLRequestResultObj = [];
			try {
				ToxiciteSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from TOXICITE order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list Toxicite SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Toxicite SQL request");
			};
			// build list Toxicite state array AND Toxicite pool combo
			let ToxicitePoolComboTxt = "";
			let NbResultRow = ToxiciteSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = ToxiciteSQLRequestResultObj[i];
				let ToxiciteId = TmpResultRow[0];
				let ToxiciteNameTxt = TmpResultRow[1];
				if(ToxiciteNameTxt == null) ToxiciteNameTxt = "UNKNOWN Toxicite ID " + ToxiciteId;
				ToxiciteNameTxt = DoSanitizeNameTxt(ToxiciteNameTxt);
				// add to Toxicite state array
				let ProductToxiciteStateObj = {ToxiciteId: ToxiciteId, ToxiciteName: ToxiciteNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				ProductToxiciteStateListObj.push(ProductToxiciteStateObj);
				// add to Toxicite pool combo
				ToxicitePoolComboTxt += "<option id=\"ToxicitePoolId_" + ToxiciteId + "\" value=\"" + i + "\" >" + ToxiciteNameTxt + "</option>";
			}
			// fill Toxicite combo
			ToxiciteComboObj.innerHTML = ToxicitePoolComboTxt;

			// fetch product use cases
			console.log("Doing product Toxicites SQL request ...");
			let ProductToxicitesSQLRequestResultObj = [];
			try {
				ProductToxicitesSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Toxicite from PRODUCT_TOXICITE where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product Toxicites SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product Toxicites SQL request");
			};
			// update Toxicite state array AND Toxicite check list 
			let ToxiciteCheckListTxt = "";
			let NbToxicite = ProductToxicitesSQLRequestResultObj.length;
			for(let i = 0; i < NbToxicite; i++)
			{
				// fetch Toxicite id
				let TmpResultRow = ProductToxicitesSQLRequestResultObj[i];
				let ToxiciteId = TmpResultRow[0];
				// get Toxicite state array IDX
				let ToxicitePoolObj = document.getElementById("ToxicitePoolId_" + ToxiciteId);
				let TmpToxiciteIdx = ToxicitePoolObj.value;
				let ProductToxiciteStateObj = ProductToxiciteStateListObj[TmpToxiciteIdx];
				// update check list
				ToxiciteCheckListTxt += "&emsp;<input type=\"checkbox\" id=\"ToxiciteCheckListId_" + ToxiciteId + "\" checked>" + ProductToxiciteStateObj.ToxiciteName + "</input><br/>";
				// update combo
				ToxicitePoolObj.disabled = true;
				// update Toxicite state array
				ProductToxiciteStateObj.FlgCurrentlyUsedByProduct = true;
				ProductToxiciteStateObj.FlgInCheckList = true;
			}
			// fill Toxicite check list
			ProductToxiciteListObj.innerHTML = ToxiciteCheckListTxt;
			// save Toxicite state array
			globalThis.PrivateProductToxiciteStateListObj = ProductToxiciteStateListObj;			
			return;
		}
		
		// append selected Effet2 to product list, and check it
		function DoAppendEffet2()
		{
			let Effet2ComboObj = document.getElementById("Effet2PoolCombo");
			let ProductEffet2ListObj = document.getElementById("ListCheckedProductEffet2");
		
			// get combo selection
			let TmpEffet2Idx = Effet2ComboObj.value;
			if(TmpEffet2Idx == null) return;
			// NOTA : ProductEffet2StateListObj array row is : Effet2Id, Effet2Name, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductEffet2StateObj = globalThis.PrivateProductEffet2StateListObj[TmpEffet2Idx];
			// check if already in check list (should never happen)
			if(ProductEffet2StateObj.FlgInCheckList) return;
			// update check list
			Effet2Id = ProductEffet2StateObj.Effet2Id;
			
			let Effet2Tab = document.createElement('text');
			Effet2Tab.innerHTML = "&emsp;";
			ProductEffet2ListObj.appendChild(Effet2Tab);
			
			let Effet2CheckListObj = document.createElement('input');
			Effet2CheckListObj.type = 'checkbox';
			Effet2CheckListObj.id = "Effet2CheckListId_" + Effet2Id;
			Effet2CheckListObj.checked = true;
			ProductEffet2ListObj.appendChild(Effet2CheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += ProductEffet2StateObj.Effet2Name;
			let Effet2CheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			ProductEffet2ListObj.appendChild(Effet2CheckListTextObj);
			//...
			ProductEffet2ListObj.appendChild(document.createElement('br'));
			
			// update combo
			let Effet2PoolObj = document.getElementById("Effet2PoolId_" + Effet2Id);
			Effet2PoolObj.disabled = true;			
			// update state array
			ProductEffet2StateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivateProductEffet2StateListObj[TmpEffet2Idx] = ProductEffet2StateObj;
			return;
		}
		
		// build list product Effet2
		function BuildProductEffet2ListAndCombo(ProductId)
		{
			let Effet2ComboObj = document.getElementById("Effet2PoolCombo");
			let ProductEffet2ListObj = document.getElementById("ListCheckedProductEffet2");
			// NOTA : ProductEffet2StateListObj array row is : Effet2Id, Effet2Name, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductEffet2StateListObj = [];

			// fetch all Effet2
			console.log("Doing list Effet2 SQL request ...");
			let Effet2SQLRequestResultObj = [];
			try {
				Effet2SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from EFFET2 order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list Effet2 SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Effet2 SQL request");
			};
			// build list Effet2 state array AND Effet2 pool combo
			let Effet2PoolComboTxt = "";
			let NbResultRow = Effet2SQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = Effet2SQLRequestResultObj[i];
				let Effet2Id = TmpResultRow[0];
				let Effet2NameTxt = TmpResultRow[1];
				if(Effet2NameTxt == null) Effet2NameTxt = "UNKNOWN Effet2 ID " + Effet2Id;
				Effet2NameTxt = DoSanitizeNameTxt(Effet2NameTxt);
				// add to Effet2 state array
				let ProductEffet2StateObj = {Effet2Id: Effet2Id, Effet2Name: Effet2NameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				ProductEffet2StateListObj.push(ProductEffet2StateObj);
				// add to Effet2 pool combo
				Effet2PoolComboTxt += "<option id=\"Effet2PoolId_" + Effet2Id + "\" value=\"" + i + "\" >" + Effet2NameTxt + "</option>";
			}
			// fill Effet2 combo
			Effet2ComboObj.innerHTML = Effet2PoolComboTxt;

			// fetch product Effet2
			console.log("Doing product Effet2 SQL request ...");
			let ProductEffet2SQLRequestResultObj = [];
			try {
				ProductEffet2SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Effet2 from PRODUCT_EFFET2 where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product Effet2 SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product Effet2 SQL request");
			};
			// update Effet2 state array AND Effet2 check list 
			let Effet2CheckListTxt = "";
			let NbEffet2 = ProductEffet2SQLRequestResultObj.length;
			for(let i = 0; i < NbEffet2; i++)
			{
				// fetch Effet2 id
				let TmpResultRow = ProductEffet2SQLRequestResultObj[i];
				let Effet2Id = TmpResultRow[0];
				// get Effet2 state array IDX
				let Effet2PoolObj = document.getElementById("Effet2PoolId_" + Effet2Id);
				let TmpEffet2Idx = Effet2PoolObj.value;
				let ProductEffet2StateObj = ProductEffet2StateListObj[TmpEffet2Idx];
				// update check list
				Effet2CheckListTxt += "&emsp;<input type=\"checkbox\" id=\"Effet2CheckListId_" + Effet2Id + "\" checked>" + ProductEffet2StateObj.Effet2Name + "</input><br/>";
				// update combo
				Effet2PoolObj.disabled = true;
				// update Effet2 state array
				ProductEffet2StateObj.FlgCurrentlyUsedByProduct = true;
				ProductEffet2StateObj.FlgInCheckList = true;
			}
			// fill Effet2 check list
			ProductEffet2ListObj.innerHTML = Effet2CheckListTxt;
			// save Effet2 state array
			globalThis.PrivateProductEffet2StateListObj = ProductEffet2StateListObj;			
			return;
		}
		
		// append selected Effet2 to plante list, and check it
		function DoAppendPlEffet2()
		{
			let Effet2ComboObj = document.getElementById("Effet2PlPoolCombo");
			let PlanteEffet2ListObj = document.getElementById("ListCheckedPlanteEffet2");
		
			// get combo selection
			let TmpEffet2Idx = Effet2ComboObj.value;
			if(TmpEffet2Idx == null) return;
			// NOTA : PlanteEffet2StateListObj array row is : Effet2Id, Effet2Name, FlgCurrentlyUsedByProduct, FlgInCheckList
			let PlanteEffet2StateObj = globalThis.PrivatePlanteEffet2StateListObj[TmpEffet2Idx];
			// check if already in check list (should never happen)
			if(PlanteEffet2StateObj.FlgInCheckList) return;
			// update check list
			Effet2Id = PlanteEffet2StateObj.Effet2Id;
			
			let Effet2Tab = document.createElement('text');
			Effet2Tab.innerHTML = "&emsp;";
			PlanteEffet2ListObj.appendChild(Effet2Tab);
			
			let Effet2CheckListObj = document.createElement('input');
			Effet2CheckListObj.type = 'checkbox';
			Effet2CheckListObj.id = "Effet2PlCheckListId_" + Effet2Id;
			Effet2CheckListObj.checked = true;
			PlanteEffet2ListObj.appendChild(Effet2CheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += PlanteEffet2StateObj.Effet2Name;
			let Effet2CheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			PlanteEffet2ListObj.appendChild(Effet2CheckListTextObj);
			//...
			PlanteEffet2ListObj.appendChild(document.createElement('br'));
			
			// update combo
			let Effet2PoolObj = document.getElementById("Effet2PlPoolId_" + Effet2Id);
			Effet2PoolObj.disabled = true;			
			// update state array
			PlanteEffet2StateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivatePlanteEffet2StateListObj[TmpEffet2Idx] = PlanteEffet2StateObj;
			return;
		}
		
		// build list plante Effet2
		function BuildPlanteEffet2ListAndCombo(PlanteId)
		{
			let Effet2ComboObj = document.getElementById("Effet2PlPoolCombo");
			let PlanteEffet2ListObj = document.getElementById("ListCheckedPlanteEffet2");
			// NOTA : PlanteEffet2StateListObj array row is : Effet2Id, Effet2Name, FlgCurrentlyUsedByProduct, FlgInCheckList
			let PlanteEffet2StateListObj = [];

			// fetch all Effet2
			console.log("Doing list Effet2 SQL request ...");
			let Effet2SQLRequestResultObj = [];
			try {
				Effet2SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from EFFET2 order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list Effet2 SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Effet2 SQL request");
			};
			// build list Effet2 state array AND Effet2 pool combo
			let Effet2PoolComboTxt = "";
			let NbResultRow = Effet2SQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = Effet2SQLRequestResultObj[i];
				let Effet2Id = TmpResultRow[0];
				let Effet2NameTxt = TmpResultRow[1];
				if(Effet2NameTxt == null) Effet2NameTxt = "UNKNOWN Effet2 ID " + Effet2Id;
				Effet2NameTxt = DoSanitizeNameTxt(Effet2NameTxt);
				// add to Effet2 state array
				let PlanteEffet2StateObj = {Effet2Id: Effet2Id, Effet2Name: Effet2NameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				PlanteEffet2StateListObj.push(PlanteEffet2StateObj);
				// add to Effet2 pool combo
				Effet2PoolComboTxt += "<option id=\"Effet2PlPoolId_" + Effet2Id + "\" value=\"" + i + "\" >" + Effet2NameTxt + "</option>";
			}
			// fill Effet2 combo
			Effet2ComboObj.innerHTML = Effet2PoolComboTxt;

			// fetch product Effet2
			console.log("Doing plante Effet2 SQL request ...");
			let PlanteEffet2SQLRequestResultObj = [];
			try {
				PlanteEffet2SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Effet2 from PLANTE_EFFET2 where Plante = $a",
					rowMode: 'array',
					bind: {$a: PlanteId},
				});
				console.log("End of plante Effet2 SQL request.");
			} catch(ErrorObj) {
				console.log("Echec plante Effet2 SQL request");
			};
			// update Effet2 state array AND Effet2 check list 
			let Effet2CheckListTxt = "";
			let NbEffet2 = PlanteEffet2SQLRequestResultObj.length;
			//console.log("Nb = " + NbEffet2);
			for(let i = 0; i < NbEffet2; i++)
			{
				// fetch Effet2 id
				let TmpResultRow = PlanteEffet2SQLRequestResultObj[i];
				let Effet2Id = TmpResultRow[0];
				// get Effet2 state array IDX
				let Effet2PoolObj = document.getElementById("Effet2PlPoolId_" + Effet2Id);
				let TmpEffet2Idx = Effet2PoolObj.value;
				let PlanteEffet2StateObj = PlanteEffet2StateListObj[TmpEffet2Idx];
				// update check list
				Effet2CheckListTxt += "&emsp;<input type=\"checkbox\" id=\"Effet2PlCheckListId_" + Effet2Id + "\" checked>" + PlanteEffet2StateObj.Effet2Name + "</input><br/>";
				// update combo
				Effet2PoolObj.disabled = true;
				// update Effet2 state array
				PlanteEffet2StateObj.FlgCurrentlyUsedByProduct = true;
				PlanteEffet2StateObj.FlgInCheckList = true;
			}
			// fill Effet2 check list
			PlanteEffet2ListObj.innerHTML = Effet2CheckListTxt;
			// save Effet2 state array
			globalThis.PrivatePlanteEffet2StateListObj = PlanteEffet2StateListObj;			
			return;
		}
		
		// append selected CtrIndic to product list, and check it
		function DoAppendCtrIndic()
		{
			let CtrIndicComboObj = document.getElementById("CtrIndicPoolCombo");
			let ProductCtrIndicListObj = document.getElementById("ListCheckedProductCtrIndic");
		
			// get combo selection
			let TmpCtrIndicIdx = CtrIndicComboObj.value;
			if(TmpCtrIndicIdx == null) return;
			// NOTA : ProductCtrIndicStateListObj array row is : CtrIndicId, CtrIndicName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductCtrIndicStateObj = globalThis.PrivateProductCtrIndicStateListObj[TmpCtrIndicIdx];
			// check if already in check list (should never happen)
			if(ProductCtrIndicStateObj.FlgInCheckList) return;
			// update check list
			CtrIndicId = ProductCtrIndicStateObj.CtrIndicId;
			
			let CtrIndicTab = document.createElement('text');
			CtrIndicTab.innerHTML = "&emsp;";
			ProductCtrIndicListObj.appendChild(CtrIndicTab);
			
			let CtrIndicCheckListObj = document.createElement('input');
			CtrIndicCheckListObj.type = 'checkbox';
			CtrIndicCheckListObj.id = "CtrIndicCheckListId_" + CtrIndicId;
			CtrIndicCheckListObj.checked = true;
			ProductCtrIndicListObj.appendChild(CtrIndicCheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += ProductCtrIndicStateObj.CtrIndicName;
			let CtrIndicCheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			ProductCtrIndicListObj.appendChild(CtrIndicCheckListTextObj);
			//...
			ProductCtrIndicListObj.appendChild(document.createElement('br'));
			
			// update combo
			let CtrIndicPoolObj = document.getElementById("CtrIndicPoolId_" + CtrIndicId);
			CtrIndicPoolObj.disabled = true;			
			// update state array
			ProductCtrIndicStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivateProductCtrIndicStateListObj[TmpCtrIndicIdx] = ProductCtrIndicStateObj;
			return;
		}
		
		// build list product CtrIndic
		function BuildProductCtrIndicListAndCombo(ProductId)
		{
			let CtrIndicComboObj = document.getElementById("CtrIndicPoolCombo");
			let ProductCtrIndicListObj = document.getElementById("ListCheckedProductCtrIndic");
			// NOTA : ProductCtrIndicStateListObj array row is : CtrIndicId, CtrIndicName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let ProductCtrIndicStateListObj = [];

			// fetch all CtrIndic
			console.log("Doing list CtrIndic SQL request ...");
			let CtrIndicSQLRequestResultObj = [];
			try {
				CtrIndicSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from CTRINDIC order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list CtrIndic SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list CtrIndic SQL request");
			};
			
			// build list CtrIndic state array AND CtrIndic pool combo
			let CtrIndicPoolComboTxt = "";
			let NbResultRow = CtrIndicSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = CtrIndicSQLRequestResultObj[i];
				let CtrIndicId = TmpResultRow[0];
				let CtrIndicNameTxt = TmpResultRow[1];
				if(CtrIndicNameTxt == null) CtrIndicNameTxt = "UNKNOWN CtrIndic ID " + CtrIndicId;
				CtrIndicNameTxt = DoSanitizeNameTxt(CtrIndicNameTxt);
				// add to CtrIndic state array
				let ProductCtrIndicStateObj = {CtrIndicId: CtrIndicId, CtrIndicName: CtrIndicNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				ProductCtrIndicStateListObj.push(ProductCtrIndicStateObj);
				// add to CtrIndic pool combo
				CtrIndicPoolComboTxt += "<option id=\"CtrIndicPoolId_" + CtrIndicId + "\" value=\"" + i + "\" >" + CtrIndicNameTxt + "</option>";
			}
			// fill CtrIndic combo
			CtrIndicComboObj.innerHTML = CtrIndicPoolComboTxt;

			// fetch product CtrIndic
			console.log("Doing product CtrIndic SQL request ...");
			let ProductCtrIndicSQLRequestResultObj = [];
			try {
				ProductCtrIndicSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select CtrIndic from PRODUCT_CTRINDIC where Product = $a",
					rowMode: 'array',
					bind: {$a: ProductId},
				});
				console.log("End of product CtrIndic SQL request.");
			} catch(ErrorObj) {
				console.log("Echec product CtrIndic SQL request");
			};
			// update CtrIndic state array AND CtrIndic check list 
			let CtrIndicCheckListTxt = "";
			let NbCtrIndic = ProductCtrIndicSQLRequestResultObj.length;
			for(let i = 0; i < NbCtrIndic; i++)
			{
				// fetch CtrIndic id
				let TmpResultRow = ProductCtrIndicSQLRequestResultObj[i];
				let CtrIndicId = TmpResultRow[0];
				// get CtrIndic state array IDX
				let CtrIndicPoolObj = document.getElementById("CtrIndicPoolId_" + CtrIndicId);
				let TmpCtrIndicIdx = CtrIndicPoolObj.value;
				let ProductCtrIndicStateObj = ProductCtrIndicStateListObj[TmpCtrIndicIdx];
				// update check list
				CtrIndicCheckListTxt += "&emsp;<input type=\"checkbox\" id=\"CtrIndicCheckListId_" + CtrIndicId + "\" checked>" + ProductCtrIndicStateObj.CtrIndicName + "</input><br/>";
				// update combo
				CtrIndicPoolObj.disabled = true;
				// update CtrIndic state array
				ProductCtrIndicStateObj.FlgCurrentlyUsedByProduct = true;
				ProductCtrIndicStateObj.FlgInCheckList = true;
			}
			// fill CtrIndic check list
			ProductCtrIndicListObj.innerHTML = CtrIndicCheckListTxt;
			// save CtrIndic state array
			globalThis.PrivateProductCtrIndicStateListObj = ProductCtrIndicStateListObj;			
			return;
		}
		
		// append selected CtrIndic to plante list, and check it
		function DoAppendPlCtrIndic()
		{
			let CtrIndicComboObj = document.getElementById("CtrIndicPlPoolCombo");
			let PlanteCtrIndicListObj = document.getElementById("ListCheckedPlanteCtrIndic");
		
			// get combo selection
			let TmpCtrIndicIdx = CtrIndicComboObj.value;
			if(TmpCtrIndicIdx == null) return;
			// NOTA : PlanteCtrIndicStateListObj array row is : CtrIndicId, CtrIndicName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let PlanteCtrIndicStateObj = globalThis.PrivatePlanteCtrIndicStateListObj[TmpCtrIndicIdx];
			// check if already in check list (should never happen)
			if(PlanteCtrIndicStateObj.FlgInCheckList) return;
			// update check list
			CtrIndicId = PlanteCtrIndicStateObj.CtrIndicId;
			
			let CtrIndicTab = document.createElement('text');
			CtrIndicTab.innerHTML = "&emsp;";
			PlanteCtrIndicListObj.appendChild(CtrIndicTab);
			
			let CtrIndicCheckListObj = document.createElement('input');
			CtrIndicCheckListObj.type = 'checkbox';
			CtrIndicCheckListObj.id = "CtrIndicPlCheckListId_" + CtrIndicId;
			CtrIndicCheckListObj.checked = true;
			PlanteCtrIndicListObj.appendChild(CtrIndicCheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += PlanteCtrIndicStateObj.CtrIndicName;
			let CtrIndicCheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			PlanteCtrIndicListObj.appendChild(CtrIndicCheckListTextObj);
			//...
			PlanteCtrIndicListObj.appendChild(document.createElement('br'));
			
			// update combo
			let CtrIndicPoolObj = document.getElementById("CtrIndicPlPoolId_" + CtrIndicId);
			CtrIndicPoolObj.disabled = true;			
			// update state array
			PlanteCtrIndicStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivatePlanteCtrIndicStateListObj[TmpCtrIndicIdx] = PlanteCtrIndicStateObj;
			return;
		}
		
		// build list product CtrIndic
		function BuildPlanteCtrIndicListAndCombo(PlanteId)
		{
			let CtrIndicComboObj = document.getElementById("CtrIndicPlPoolCombo");
			let PlanteCtrIndicListObj = document.getElementById("ListCheckedPlanteCtrIndic");
			// NOTA : PlanteCtrIndicStateListObj array row is : CtrIndicId, CtrIndicName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let PlanteCtrIndicStateListObj = [];

			// fetch all CtrIndic
			console.log("Doing list CtrIndic SQL request ...");
			let CtrIndicSQLRequestResultObj = [];
			try {
				CtrIndicSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from CTRINDIC order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list CtrIndic SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list CtrIndic SQL request");
			};
			
			// build list CtrIndic state array AND CtrIndic pool combo
			let CtrIndicPoolComboTxt = "";
			let NbResultRow = CtrIndicSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = CtrIndicSQLRequestResultObj[i];
				let CtrIndicId = TmpResultRow[0];
				let CtrIndicNameTxt = TmpResultRow[1];
				if(CtrIndicNameTxt == null) CtrIndicNameTxt = "UNKNOWN CtrIndic ID " + CtrIndicId;
				CtrIndicNameTxt = DoSanitizeNameTxt(CtrIndicNameTxt);
				// add to CtrIndic state array
				let PlanteCtrIndicStateObj = {CtrIndicId: CtrIndicId, CtrIndicName: CtrIndicNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				PlanteCtrIndicStateListObj.push(PlanteCtrIndicStateObj);
				// add to CtrIndic pool combo
				CtrIndicPoolComboTxt += "<option id=\"CtrIndicPlPoolId_" + CtrIndicId + "\" value=\"" + i + "\" >" + CtrIndicNameTxt + "</option>";
			}
			// fill CtrIndic combo
			CtrIndicComboObj.innerHTML = CtrIndicPoolComboTxt;

			// fetch plante CtrIndic
			console.log("Doing plante CtrIndic SQL request ...");
			let PlanteCtrIndicSQLRequestResultObj = [];
			try {
				PlanteCtrIndicSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select CtrIndic from PLANTE_CTRINDIC where Plante = $a",
					rowMode: 'array',
					bind: {$a: PlanteId},
				});
				console.log("End of plante CtrIndic SQL request.");
			} catch(ErrorObj) {
				console.log("Echec plante CtrIndic SQL request");
			};
			// update CtrIndic state array AND CtrIndic check list 
			let CtrIndicCheckListTxt = "";
			let NbCtrIndic = PlanteCtrIndicSQLRequestResultObj.length;
			for(let i = 0; i < NbCtrIndic; i++)
			{
				// fetch CtrIndic id
				let TmpResultRow = PlanteCtrIndicSQLRequestResultObj[i];
				let CtrIndicId = TmpResultRow[0];
				// get CtrIndic state array IDX
				let CtrIndicPoolObj = document.getElementById("CtrIndicPlPoolId_" + CtrIndicId);
				let TmpCtrIndicIdx = CtrIndicPoolObj.value;
				let PlanteCtrIndicStateObj = PlanteCtrIndicStateListObj[TmpCtrIndicIdx];
				// update check list
				CtrIndicCheckListTxt += "&emsp;<input type=\"checkbox\" id=\"CtrIndicPlCheckListId_" + CtrIndicId + "\" checked>" + PlanteCtrIndicStateObj.CtrIndicName + "</input><br/>";
				// update combo
				CtrIndicPoolObj.disabled = true;
				// update CtrIndic state array
				PlanteCtrIndicStateObj.FlgCurrentlyUsedByProduct = true;
				PlanteCtrIndicStateObj.FlgInCheckList = true;
			}
			// fill CtrIndic check list
			PlanteCtrIndicListObj.innerHTML = CtrIndicCheckListTxt;
			// save CtrIndic state array
			globalThis.PrivatePlanteCtrIndicStateListObj = PlanteCtrIndicStateListObj;			
			return;
		}
		
		// append selected UsePart to plante list, and check it
		function DoAppendPlUsePart()
		{
			let UsePartComboObj = document.getElementById("UsePartPlPoolCombo");
			let PlanteUsePartListObj = document.getElementById("ListCheckedPlanteUsePart");
		
			// get combo selection
			let TmpUsePartIdx = UsePartComboObj.value;
			if(TmpUsePartIdx == null) return;
			// NOTA : PlanteUsePartStateListObj array row is : UsePartId, UsePartName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let PlanteUsePartStateObj = globalThis.PrivatePlanteUsePartStateListObj[TmpUsePartIdx];
			// check if already in check list (should never happen)
			if(PlanteUsePartStateObj.FlgInCheckList) return;
			// update check list
			UsePartId = PlanteUsePartStateObj.UsePartId;
			
			let UsePartTab = document.createElement('text');
			UsePartTab.innerHTML = "&emsp;";
			PlanteUsePartListObj.appendChild(UsePartTab);
			
			let UsePartCheckListObj = document.createElement('input');
			UsePartCheckListObj.type = 'checkbox';
			UsePartCheckListObj.id = "UsePartPlCheckListId_" + UsePartId;
			UsePartCheckListObj.checked = true;
			PlanteUsePartListObj.appendChild(UsePartCheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += PlanteUsePartStateObj.UsePartName;
			let UsePartCheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			PlanteUsePartListObj.appendChild(UsePartCheckListTextObj);
			//...
			PlanteUsePartListObj.appendChild(document.createElement('br'));
			
			// update combo
			let UsePartPoolObj = document.getElementById("UsePartPlPoolId_" + UsePartId);
			UsePartPoolObj.disabled = true;			
			// update state array
			PlanteUsePartStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivatePlanteUsePartStateListObj[TmpUsePartIdx] = PlanteUsePartStateObj;
			return;
		}
		
		// build list product UsePart
		function BuildPlanteUsePartListAndCombo(PlanteId)
		{
			let UsePartComboObj = document.getElementById("UsePartPlPoolCombo");
			let PlanteUsePartListObj = document.getElementById("ListCheckedPlanteUsePart");
			// NOTA : PlanteUsePartStateListObj array row is : UsePartId, UsePartName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let PlanteUsePartStateListObj = [];

			// fetch all UsePart
			console.log("Doing list UsePart SQL request ...");
			let UsePartSQLRequestResultObj = [];
			try {
				UsePartSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from USEPART order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list UsePart SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list UsePart SQL request");
			};
			
			// build list UsePart state array AND UsePart pool combo
			let UsePartPoolComboTxt = "";
			let NbResultRow = UsePartSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = UsePartSQLRequestResultObj[i];
				let UsePartId = TmpResultRow[0];
				let UsePartNameTxt = TmpResultRow[1];
				if(UsePartNameTxt == null) UsePartNameTxt = "UNKNOWN UsePart ID " + UsePartId;
				UsePartNameTxt = DoSanitizeNameTxt(UsePartNameTxt);
				// add to UsePart state array
				let PlanteUsePartStateObj = {UsePartId: UsePartId, UsePartName: UsePartNameTxt, FlgCurrentlyUsedByProduct: false, FlgInCheckList: false};
				PlanteUsePartStateListObj.push(PlanteUsePartStateObj);
				// add to UsePart pool combo
				UsePartPoolComboTxt += "<option id=\"UsePartPlPoolId_" + UsePartId + "\" value=\"" + i + "\" >" + UsePartNameTxt + "</option>";
			}
			// fill UsePart combo
			UsePartComboObj.innerHTML = UsePartPoolComboTxt;

			// fetch plante UsePart
			console.log("Doing plante UsePart SQL request ...");
			let PlanteUsePartSQLRequestResultObj = [];
			try {
				PlanteUsePartSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select UsePart from PLANTE_USEPART where Plante = $a",
					rowMode: 'array',
					bind: {$a: PlanteId},
				});
				console.log("End of plante UsePart SQL request.");
			} catch(ErrorObj) {
				console.log("Echec plante UsePart SQL request");
			};
			// update UsePart state array AND UsePart check list 
			let UsePartCheckListTxt = "";
			let NbCtrIndic = PlanteUsePartSQLRequestResultObj.length;
			for(let i = 0; i < NbCtrIndic; i++)
			{
				// fetch UsePart Id
				let TmpResultRow = PlanteUsePartSQLRequestResultObj[i];
				let UsePartId = TmpResultRow[0];
				// get UsePart state array IDX
				let UsePartPoolObj = document.getElementById("UsePartPlPoolId_" + UsePartId);
				let TmpUsePartIdx = UsePartPoolObj.value;
				let PlanteUsePartStateObj = PlanteUsePartStateListObj[TmpUsePartIdx];
				// update check list
				UsePartCheckListTxt += "&emsp;<input type=\"checkbox\" id=\"UsePartPlCheckListId_" + UsePartId + "\" checked>" + PlanteUsePartStateObj.UsePartName + "</input><br/>";
				// update combo
				UsePartPoolObj.disabled = true;
				// update UsePart state array
				PlanteUsePartStateObj.FlgCurrentlyUsedByProduct = true;
				PlanteUsePartStateObj.FlgInCheckList = true;
			}
			// fill UsePart check list
			PlanteUsePartListObj.innerHTML = UsePartCheckListTxt;
			// save UsePart state array
			globalThis.PrivatePlanteUsePartStateListObj = PlanteUsePartStateListObj;			
			return;
		}
		
		// cleanup edit product
		function AfterEditProduct()
		{
			// Dectivate RichText 
			DeactivateRichTextOnTextArea("ProductProprietesInput");
			DeactivateRichTextOnTextArea("ProductPrecautionsInput");
			
			//deactivate all espece areas
			// fetch all Espece
			console.log("Doing list Espece SQL request ...");
			let EspeceSQLRequestResultObj = [];
			try {
				EspeceSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from ESPECE",
					rowMode: 'array',
				});
				console.log("End of list Espece SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Espece SQL request");
			};
			let NbResultRow = EspeceSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = EspeceSQLRequestResultObj[i];
				let EspeceId = TmpResultRow[0];
				let EspeceNameTxt = TmpResultRow[1];
				if(EspeceNameTxt == null) EspeceNameTxt = "UNKNOWN Espece ID " + EspeceId;
				EspeceNameTxt = DoSanitizeNameTxt(EspeceNameTxt);
				DeactivateRichTextOnTextArea("ProductPoso" + EspeceNameTxt + "Input");
				DeactivateRichTextOnTextArea("ProductTA" + EspeceNameTxt + "Input");
			}
			
			// go back to menu
			DoEditProductTable();
			return;
		}
		
		// cleanup edit plante
		function AfterEditPlante()
		{
			// Dectivate RichText 
			DeactivateRichTextOnTextArea("PlanteBotaniqueInput");
			DeactivateRichTextOnTextArea("PlanteMoleculesInput");
			DeactivateRichTextOnTextArea("PlantePDynInput");
			DeactivateRichTextOnTextArea("PlantePCinInput");
			DeactivateRichTextOnTextArea("PlanteGestInput");
			DeactivateRichTextOnTextArea("PlanteSurdosageInput");
			DeactivateRichTextOnTextArea("PlanteInteracInput");
			DeactivateRichTextOnTextArea("PlanteSourcesInput");
			// go back to menu
			DoEditPlanteTable();
			return;
		}
		
		// edit product
		function DoEditProduct(ProductId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");
			let FlgProductIsValid = false;

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = ProductId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateProduct(" + ProductId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"AfterEditProduct();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteProduct(" + ProductId + ");\" class='Delete' ";
			if(ProductId == 0) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";			
			// append product view
			let ProductInfoTxt = "";
			ProductInfoTxt += "<h1>Product " + ProductId + " Info :</h1>";
			// fetch product info
			let ProductSQLRequestResultObj = [];
			if(ProductId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let ProductPrecautionsBlob = CastRichTextToBuffer("Aucune prcaution d'emploi indique");
				let ProductInfo = [0, "PRODUCT_0", new Uint8Array(), 0, 0, false, 0, new Uint8Array(), ProductPrecautionsBlob];
				ProductSQLRequestResultObj.push(ProductInfo);
			}
			else
			{
				// existing elt
				console.log("Doing product info SQL request ...");
				try {
					ProductSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from PRODUCT where Id = $a",
						rowMode: 'array',
						bind: {$a: ProductId},
					});
					console.log("End of product info SQL request.");
				} catch(ErrorObj) {
					console.log("Echec product info SQL request");
				};
			}
			
			// build view
			let NbResultRow = ProductSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				ProductInfoTxt += "Nb product (" + NbResultRow +") missmatch for id " + ProductId + "<br/>";
			}
			else
			{			
				// fetch direct info
				let ProductInfo = ProductSQLRequestResultObj[0];
				let ProductNameTxt = ProductInfo[1];
				if(ProductNameTxt == null) ProductNameTxt = "UNDEFINED";
				ProductNameTxt = DoSanitizeNameTxt(ProductNameTxt);
				let ProductPhotoBlob = ProductInfo[2];
				if(ProductPhotoBlob == null) ProductPhotoBlob = new Uint8Array();
				let GaleniqueId = ProductInfo[3];
				let CategorieId = ProductInfo[4];
				let DMVId = ProductInfo[5];
				let LaboId = ProductInfo[6];
				let ProductProprietesBlob = ProductInfo[7];
				if(ProductProprietesBlob == null) ProductProprietesBlob = new Uint8Array();
				let ProductPrecautionsBlob = ProductInfo[8];
				if(ProductPrecautionsBlob == null)
				{
					ProductPrecautionsBlob = CastRichTextToBuffer("Aucune prcaution d'emploi renseigne");
				}
				
				// setup view
				ProductInfoTxt += "<b>Produit (nom) : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + ProductNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder='Entrez le nom dpos du produit.'/><br/><br/>";
				ProductInfoTxt += "<img id=\"ProductPhotoView\" style=\"max-height: 500px; max-width: 500px\" src=" + CastBufferToImgURLData(ProductPhotoBlob) + " /> <input id=\"SelectedPhotoInput\" type=\"file\" accept=\"image/*\" onchange=\"DoUpdateProductPhoto()\" />";
				
				ProductInfoTxt += "<h2>Composition</h2>";
				ProductInfoTxt += "&emsp;<b>Plante(s) : </b> <select id=\"PlantePoolCombo\" style=\"width: 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendProductPlante();\" class='append' /><br/><div id=\"ListCheckedProductPlante\">Empty list checked product plante</div>";
				ProductInfoTxt += "<h2>Forme galnique</h2>";
				ProductInfoTxt += "&emsp;" + BuildGaleniqueInputCombo(GaleniqueId) + "<br/>";
				
				ProductInfoTxt += "<h2>Informations cliniques</h2>";
				ProductInfoTxt += "<h3>Utilisations</h3>";
				ProductInfoTxt += "&emsp;<b>Utilisation(s) principale(s) pour la : </b> <select id=\"FctsPoolCombo\" style=\"width: 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendFcts();\" class='append' /><br/><div id=\"ListCheckedProductFcts\">Empty list checked product fcts</div>";
				ProductInfoTxt += "<br/>&emsp;<b>Utilisation(s) secondaire(s) pour la : </b> <select id=\"FctsPoolCombo2\" style=\"width: 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendFcts2();\" class='append' /><br/><div id=\"ListCheckedProductFcts2\">Empty list checked product fcts 2</div>";
				ProductInfoTxt += "<h3>Contre-indications</h3>";
				ProductInfoTxt += "&emsp;<select id=\"CtrIndicPoolCombo\" style=\"width:CtrIndic 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendCtrIndic();\" class='append' /><br/><div id=\"ListCheckedProductCtrIndic\">Empty list checked product CtrIndic</div>";
				ProductInfoTxt += "<h3>Effets secondaires</h3>";
				ProductInfoTxt += "&emsp;<select id=\"Effet2PoolCombo\" style=\"width: 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendEffet2();\" class='append' /><br/><div id=\"ListCheckedProductEffet2\">Empty list checked product Effet2</div>";
				
				ProductInfoTxt += "<h3>Espces cibles, Posologie et Temps d'attente</h3>";
				ProductInfoTxt += "<div id=\"TableCheckEspece\">Empty table checked product espece poso</div>";
				
				ProductInfoTxt += "<h3>Toxicit</h3>";
				ProductInfoTxt += "&emsp;<select id=\"ToxicitePoolCombo\" style=\"width: 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendToxicite();\" class='append' /><br/><div id=\"ListCheckedProductToxicite\">Empty list checked product Toxicite</div>";
				
				ProductInfoTxt += "<h2>Proprits pharmacologiques</h2>";
				ProductInfoTxt += "<textarea id=\"ProductProprietesInput\" >Initializing Rich text editor ...</textarea>";
				RichTextDataProprietes = CastBufferToRichText(ProductProprietesBlob);
				
				ProductInfoTxt += "<h2>Informations pharmaceutiques</h2>";
				ProductInfoTxt += "<h3>Prcautions d'emploi</h3>";
				ProductInfoTxt += "<textarea id=\"ProductPrecautionsInput\" >Initializing Rich text editor ...</textarea>";
				RichTextDataPrecautions = CastBufferToRichText(ProductPrecautionsBlob);
				ProductInfoTxt += "<h3>Nature du produit</h3>";
				ProductInfoTxt += "&emsp;" + BuildCategorieInputCombo(CategorieId) + "<br/>";
				
				ProductInfoTxt += "<h2>Laboratoire</h2>";
				ProductInfoTxt += "&emsp;" + BuildLaboInputCombo(LaboId) + "<br/>";
				ProductInfoTxt += "<h2>Prsence dans le DMV</h2>";
				if(DMVId == 1) ProductInfoTxt += "&emsp;<input type='radio' name='DMV' id='DMV1' value='Oui' checked><label for 'Oui'>Oui</label><input type='radio' name='DMV' id='DMV0' value='Non'><label for 'Non'>Non</label><br/>";
				else ProductInfoTxt += "&emsp;<input type='radio' name='DMV' id='DMV1' value='Oui'><label for 'Oui'>Oui</label><input type='radio' name='DMV' id='DMV0' value='Non' checked><label for 'Non'>Non</label><br/>";
				
				// say everything is ok
				FlgProductIsValid = true;
			}
			RowEditFormTxt += ProductInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			// finalize 
			if(FlgProductIsValid)
			{
				// fill plante list
				BuildProductPlanteListAndCombo(ProductId);
				//fill fct list
				BuildProductFctListsAndCombos(ProductId);
				// fill usecase list
				BuildProductUsecaseList(ProductId);
				// fill usecase plante list
				BuildProductUsecasePlanteList(ProductId);
				// fill effet2 list
				BuildProductEffet2ListAndCombo(ProductId);
				// fill toxicite list
				BuildProductToxiciteListAndCombo(ProductId);
				// fill CtrIndic list
				BuildProductCtrIndicListAndCombo(ProductId);
				// fill list poso
				BuildPosoList(ProductId);
				// activate RichText and set init content
				ActivateRichTextOnTextArea("ProductProprietesInput",RichTextDataProprietes);
				ActivateRichTextOnTextArea("ProductPrecautionsInput",RichTextDataPrecautions);
			}
			return;
		}
		
		// add new product
		function GoAddNewProduct()
		{
			// use special ID 0 to indicate New elt
			DoEditProduct(0);
			return;
		}

		// edit product table
		function DoEditProductTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new product\" onclick=\"GoAddNewProduct();\" class='New' /> OR click a product to edit :<br/>";
			// list all existing product : exec SQL request on Working DB
			console.log("Doing list product SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from PRODUCT",
					rowMode: 'array',
				});
				console.log("End of list product SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list product SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO PRODUCT";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditProduct(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete labo
		function GoDeleteLabo(LaboId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this labo ?")) return;
				// delete entry
				console.log("Doing delete labo SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from LABO where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete labo SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete labo SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
				// enable/disable btn as needed
				if(IsLaboTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
				else document.getElementById("EditPdtBtn").disabled = false;
			}
			// back to select row
			DoEditLaboTable();
			return;
		}

		// update labo
		function GoUpdateLabo(LaboId)
		{
			// fecth value to save
			let LaboNameTxt = document.getElementById("EltNameInput").value;		
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert labo SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into LABO values(null, $a) returning Id",
						rowMode: 'array',
						bind: {$a: LaboNameTxt},
					});
					console.log("End of insert labo SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert labo SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted labo Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update labo SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update LABO set Name = $a where Id = $b",
						rowMode: 'array',
						bind: {$a: LaboNameTxt, $b: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update labo SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update labo SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			// enable/disable btn as needed
			if(IsLaboTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
			else document.getElementById("EditPdtBtn").disabled = false;
			return;
		}

		// edit labo
		function DoEditLabo(LaboId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = LaboId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateLabo(" + LaboId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditLaboTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteLabo(" + LaboId + ");\" class='Delete' ";
			if(IsLaboUsedBySomeProduct(LaboId) || (LaboId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";			
			// append Labo view
			let LaboInfoTxt = "";
			LaboInfoTxt += "<h1>Labo " + LaboId + " Info :</h1><br/>";
			// fetch Labo info
			let LaboSQLRequestResultObj = [];
			if(LaboId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let LaboInfo = [0, "LABO_0"];
				LaboSQLRequestResultObj.push(LaboInfo);
			}
			else
			{
				// existing elt
				console.log("Doing labo info SQL request ...");
				try {
					LaboSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from LABO where Id = $a",
						rowMode: 'array',
						bind: {$a: LaboId},
					});
					console.log("End of labo info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec labo info  SQL request");
				};
			}
			// build view
			let NbResultRow = LaboSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				LaboInfoTxt += "Nb labo (" + NbResultRow +") missmatch for id " + LaboId + "<br/>";
			}
			else
			{
				// fetch info
				let LaboInfo = LaboSQLRequestResultObj[0];
				let LaboNameTxt = LaboInfo[1];
				if(LaboNameTxt == null) LaboNameTxt = "UNDEFINED";
				LaboNameTxt = DoSanitizeNameTxt(LaboNameTxt);
				// build form
				LaboInfoTxt += "<b>LABO NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + LaboNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\"Entrez le nom d'un laboratoire.\" /><br/>";
			}
			RowEditFormTxt += LaboInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}

		// add new labo
		function GoAddNewLabo()
		{
			// use special ID 0 to indicate New elt
			DoEditLabo(0);
			return;
		}

		// edit labo table
		function DoEditLaboTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new labo\" onclick=\"GoAddNewLabo();\" class='New' /> OR click a labo to edit :<br/>";
			// list all existing labo : exec SQL request on Working DB
			console.log("Doing list labo SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from LABO",
					rowMode: 'array',
				});
				console.log("End of list labo SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list labo SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO LABO";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditLabo(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}

		// delete Fcts
		function GoDeleteFcts(FctsId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this function ?")) return;
				// delete entry
				console.log("Doing delete Fcts SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from Fcts where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete Fcts SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete Fcts SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
				// enable/disable btn as needed
				if(IsFctsTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
				else document.getElementById("EditPdtBtn").disabled = false;
			}
			// back to select row
			DoEditFctsTable();
			return;
		}

		// update Fcts
		function GoUpdateFcts(FctsId)
		{
			// fecth value to save
			let FctsNameTxt = document.getElementById("EltNameInput").value;			
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert Fcts SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into Fcts values(null, $a) returning Id",
						rowMode: 'array',
						bind: {$a: FctsNameTxt},
					});
					console.log("End of insert Fcts SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert Fcts SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted Fcts Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update Fcts SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update Fcts set Name = $a where Id = $b",
						rowMode: 'array',
						bind: {$a: FctsNameTxt, $b: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update Fcts SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update Fcts SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			// enable/disable btn as needed
			if(IsFctsTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
			else document.getElementById("EditPdtBtn").disabled = false;
			return;
		}

		// edit Fcts
		function DoEditFcts(FctsId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = FctsId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateFcts(" + FctsId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditFctsTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteFcts(" + FctsId + ");\" class='Delete' ";
			if(IsFctsUsedBySomeProduct(FctsId) || (FctsId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";			
			// append Fcts view
			let FctsInfoTxt = "";
			FctsInfoTxt += "<h1>Fcts " + FctsId + " Info :</h1><br/>";
			// fetch Fcts info
			let FctsSQLRequestResultObj = [];
			if(FctsId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let FctsInfo = [0, "Fcts_0"];
				FctsSQLRequestResultObj.push(FctsInfo);
			}
			else
			{
				// existing elt
				console.log("Doing Fcts info SQL request ...");
				try {
					FctsSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from Fcts where Id = $a",
						rowMode: 'array',
						bind: {$a: FctsId},
					});
					console.log("End of Fcts info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec Fcts info  SQL request");
				};
			}
			// build view
			let NbResultRow = FctsSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				FctsInfoTxt += "Nb Fcts (" + NbResultRow +") missmatch for id " + FctsId + "<br/>";
			}
			else
			{
				// fetch info
				let FctsInfo = FctsSQLRequestResultObj[0];
				let FctsNameTxt = FctsInfo[1];
				if(FctsNameTxt == null) FctsNameTxt = "UNDEFINED";
				FctsNameTxt = DoSanitizeNameTxt(FctsNameTxt);
				// build form
				FctsInfoTxt += "<b>Fcts NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + FctsNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\"Entrez le nom d'une grande fonction de l'organisme.\" /><br/>";
			}
			RowEditFormTxt += FctsInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}

		// add new Fcts
		function GoAddNewFcts()
		{
			// use special ID 0 to indicate New elt
			DoEditFcts(0);
			return;
		}

		// edit Fcts table
		function DoEditFctsTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new Fcts\" onclick=\"GoAddNewFcts();\" class='New' /> OR click a body function to edit :<br/>";
			// list all existing Fcts : exec SQL request on Working DB
			console.log("Doing list Fcts SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from Fcts",
					rowMode: 'array',
				});
				console.log("End of list Fcts SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Fcts SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO Fcts";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditFcts(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}

		// delete usecase
		function GoDeleteUsecase(UsecaseId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this usecase ?")) return;
				// delete entry
				console.log("Doing delete usecase SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from USECASE where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete usecase SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete usecase SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
			}
			// back to select row
			DoEditUsecaseTable();
			return;
		}

		// update usecase
		function GoUpdateUsecase(UsecaseId)
		{
			// fecth value to save
			let UsecaseNameTxt = document.getElementById("EltNameInput").value;
			let UsecaseFctTxt = document.getElementById("UsecaseFctInputCombo").value;
			let UsecaseSynd = document.getElementById("SyndOui").checked;
			
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert usecase SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into USECASE values(null, $a, $b, $c) returning Id",
						rowMode: 'array',
						bind: {$a: UsecaseNameTxt, $b: UsecaseFctTxt, $c: UsecaseSynd},
					});
					console.log("End of insert usecase SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert usecase SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted usecase Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update usecase SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update USECASE set Name = $a, Fct = $b, Syndrome = $c where Id = $d",
						rowMode: 'array',
						bind: {$a: UsecaseNameTxt, $b: UsecaseFctTxt, $c: UsecaseSynd, $d: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update usecase SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update usecase SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			return;
		}

		// edit usecase
		function DoEditUsecase(UsecaseId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = UsecaseId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateUsecase(" + UsecaseId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditUsecaseTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteUsecase(" + UsecaseId + ");\" class='Delete' ";
			if(IsUsecaseUsedBySomeProduct(UsecaseId) || (UsecaseId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";
			// append Usecase view
			let UsecaseInfoTxt = "";
			 UsecaseInfoTxt += "<h1>Usecase " + UsecaseId + " Info :</h1><br/>";
			// fetch Usecase info			
			let UsecaseSQLRequestResultObj = [];
			if(UsecaseId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let UsecaseInfo = [0, "USECASE_0", 0, 0];
				UsecaseSQLRequestResultObj.push(UsecaseInfo);
			}
			else
			{
				// existing elt
				console.log("Doing usecase info SQL request ...");
				try {
					UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from USECASE where Id = $a",
						rowMode: 'array',
						bind: {$a: UsecaseId},
					});
					console.log("End of usecase info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec usecase info  SQL request");
				};
			}
			// build view
			let NbResultRow = UsecaseSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				UsecaseInfoTxt += "Nb usecase (" + NbResultRow +") missmatch for id " + UsecaseId + "<br/>";
			}
			else
			{
				// fetch info
				let UsecaseInfo = UsecaseSQLRequestResultObj[0];
				let UsecaseNameTxt = UsecaseInfo[1];
				if(UsecaseNameTxt == null) UsecaseNameTxt = "UNDEFINED";
				UsecaseNameTxt = DoSanitizeNameTxt(UsecaseNameTxt);
				let UsecaseFctId = UsecaseInfo[2];
				let UsecaseSynd = UsecaseInfo[3];
				// build form
				UsecaseInfoTxt += "<b>Nom de l'utilisation : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + UsecaseNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\"Entrez le nom d'une utilisation clinique.\" /><br/>";
				UsecaseInfoTxt += "<b>Lie  la : </b>" + BuildUsecaseFctInputCombo(UsecaseFctId) + "<br/>";
				if(UsecaseSynd == 1) UsecaseInfoTxt += "<b>Est un grand syndrme : </b><input type='radio' name='Syndrome' id='SyndOui' value='Oui' checked><label for 'Oui'>Oui</label><input type='radio' name='Syndrome' id='SyndNon' value='Non'><label for 'Non'>Non</label><br/>";
				else UsecaseInfoTxt += "<b>Est un grand syndrme : </b><input type='radio' name='Syndrome' id='SyndOui' value='Oui'><label for 'Oui'>Oui</label><input type='radio' name='Syndrome' id='SyndNon' value='Non' checked><label for 'Non'>Non</label><br/>";
			}
			RowEditFormTxt += UsecaseInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}
		
		// add new Usecase
		function GoAddNewUsecase()
		{
			// use special ID 0 to indicate New elt
			DoEditUsecase(0);			
			return;
		}

		// edit usecase table
		function DoEditUsecaseTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new usecase\" onclick=\"GoAddNewUsecase();\" class='New' /> OR click a usecase to edit :<br/>";
			// list all existing usecase : exec SQL request on Working DB
			console.log("Doing list usecase SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from USECASE",
					rowMode: 'array',
				});
				console.log("End of list usecase SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list usecase SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO USECASE";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditUsecase(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete Toxicite
		function GoDeleteToxicite(ToxiciteId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this Toxicite ?")) return;
				// delete entry
				console.log("Doing delete Toxicite SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from TOXICITE where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete Toxicite SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete Toxicite SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
			}
			// back to select row
			DoEditToxiciteTable();
			return;
		}

		// update Toxicite
		function GoUpdateToxicite(ToxiciteId)
		{
			// fecth value to save
			let ToxiciteNameTxt = document.getElementById("EltNameInput").value;		
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert Toxicite SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into TOXICITE values(null, $a) returning Id",
						rowMode: 'array',
						bind: {$a: ToxiciteNameTxt},
					});
					console.log("End of insert Toxicite SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert Toxicite SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted Toxicite Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update Toxicite SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update TOXICITE set Name = $a where Id = $b",
						rowMode: 'array',
						bind: {$a: ToxiciteNameTxt, $b: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update Toxicite SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update Toxicite SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			return;
		}

		// edit Toxicite
		function DoEditToxicite(ToxiciteId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = ToxiciteId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateToxicite(" + ToxiciteId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditToxiciteTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteToxicite(" + ToxiciteId + ");\" class='Delete' ";
			if(IsToxiciteUsedBySomeProduct(ToxiciteId) || (ToxiciteId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";
			// append Toxicite view
			let ToxiciteInfoTxt = "";
			 ToxiciteInfoTxt += "<h1>Toxicite " + ToxiciteId + " Info :</h1><br/>";
			// fetch Toxicite info			
			let ToxiciteSQLRequestResultObj = [];
			if(ToxiciteId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let ToxiciteInfo = [0, "Toxicite_0"];
				ToxiciteSQLRequestResultObj.push(ToxiciteInfo);
			}
			else
			{
				// existing elt
				console.log("Doing Toxicite info SQL request ...");
				try {
					ToxiciteSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from Toxicite where Id = $a",
						rowMode: 'array',
						bind: {$a: ToxiciteId},
					});
					console.log("End of Toxicite info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec Toxicite info  SQL request");
				};
			}
			// build view
			let NbResultRow = ToxiciteSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				ToxiciteInfoTxt += "Nb Toxicite (" + NbResultRow +") missmatch for id " + ToxiciteId + "<br/>";
			}
			else
			{
				// fetch info
				let ToxiciteInfo = ToxiciteSQLRequestResultObj[0];
				let ToxiciteNameTxt = ToxiciteInfo[1];
				if(ToxiciteNameTxt == null) ToxiciteNameTxt = "UNDEFINED";
				ToxiciteNameTxt = DoSanitizeNameTxt(ToxiciteNameTxt);
				// build form
				ToxiciteInfoTxt += "<b>Toxicite NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + ToxiciteNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\"Entrez le nom d'une toxicit.\" /><br/>";
			}
			RowEditFormTxt += ToxiciteInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}
		
		// add new Toxicite
		function GoAddNewToxicite()
		{
			// use special ID 0 to indicate New elt
			DoEditToxicite(0);			
			return;
		}
		
		// edit toxicite table
		function DoEditToxiciteTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new Toxicite\" onclick=\"GoAddNewToxicite();\" class='New' /> OR click a toxicity to edit :<br/>";
			// list all existing Toxicite : exec SQL request on Working DB
			console.log("Doing list Toxicite SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from TOXICITE",
					rowMode: 'array',
				});
				console.log("End of list Toxicite SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Toxicite SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO Toxicite";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditToxicite(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete Effet2
		function GoDeleteEffet2(Effet2Id)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this Effet2 ?")) return;
				// delete entry
				console.log("Doing delete Effet2 SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from EFFET2 where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete Effet2 SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete Effet2 SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
			}
			// back to select row
			DoEditEffet2Table();
			return;
		}

		// update Effet2
		function GoUpdateEffet2(Effet2Id)
		{
			// fecth value to save
			let Effet2NameTxt = document.getElementById("EltNameInput").value;		
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert Effet2 SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into EFFET2 values(null, $a) returning Id",
						rowMode: 'array',
						bind: {$a: Effet2NameTxt},
					});
					console.log("End of insert Effet2 SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert Effet2 SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted Effet2 Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update Effet2 SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update EFFET2 set Name = $a where Id = $b",
						rowMode: 'array',
						bind: {$a: Effet2NameTxt, $b: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update Effet2 SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update Effet2 SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			return;
		}

		// edit Effet2
		function DoEditEffet2(Effet2Id)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = Effet2Id;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateEffet2(" + Effet2Id + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditEffet2Table();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteEffet2(" + Effet2Id + ");\" class='Delete' ";
			if(IsEffet2UsedBySomeProduct(Effet2Id) || (Effet2Id == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";
			// append Effet2 view
			let Effet2InfoTxt = "";
			 Effet2InfoTxt += "<h1>Effet2 " + Effet2Id + " Info :</h1><br/>";
			// fetch Effet2 info			
			let Effet2SQLRequestResultObj = [];
			if(Effet2Id == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let Effet2Info = [0, "Effet2_0"];
				Effet2SQLRequestResultObj.push(Effet2Info);
			}
			else
			{
				// existing elt
				console.log("Doing Effet2 info SQL request ...");
				try {
					Effet2SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from EFFET2 where Id = $a",
						rowMode: 'array',
						bind: {$a: Effet2Id},
					});
					console.log("End of Effet2 info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec Effet2 info  SQL request");
				};
			}
			// build view
			let NbResultRow = Effet2SQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				Effet2InfoTxt += "Nb Effet2 (" + NbResultRow +") missmatch for id " + Effet2Id + "<br/>";
			}
			else
			{
				// fetch info
				let Effet2Info = Effet2SQLRequestResultObj[0];
				let Effet2NameTxt = Effet2Info[1];
				if(Effet2NameTxt == null) Effet2NameTxt = "UNDEFINED";
				Effet2NameTxt = DoSanitizeNameTxt(Effet2NameTxt);
				// build form
				Effet2InfoTxt += "<b>Effet2 NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + Effet2NameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\"Entrez le nom d'un effet secondaire.\" /><br/>";
			}
			RowEditFormTxt += Effet2InfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}
		
		// add new Effet2
		function GoAddNewEffet2()
		{
			// use special ID 0 to indicate New elt
			DoEditEffet2(0);			
			return;
		}
		
		// edit Effet2 table
		function DoEditEffet2Table()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new Effet2\" onclick=\"GoAddNewEffet2();\" class='New' /> OR click a side effect to edit :<br/>";
			// list all existing Effet2 : exec SQL request on Working DB
			console.log("Doing list Effet2 SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from EFFET2",
					rowMode: 'array',
				});
				console.log("End of list Effet2 SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Effet2 SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO Effet2";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditEffet2(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete CtrIndic
		function GoDeleteCtrIndic(CtrIndicId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this CtrIndic ?")) return;
				// delete entry
				console.log("Doing delete CtrIndic SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from CTRINDIC where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete CtrIndic SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete CtrIndic SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
			}
			// back to select row
			DoEditCtrIndicTable();
			return;
		}

		// update CtrIndic
		function GoUpdateCtrIndic(CtrIndicId)
		{
			// fecth value to save
			let CtrIndicNameTxt = document.getElementById("EltNameInput").value;		
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert CtrIndic SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into CTRINDIC values(null, $a) returning Id",
						rowMode: 'array',
						bind: {$a: CtrIndicNameTxt},
					});
					console.log("End of insert CtrIndic SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert CtrIndic SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted CtrIndic Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update CtrIndic SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update CTRINDIC set Name = $a where Id = $b",
						rowMode: 'array',
						bind: {$a: CtrIndicNameTxt, $b: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update CtrIndic SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update CtrIndic SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			return;
		}

		// edit CtrIndic
		function DoEditCtrIndic(CtrIndicId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = CtrIndicId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateCtrIndic(" + CtrIndicId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditCtrIndicTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteCtrIndic(" + CtrIndicId + ");\" class='Delete' ";
			if(IsCtrIndicUsedBySomeProduct(CtrIndicId) || (CtrIndicId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";
			// append CtrIndic view
			let CtrIndicInfoTxt = "";
			 CtrIndicInfoTxt += "<h1>CtrIndic " + CtrIndicId + " Info :</h1><br/>";
			// fetch CtrIndic info			
			let CtrIndicSQLRequestResultObj = [];
			if(CtrIndicId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let CtrIndicInfo = [0, "CtrIndic_0"];
				CtrIndicSQLRequestResultObj.push(CtrIndicInfo);
			}
			else
			{
				// existing elt
				console.log("Doing CtrIndic info SQL request ...");
				try {
					CtrIndicSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from CTRINDIC where Id = $a",
						rowMode: 'array',
						bind: {$a: CtrIndicId},
					});
					console.log("End of CtrIndic info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec CtrIndic info  SQL request");
				};
			}
			// build view
			let NbResultRow = CtrIndicSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				CtrIndicInfoTxt += "Nb CtrIndic (" + NbResultRow +") missmatch for id " + CtrIndicId + "<br/>";
			}
			else
			{
				// fetch info
				let CtrIndicInfo = CtrIndicSQLRequestResultObj[0];
				let CtrIndicNameTxt = CtrIndicInfo[1];
				if(CtrIndicNameTxt == null) CtrIndicNameTxt = "UNDEFINED";
				CtrIndicNameTxt = DoSanitizeNameTxt(CtrIndicNameTxt);
				// build form
				CtrIndicInfoTxt += "<b>CtrIndic NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + CtrIndicNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\#Entrez le nom d'une contre-indication.\" /><br/>";
			}
			RowEditFormTxt += CtrIndicInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}
		
		// add new CtrIndic
		function GoAddNewCtrIndic()
		{
			// use special ID 0 to indicate New elt
			DoEditCtrIndic(0);			
			return;
		}
		
		// edit CtrIndic table
		function DoEditCtrIndicTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new CtrIndic\" onclick=\"GoAddNewCtrIndic();\" class='New' /> OR click a ctrindic to edit :<br/>";
			// list all existing CtrIndic : exec SQL request on Working DB
			console.log("Doing list CtrIndic SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from CTRINDIC",
					rowMode: 'array',
				});
				console.log("End of list CtrIndic SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list CtrIndic SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO CtrIndic";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditCtrIndic(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete Galenique
		function GoDeleteGalenique(GaleniqueId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this drug form ?")) return;
				// delete entry
				console.log("Doing delete Galenique SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from GALENIQUE where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete Galenique SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete Galenique SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
				// enable/disable btn as needed
				if(IsGaleniqueTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
				else document.getElementById("EditPdtBtn").disabled = false;
			}
			// back to select row
			DoEditGaleniqueTable();
			return;
		}

		// update Galenique
		function GoUpdateGalenique(GaleniqueId)
		{
			// fecth value to save
			let GaleniqueNameTxt = document.getElementById("EltNameInput").value;		
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert Galenique SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into GALENIQUE values(null, $a) returning Id",
						rowMode: 'array',
						bind: {$a: GaleniqueNameTxt},
					});
					console.log("End of insert Galenique SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert Galenique SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted Galenique Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update Galenique SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update GALENIQUE set Name = $a where Id = $b",
						rowMode: 'array',
						bind: {$a: GaleniqueNameTxt, $b: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update Galenique SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update Galenique SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			// enable/disable btn as needed
			if(IsGaleniqueTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
			else document.getElementById("EditPdtBtn").disabled = false;
			return;
		}

		// edit Galenique
		function DoEditGalenique(GaleniqueId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = GaleniqueId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateGalenique(" + GaleniqueId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditGaleniqueTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteGalenique(" + GaleniqueId + ");\" class='Delete' ";
			if(IsGaleniqueUsedBySomeProduct(GaleniqueId) || (GaleniqueId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";			
			// append Galenique view
			let GaleniqueInfoTxt = "";
			GaleniqueInfoTxt += "<h1>Galenique " + GaleniqueId + " Info :</h1><br/>";
			// fetch Galenique info
			let GaleniqueSQLRequestResultObj = [];
			if(GaleniqueId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let GaleniqueInfo = [0, "GALENIQUE_0"];
				GaleniqueSQLRequestResultObj.push(GaleniqueInfo);
			}
			else
			{
				// existing elt
				console.log("Doing Galenique info SQL request ...");
				try {
					GaleniqueSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from GALENIQUE where Id = $a",
						rowMode: 'array',
						bind: {$a: GaleniqueId},
					});
					console.log("End of Galenique info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec Galenique info  SQL request");
				};
			}
			// build view
			let NbResultRow = GaleniqueSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				GaleniqueInfoTxt += "Nb Galenique (" + NbResultRow +") missmatch for id " + GaleniqueId + "<br/>";
			}
			else
			{
				// fetch info
				let GaleniqueInfo = GaleniqueSQLRequestResultObj[0];
				let GaleniqueNameTxt = GaleniqueInfo[1];
				if(GaleniqueNameTxt == null) GaleniqueNameTxt = "UNDEFINED";
				GaleniqueNameTxt = DoSanitizeNameTxt(GaleniqueNameTxt);
				// build form
				GaleniqueInfoTxt += "<b>GALENIQUE NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + GaleniqueNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\"Entrez le nom d'une forme galnique.\" /><br/>";
			}
			RowEditFormTxt += GaleniqueInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}

		// add new Galenique
		function GoAddNewGalenique()
		{
			// use special ID 0 to indicate New elt
			DoEditGalenique(0);
			return;
		}

		// edit Galenique table
		function DoEditGaleniqueTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new Galenique\" onclick=\"GoAddNewGalenique();\" class='New' /> OR click a galenique to edit :<br/>";
			// list all existing Galenique : exec SQL request on Working DB
			console.log("Doing list Galenique SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from GALENIQUE",
					rowMode: 'array',
				});
				console.log("End of list Galenique SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Galenique SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO GALENIQUE";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditGalenique(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete Categorie
		function GoDeleteCategorie(CategorieId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this drug form ?")) return;
				// delete entry
				console.log("Doing delete Categorie SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from CATEGORIE where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete Categorie SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete Categorie SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
				// enable/disable btn as needed
				if(IsCategorieTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
				else document.getElementById("EditPdtBtn").disabled = false;
			}
			// back to select row
			DoEditCategorieTable();
			return;
		}

		// update Categorie
		function GoUpdateCategorie(CategorieId)
		{
			// fecth value to save
			let CategorieNameTxt = document.getElementById("EltNameInput").value;		
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert Categorie SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into CATEGORIE values(null, $a) returning Id",
						rowMode: 'array',
						bind: {$a: CategorieNameTxt},
					});
					console.log("End of insert Categorie SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert Categorie SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted Categorie Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update Categorie SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update CATEGORIE set Name = $a where Id = $b",
						rowMode: 'array',
						bind: {$a: CategorieNameTxt, $b: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update Categorie SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update Categorie SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			// enable/disable btn as needed
			if(IsCategorieTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
			else document.getElementById("EditPdtBtn").disabled = false;
			return;
		}

		// edit Categorie
		function DoEditCategorie(CategorieId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = CategorieId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateCategorie(" + CategorieId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditCategorieTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteCategorie(" + CategorieId + ");\" class='Delete' ";
			if(IsCategorieUsedBySomeProduct(CategorieId) || (CategorieId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";			
			// append Categorie view
			let CategorieInfoTxt = "";
			CategorieInfoTxt += "<h1>Categorie " + CategorieId + " Info :</h1><br/>";
			// fetch Categorie info
			let CategorieSQLRequestResultObj = [];
			if(CategorieId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let CategorieInfo = [0, "CATEGORIE_0"];
				CategorieSQLRequestResultObj.push(CategorieInfo);
			}
			else
			{
				// existing elt
				console.log("Doing Categorie info SQL request ...");
				try {
					CategorieSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from CATEGORIE where Id = $a",
						rowMode: 'array',
						bind: {$a: CategorieId},
					});
					console.log("End of Categorie info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec Categorie info  SQL request");
				};
			}
			// build view
			let NbResultRow = CategorieSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				CategorieInfoTxt += "Nb Categorie (" + NbResultRow +") missmatch for id " + CategorieId + "<br/>";
			}
			else
			{
				// fetch info
				let CategorieInfo = CategorieSQLRequestResultObj[0];
				let CategorieNameTxt = CategorieInfo[1];
				if(CategorieNameTxt == null) CategorieNameTxt = "UNDEFINED";
				CategorieNameTxt = DoSanitizeNameTxt(CategorieNameTxt);
				// build form
				CategorieInfoTxt += "<b>CATEGORIE NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + CategorieNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\"Entrez le nom d'une catgorie de mdicament.\" /><br/>";
			}
			RowEditFormTxt += CategorieInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}

		// add new Categorie
		function GoAddNewCategorie()
		{
			// use special ID 0 to indicate New elt
			DoEditCategorie(0);
			return;
		}

		// edit Categorie table
		function DoEditCategorieTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new Categorie\" onclick=\"GoAddNewCategorie();\" class='New' /> OR click a category to edit :<br/>";
			// list all existing Categorie : exec SQL request on Working DB
			console.log("Doing list Categorie SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from CATEGORIE",
					rowMode: 'array',
				});
				console.log("End of list Categorie SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Categorie SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO CATEGORIE";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditCategorie(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete Espece
		function GoDeleteEspece(EspeceId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this espece ?")) return;
				// delete entry
				console.log("Doing delete Espece SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from ESPECE where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete Espece SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete Espece SQL request");
					alert("Delete failed");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
				// enable/disable btn as needed
				if(IsEspeceTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
				else document.getElementById("EditPdtBtn").disabled = false;
			}
			// back to select row
			DoEditEspeceTable();
			return;
		}

		// update Espece
		function GoUpdateEspece(EspeceId)
		{
			// fecth value to save
			let EspeceNameTxt = document.getElementById("EltNameInput").value;
			let EspecePhotoBlob = CastImgURLDataToBuffer(document.getElementById("EspecePhotoView").src);		
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert Espece SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into ESPECE values(null, $a, $b) returning Id",
						rowMode: 'array',
						bind: {$a: EspeceNameTxt, $b: EspecePhotoBlob},
					});
					console.log("End of insert Espece SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert Espece SQL request");
					alert("Insert failed");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted Espece Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update Espece SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update ESPECE set Name = $a, IMG = $b where Id = $b",
						rowMode: 'array',
						bind: {$a: EspeceNameTxt, $b: EspecePhotoBlob, $c: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update Espece SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update Espece SQL request");
					alert("Update failed");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			// enable/disable btn as needed
			if(IsEspeceTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
			else document.getElementById("EditPdtBtn").disabled = false;
			return;
		}
		
		// update Espece photo
		function DoUpdateEspecePhoto()
		{
			let ListFilePathObj = document.getElementById("SelectedEspeceInput").files;
			// get selected file
			let FileObj = ListFilePathObj[0];
			// Load file
			DoReadImageFileAsURL(FileObj).then((OpsResult) => {
				// get result
				let FileDataURL = OpsResult;
				// set data on image view
				document.getElementById("EspecePhotoView").src = FileDataURL;
			}).catch((OpsError) => {
				alert("Echec reading image");
			});
			return;
		}

		// edit Espece
		function DoEditEspece(EspeceId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = EspeceId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateEspece(" + EspeceId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditEspeceTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteEspece(" + EspeceId + ");\" class='Delete' ";
			if(IsEspeceUsedBySomeProduct(EspeceId) || (EspeceId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";			
			// append Categorie view
			let EspeceInfoTxt = "";
			EspeceInfoTxt += "<h1>Espece " + EspeceId + " Info :</h1><br/>";
			// fetch Categorie info
			let EspeceSQLRequestResultObj = [];
			if(EspeceId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let EspeceInfo = [0, "ESPECE_0", new Uint8Array()];
				EspeceSQLRequestResultObj.push(EspeceInfo);
			}
			else
			{
				// existing elt
				console.log("Doing Espece info SQL request ...");
				try {
					EspeceSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from ESPECE where Id = $a",
						rowMode: 'array',
						bind: {$a: EspeceId},
					});
					console.log("End of Espece info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec Espece info  SQL request");
				};
			}
			// build view
			let NbResultRow = EspeceSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				EspeceInfoTxt += "Nb Espece (" + NbResultRow +") missmatch for id " + EspeceId + "<br/>";
			}
			else
			{
				// fetch info
				let EspeceInfo = EspeceSQLRequestResultObj[0];
				let EspeceNameTxt = EspeceInfo[1];
				if(EspeceNameTxt == null) EspeceNameTxt = "UNDEFINED";
				EspeceNameTxt = DoSanitizeNameTxt(EspeceNameTxt);
				let EspecePhotoBlob = EspeceInfo[2];
				if(EspecePhotoBlob == null) EspecePhotoBlob = new Uint8Array();
				// build form
				EspeceInfoTxt += "<b>ESPECE NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + EspeceNameTxt + "\" onchange=\"DoCheckNameValidity()\"  placeholder=\"Entrez le nom d'une espce.\" /><br/><br/>";
				EspeceInfoTxt += "<img id=\"EspecePhotoView\" style=\"max-height: 200px; max-width: 200px\" src=" + CastBufferToImgURLData(EspecePhotoBlob) + " /> <input id=\"SelectedEspeceInput\" type=\"file\" accept=\"image/*\" onchange=\"DoUpdateEspecePhoto()\" /><br/>";
			}
			RowEditFormTxt += EspeceInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}

		// add new Espece
		function GoAddNewEspece()
		{
			// use special ID 0 to indicate New elt
			DoEditEspece(0);
			return;
		}

		// edit Espece table
		function DoEditEspeceTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new Espece\" onclick=\"GoAddNewEspece();\" class='New' /> OR click an espece to edit :<br/>";
			// list all existing Espece : exec SQL request on Working DB
			console.log("Doing list Espece SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from ESPECE",
					rowMode: 'array',
				});
				console.log("End of list Espece SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Espece SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO ESPECE";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditEspece(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete Plante
		function GoDeletePlante(PlanteId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this drug form ?")) return;
				// delete entry
				console.log("Doing delete Plante SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from Plante where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete Plante SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete Plante SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
				// enable/disable btn as needed
				if(IsPlanteTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
				else document.getElementById("EditPdtBtn").disabled = false;
			}
			// back to select row
			DoEditPlanteTable();
			return;
		}

		// update Plante
		function GoUpdatePlante(PlanteId)
		{
			// fecth value to save
			let PlanteNameTxt = document.getElementById("EltNameInput").value;
			let PlantePhotoBlob = CastImgURLDataToBuffer(document.getElementById("PlantePhotoView").src);
			let PlanteLatinTxt = document.getElementById("EltLatinInput").value;
			let PlanteFamilleTxt = document.getElementById("EltFamilleInput").value;
			let PlanteBotanique = CastRichTextToBuffer(GetRichTextContentAsHTML("PlanteBotaniqueInput"));
			let PlanteMolecules = CastRichTextToBuffer(GetRichTextContentAsHTML("PlanteMoleculesInput"));
			let PlantePDyn = CastRichTextToBuffer(GetRichTextContentAsHTML("PlantePDynInput"));
			let PlanteP1 = document.getElementById("EltP1Input").value;
			let PlanteP2 = document.getElementById("EltP2Input").value;
			let PlanteP3 = document.getElementById("EltP3Input").value;
			let PlantePCin = CastRichTextToBuffer(GetRichTextContentAsHTML("PlantePCinInput"));
			let PlanteGestation = CastRichTextToBuffer(GetRichTextContentAsHTML("PlanteGestInput"));
			let PlanteSurdosage = CastRichTextToBuffer(GetRichTextContentAsHTML("PlanteSurdosageInput"));
			let PlanteSources = CastRichTextToBuffer(GetRichTextContentAsHTML("PlanteSourcesInput"));
			let PlanteInterac = CastRichTextToBuffer(GetRichTextContentAsHTML("PlanteInteracInput"));
			let PlantePoso = CastRichTextToBuffer(GetRichTextContentAsHTML("PlantePosoInput"));
			let Today = CastRichTextToBuffer(TodayDate());
			
			let PlanteRchr = 0;
			if (document.getElementById("Rchr1").checked) PlanteRchr = 1;
			else if (document.getElementById("Rchr2").checked) PlanteRchr = 2;
			else if (document.getElementById("Rchr3").checked) PlanteRchr = 3;
			else if (document.getElementById("Rchr4").checked) PlanteRchr = 4;
			else if (document.getElementById("Rchr5").checked) PlanteRchr = 5;
			let PlanteClin = 0;
			if (document.getElementById("Clin1").checked) PlanteClin = 1;
			else if (document.getElementById("Clin2").checked) PlanteClin = 2;
			else if (document.getElementById("Clin3").checked) PlanteClin = 3;
			else if (document.getElementById("Clin4").checked) PlanteClin = 4;
			else if (document.getElementById("Clin5").checked) PlanteClin = 5;
			let Reg = 0;
			if (document.getElementById("T1").checked) Reg = 1;
			else if (document.getElementById("T2").checked) Reg = 2;
			else if (document.getElementById("OOS").checked) Reg = 3;
			let RegEQ = 0;
			if (document.getElementById("SE").checked) RegEQ = 1;
			let Dop = 0;
			if (document.getElementById("+").checked) Dop = 1;
			else if (document.getElementById("-").checked) Dop = 2;
			
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert Plante SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into Plante values(null, $a, $b, $c, $d, $e, $f, $g, $h, $i, $j, $k, $l, $m, $n, $o, $p, $q, $r, $s, $t, $u, $v) returning Id",
						rowMode: 'array',
						bind: {$a: PlanteNameTxt, $b: PlantePhotoBlob, $c: PlanteLatinTxt, $d: PlanteFamilleTxt, $e: PlanteBotanique, $f: PlanteMolecules, $g: PlantePDyn, $h: PlanteP1, $i: PlanteP2, $j: PlanteP3, $k: PlantePCin, $l: PlanteGestation, $m: PlanteSurdosage, $n: PlanteSources, $o: PlanteInterac, $p: Today, $q: PlanteRchr, $r: PlanteClin, $s: Reg, $t: RegEQ, $u: Dop, $v: PlantePoso},
					});
					console.log("End of insert Plante SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert Plante SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted Plante Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update Plante SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update Plante set Name = $a, Photo = $b, Latin = $c, Famille = $d, Botanique = $e, Molecules = $f, PDyn = $g, P1 = $h, P2 = $i, P3 = $j, PCin = $k, Gestation = $l, Surdosage = $m, Sources = $n, Interac = $o, MAJ = $p, Rchr = $q, Clin = $r, Reg = $s, RegEQ = $t, Dop = $u, Poso = $v where Id = $w",
						rowMode: 'array',
						bind: {$a: PlanteNameTxt, $b: PlantePhotoBlob, $c: PlanteLatinTxt, $d: PlanteFamilleTxt, $e: PlanteBotanique, $f: PlanteMolecules, $g: PlantePDyn, $h: PlanteP1, $i: PlanteP2, $j: PlanteP3, $k: PlantePCin, $l: PlanteGestation, $m: PlanteSurdosage, $n: PlanteSources, $o: PlanteInterac, $p: Today, $q: PlanteRchr, $r: PlanteClin, $s: Reg, $t: RegEQ, $u: Dop, $v: PlantePoso, $w: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update Plante SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update Plante SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			
			// update plante Effet2
			// NOTA : PlanteEffet2StateListObj array row is : Effet2Id, Effet2Name, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbEffet2 = globalThis.PrivatePlanteEffet2StateListObj.length;
			for(let i = 0; i < NbEffet2; i++)
			{
				let PlanteEffet2StateObj = globalThis.PrivatePlanteEffet2StateListObj[i];
				
				// check if in check list
				if(PlanteEffet2StateObj.FlgInCheckList)
				{
					// get check state
					let Effet2Id = PlanteEffet2StateObj.Effet2Id;
					let FlgEffet2Checked = document.getElementById("Effet2PlCheckListId_" + Effet2Id).checked;
					// check if this Effet2 is removed from list of plante Effet2 or added to
					if(PlanteEffet2StateObj.FlgCurrentlyUsedByProduct && (!FlgEffet2Checked))
					{
						// HERE : this Effet2 is to be removed form list of plante Effet2
						console.log("Doing delete plante Effet2 SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PLANTE_EFFET2 where Plante = $a and Effet2 = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: Effet2Id},
							});
							console.log("End of delete Effet2 plante SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete Effet2 plante SQL request");
							alert("Delete plante Effet2 failed");
							return;
						};
						// update state
						PlanteEffet2StateObj.FlgCurrentlyUsedByProduct = false;
					}
					else if((!PlanteEffet2StateObj.FlgCurrentlyUsedByProduct) && FlgEffet2Checked)
					{
						// HERE : this Effet2 is to be added form list of plante Effet2
						console.log("Doing insert plante Effet2 SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PLANTE_EFFET2 values($a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: Effet2Id},
							});
							console.log("End of insert plante Effet2 SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert plante Effet2 SQL request");
							alert("Insert plante Effet2 failed");
							return;
						};
						// update state
						PlanteEffet2StateObj.FlgCurrentlyUsedByProduct = true;
					}
				}
			}
			
			// update plante CtrIndic
			// NOTA : PlanteCtrIndicStateListObj array row is : CtrIndicId, CtrIndicName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbCtrIndic = globalThis.PrivatePlanteCtrIndicStateListObj.length;
			for(let i = 0; i < NbCtrIndic; i++)
			{
				let PlanteCtrIndicStateObj = globalThis.PrivatePlanteCtrIndicStateListObj[i];
				
				// check if in check list
				if(PlanteCtrIndicStateObj.FlgInCheckList)
				{
					// get check state
					let CtrIndicId = PlanteCtrIndicStateObj.CtrIndicId;
					let FlgCtrIndicChecked = document.getElementById("CtrIndicPlCheckListId_" + CtrIndicId).checked;
					// check if this CtrIndic is removed from list of plante CtrIndic or added to
					if(PlanteCtrIndicStateObj.FlgCurrentlyUsedByProduct && (!FlgCtrIndicChecked))
					{
						// HERE : this CtrIndic is to be removed from list of plante CtrIndic
						console.log("Doing delete plante CtrIndic SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PLANTE_CTRINDIC where Plante = $a and CtrIndic = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: CtrIndicId},
							});
							console.log("End of delete CtrIndic plante SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete CtrIndic plante SQL request");
							alert("Delete plante CtrIndic failed");
							return;
						};
						// update state
						PlanteCtrIndicStateObj.FlgCurrentlyUsedByProduct = false;
					}
					else if((!PlanteCtrIndicStateObj.FlgCurrentlyUsedByProduct) && FlgCtrIndicChecked)
					{
						// HERE : this CtrIndic is to be added to list of plante CtrIndic
						console.log("Doing insert plante CtrIndic SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PLANTE_CTRINDIC values($a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: CtrIndicId},
							});
							console.log("End of insert plante CtrIndic SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert plante CtrIndic SQL request");
							alert("Insert plante CtrIndic failed");
							return;
						};
						// update state
						PlanteCtrIndicStateObj.FlgCurrentlyUsedByProduct = true;
					}
				}
			}
			
			// update plante UsePart
			// NOTA : PlanteUsePartStateListObj array row is : UsePartId, UsePartName, FlgCurrentlyUsedByProduct, FlgInCheckList
			let NbUsePart = globalThis.PrivatePlanteUsePartStateListObj.length;
			for(let i = 0; i < NbUsePart; i++)
			{
				let PlanteUsePartStateObj = globalThis.PrivatePlanteUsePartStateListObj[i];
				
				// check if in check list
				if(PlanteUsePartStateObj.FlgInCheckList)
				{
					// get check state
					let UsePartId = PlanteUsePartStateObj.UsePartId;
					let FlgUsePartChecked = document.getElementById("UsePartPlCheckListId_" + UsePartId).checked;
					// check if this UsePart is removed from list of plante UsePart or added to
					if(PlanteUsePartStateObj.FlgCurrentlyUsedByProduct && (!FlgUsePartChecked))
					{
						// HERE : this UsePart is to be removed from list of plante UsePart
						console.log("Doing delete plante UsePart SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PLANTE_USEPART where Plante = $a and UsePart = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsePartId},
							});
							console.log("End of delete UsePart plante SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete UsePart plante SQL request");
							alert("Delete plante UsePart failed");
							return;
						};
						// update state
						PlanteUsePartStateObj.FlgCurrentlyUsedByProduct = false;
					}
					else if((!PlanteUsePartStateObj.FlgCurrentlyUsedByProduct) && FlgUsePartChecked)
					{
						// HERE : this UsePart is to be added to list of plante UsePart
						console.log("Doing insert plante UsePart SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PLANTE_USEPART values($a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsePartId},
							});
							console.log("End of insert plante UsePart SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert plante UsePart SQL request");
							alert("Insert plante UsePart failed");
							return;
						};
						// update state
						PlanteUsePartStateObj.FlgCurrentlyUsedByProduct = true;
					}
				}
			}
			
			// update plante usecase
			// NOTA : PlanteUsecaseStateListObj array row is : UsecaseId, UsecaseName, FlgCurrentlyUsedByPlante, FlgInCheckList
			let NbUsecase = globalThis.PrivatePlanteUsecaseStateListObj.length;
			for(let i = 0; i < NbUsecase; i++)
			{
				let PlanteUsecaseStateObj = globalThis.PrivatePlanteUsecaseStateListObj[i];
				
				// check if in check list
				if(PlanteUsecaseStateObj.FlgInCheckList)
				{
					// get check state
					let UsecaseId = PlanteUsecaseStateObj.UsecaseId;
					let FlgChecked = document.getElementById("PlUsecaseCheckListId_" + UsecaseId).checked;
					
					// check if this usecase is to be removed from list of plante usecase or added to
					if(PlanteUsecaseStateObj.FlgCurrentlyUsedByPlante && (!FlgChecked))
					{						
						// HERE : this usecase is to be removed form list of plante usecase
						console.log("Doing delete plante usecase SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PLANTE_USECASE where Plante = $a and Usecase = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
							});
							console.log("End of delete usecase plante SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete usecase plante SQL request");
							alert("Delete plante usecase failed");
							return;
						};
						// update state
						PlanteUsecaseStateObj.FlgCurrentlyUsedByPlante = false;
					}
					else if((!PlanteUsecaseStateObj.FlgCurrentlyUsedByPlante) && FlgChecked)
					{
						// HERE : this usecase is to be added to list of pkante usecase
						console.log("Doing insert plante usecase SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PLANTE_USECASE values(null,$a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
							});
							console.log("End of insert plante usecase SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert plante usecase SQL request");
							alert("Insert plante usecase failed");
							return;
						};
						// update state
						PlanteUsecaseStateObj.FlgCurrentlyUsedByPlante = true;
					}
				}
			}
			
			//update plante Fcts
			// NOTA : PlanteFctStateListObj array row is : FctId, FctName, FlgCurrentlyUsedByPlante, FlgInCheckList
			let NbFct = globalThis.PrivatePlanteFctStateListObj.length;
			for(let i = 0; i < NbFct; i++)
			{
				let PlanteFctStateObj = globalThis.PrivatePlanteFctStateListObj[i];
				
				// check if in check list
				if(PlanteFctStateObj.FlgInCheckList)
				{
					// get check state
					let FctId = PlanteFctStateObj.FctId;
					let FlgFctChecked = document.getElementById("PlFctCheckListId_" + FctId).checked;
					
					// check if this fct is to be removed from list of product fct or added to
					if(PlanteFctStateObj.FlgCurrentlyUsedByPlante && (!FlgFctChecked))
					{
						// HERE : this Fct is to be removed form list of product Fct
						console.log("Doing delete plante Fct SQL request ...");
						try {
							globalThis.WorkingDB.exec({
								sql: "delete from PLANTE_FCTS where Plante = $a and Fct = $b",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: FctId},
							});
							console.log("End of delete Fct plante SQL request.");
						} catch(ErrorObj) {
							console.log("Echec delete Fct plante SQL request");
							alert("Delete product Fct failed");
							return;
						};
						// update state
						PlanteFctStateObj.FlgCurrentlyUsedByPlante = false;
						
						//NOW: retirer usecase et associes
						// fetch all usecase linked to fct
						console.log("Doing list usecase SQL request ...");
						let UsecaseSQLRequestResultObj = [];
						try {
							UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "select Id from USECASE where Fct = $a",
								rowMode: 'array',
								bind: {$a: FctId},
							});
							console.log("End of list usecase SQL request.");
						} catch(ErrorObj) {
							console.log("Echec list usecase SQL request");
						};
						
						let NbUsecases = UsecaseSQLRequestResultObj.length;
						for(let j=0; j < NbUsecases; j++)
						{
							let UsecaseId = UsecaseSQLRequestResultObj[j][0];
							
							let ProductUsecaseStateObj = [];
							for(let k=0; k < globalThis.PrivatePlanteUsecaseStateListObj.length; k++)
							{
								PlanteUsecaseStateObj = globalThis.PrivatePlanteUsecaseStateListObj[k];
								if(PlanteUsecaseStateObj.UsecaseId == UsecaseId) break;
							}
							
							if(PlanteUsecaseStateObj.FlgCurrentlyUsedByPlante)
							{							
								// HERE : this usecase is to be removed form list of plante usecase
								console.log("Doing delete plante usecase SQL request ...");
								try {
									globalThis.WorkingDB.exec({
										sql: "delete from PLANTE_USECASE where Plante = $a and Usecase = $b",
										rowMode: 'array',
										bind: {$a: globalThis.PrivateWorkingEltId, $b: UsecaseId},
									});
									console.log("End of delete usecase plante SQL request.");
								} catch(ErrorObj) {
									console.log("Echec delete usecase plante SQL request");
									alert("Delete plante usecase failed");
									return;
								};
								// update state
								let TmpUsecaseIdx = 0;
								let NbUsecases = globalThis.PrivatePlanteUsecaseStateListObj.length;
								for(let k=0; k < NbUsecases; k++)
								{
									if(globalThis.PrivatePlanteUsecaseStateListObj[k].UsecaseId == UsecaseId)
									{
										TmpUsecaseIdx = k;
									}
								}
								let PlanteUsecaseStateObj = globalThis.PrivatePlanteUsecaseStateListObj[TmpUsecaseIdx];
								PlanteUsecaseStateObj.FlgCurrentlyUsedByPlante = false;
							}
						}
					}
					else if((!PlanteFctStateObj.FlgCurrentlyUsedByPlante) && FlgFctChecked)
					{
						// HERE : this Fct is to be added to list of plante Fct
						console.log("Doing insert plante Fct SQL request ...");
						let SQLRequestResultObj = [];
						try {
							SQLRequestResultObj = globalThis.WorkingDB.exec({
								sql: "insert into PLANTE_FCTS values(null, $a, $b)",
								rowMode: 'array',
								bind: {$a: globalThis.PrivateWorkingEltId, $b: FctId},
							});
							console.log("End of insert plante Fct SQL request.");
						} catch(ErrorObj) {
							console.log("Echec insert plante Fct SQL request");
							alert("Insert plante Fct failed");
							return;
						};
						// update state
						PlanteFctStateObj.FlgCurrentlyUsedByPlante = true;
					}
				}
			}
			
			//update plante Espece
			// NOTA : PlanteEspeceStateListObj array row is : EspeceId, EspeceName, FlgCurrentlyUsedByPlante
			let NbEsp = globalThis.PrivatePlanteEspeceStateListObj.length;
			for(let i = 0; i < NbEsp; i++)
			{
				let PlanteEspStateObj = globalThis.PrivatePlanteEspeceStateListObj[i];
				
				// get check state
				let EspId = PlanteEspStateObj.EspeceId;
				let FlgEspChecked = document.getElementById("Esp_" + EspId + globalThis.PrivateWorkingEltId).checked;
				
				// check if this espece is to be removed from list of plante or added to
				if(PlanteEspStateObj.FlgCurrentlyUsedByPlante && (!FlgEspChecked))
				{
					// HERE : this Espece is to be removed form list of plante espece
					console.log("Doing delete plante espece SQL request ...");
					try {
						globalThis.WorkingDB.exec({
							sql: "delete from PLANTE_ESPECE where Plante = $a and EspeceId = $b",
							rowMode: 'array',
							bind: {$a: globalThis.PrivateWorkingEltId, $b: EspId},
						});
						console.log("End of delete espece plante SQL request.");
					} catch(ErrorObj) {
						console.log("Echec delete espece plante SQL request");
						alert("Delete plante Fct failed");
						return;
					};
					// update state
					PlanteEspStateObj.FlgCurrentlyUsedByPlante = false;
				}
				else if((!PlanteEspStateObj.FlgCurrentlyUsedByPlante) && FlgEspChecked)
				{
					// HERE : this Esp is to be added to list of plante Fct
					console.log("Doing insert plante Espece SQL request ...");
					let SQLRequestResultObj = [];
					try {
						SQLRequestResultObj = globalThis.WorkingDB.exec({
							sql: "insert into PLANTE_ESPECE values(null, $a, $b)",
							rowMode: 'array',
							bind: {$a: globalThis.PrivateWorkingEltId, $b: EspId},
						});
						console.log("End of insert plante espece SQL request.");
					} catch(ErrorObj) {
						console.log("Echec insert plante espece SQL request");
						alert("Insert plante espece failed");
						return;
					};
					// update state
					PlanteEspStateObj.FlgCurrentlyUsedByPlante = true;
				}
			}
			
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			// enable/disable btn as needed
			if(IsPlanteTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
			else document.getElementById("EditPdtBtn").disabled = false;
			return;
		}
		
		// update plante photo
		function DoUpdatePlantePhoto()
		{
			let ListFilePathObj = document.getElementById("SelectedPhotoInput").files;
			// get selected file
			let FileObj = ListFilePathObj[0];
			// Load file
			DoReadImageFileAsURL(FileObj).then((OpsResult) => {
				// get result
				let FileDataURL = OpsResult;
				// set data on image view
				document.getElementById("PlantePhotoView").src = FileDataURL;
			}).catch((OpsError) => {
				alert("Echec reading image");
			});
			return;
		}
		
		//check donnes clinique
		function CheckRadios(PlanteRchr,PlanteClin,PlanteReg,PlanteRegEQ,PlanteDop)
		{
			//check PlanteRchr
			if (PlanteRchr == 1) document.getElementById('Rchr1').checked = true;
			else if (PlanteRchr == 2) document.getElementById('Rchr2').checked = true;
			else if (PlanteRchr == 3) document.getElementById('Rchr3').checked = true;
			else if (PlanteRchr == 4) document.getElementById('Rchr4').checked = true;
			else if (PlanteRchr == 5) document.getElementById('Rchr5').checked = true;
			else document.getElementById('Rchr0').checked = true;
			
			//check PlanteClin
			if (PlanteClin == 1) document.getElementById('Clin1').checked = true;
			else if (PlanteClin == 2) document.getElementById('Clin2').checked = true;
			else if (PlanteClin == 3) document.getElementById('Clin3').checked = true;
			else if (PlanteClin == 4) document.getElementById('Clin4').checked = true;
			else if (PlanteClin == 5) document.getElementById('Clin5').checked = true;
			else document.getElementById('Clin0').checked = true;
			
			//check Reg
			if (PlanteReg == 1) document.getElementById('T1').checked = true;
			else if (PlanteReg == 2) document.getElementById('T2').checked = true;
			else if (PlanteReg == 3) document.getElementById('OOS').checked = true;
			else document.getElementById('Ni').checked = true;
			
			//check RegEQ
			if (PlanteRegEQ == 1) document.getElementById('SE').checked = true;
			else document.getElementById('No').checked = true;
			
			//check Dop
			if (PlanteDop == 1) document.getElementById('+').checked = true;
			else if (PlanteDop == 2) document.getElementById('-').checked = true;
			else document.getElementById('NoI').checked = true;
			
			return;
		}
		
		// append selected usecase to plante list, and check it
		function DoAppendPlUsecase(FctId)
		{
			let UsecaseComboObj = document.getElementById("PlUsecaseInputCombo_" + FctId);
			let PlanteUsecaseListObj = document.getElementById("ListCheckedPlanteFctUsecase_" + FctId);
			let PlanteId = globalThis.PrivateWorkingEltId;
		
			// get combo selection
			let UsecaseId = UsecaseComboObj.value;
			if(UsecaseId == null) return;
			// NOTA : PlanteUsecaseStateListObj array row is : UsecaseId, UsecaseName, FlgCurrentlyUsedByPlante, FlgInCheckList
			NbUsecases = globalThis.PrivatePlanteUsecaseStateListObj.length;
			let PlanteUsecaseStateObj = [];
			let TmpUsecaseIdx = 0;
			for(let i=0; i < NbUsecases; i++)
			{
				if(globalThis.PrivatePlanteUsecaseStateListObj[i].UsecaseId == UsecaseId)
				{
					PlanteUsecaseStateObj = globalThis.PrivatePlanteUsecaseStateListObj[i];
					TmpUsecaseIdx = i;
				}
			}
			
			// check if already in check list (should never happen)
			if(PlanteUsecaseStateObj.FlgInCheckList) return;
			// update check list
			
			let UsecaseTabObj = document.createElement('text');
			UsecaseTabObj.innerHTML = "&emsp;&emsp;";
			PlanteUsecaseListObj.appendChild(UsecaseTabObj);
			//...
			let UsecaseCheckListObj = document.createElement('input');
			UsecaseCheckListObj.type = 'checkbox';
			UsecaseCheckListObj.id = "PlUsecaseCheckListId_" + UsecaseId;
			UsecaseCheckListObj.checked = true;
			PlanteUsecaseListObj.appendChild(UsecaseCheckListObj);
			//...
			let CheckBoxValueTxt = "";
			CheckBoxValueTxt += PlanteUsecaseStateObj.UsecaseName;
			let UsecaseCheckListTextObj = document.createTextNode(CheckBoxValueTxt);
			PlanteUsecaseListObj.appendChild(UsecaseCheckListTextObj);
			//...
			PlanteUsecaseListObj.appendChild(document.createElement('br'));
			
			// update combo
			let UsecasePoolObj = document.getElementById("PlUsecasePoolId" + UsecaseId);
			UsecasePoolObj.disabled = true;			
			// update state array
			PlanteUsecaseStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivatePlanteUsecaseStateListObj[TmpUsecaseIdx] = PlanteUsecaseStateObj;
			return;
		}
		
		// build Plante Usecase combo
		function BuildPlUsecasePoolCombo(FctId)
		{
			let UsecaseInputComboTxt = "";
		
			// pre build combo
			UsecaseInputComboTxt += "<select id=\"PlUsecaseInputCombo_" + FctId + "\" style=\"width: 200px;\">";
			// fetch list labo
			console.log("Doing combo list Usecase SQL request ...");
			let UsecaseSQLRequestResultObj = [];
			try {
				UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from USECASE where Fct = $a order by Name ASC",
					rowMode: 'array',
					bind: {$a: FctId},
				});
				console.log("End of combo list Usecase SQL request.");
			} catch(ErrorObj) {
				console.log("Echec combo list Usecase SQL request");
			};			
			let NbResultRow = UsecaseSQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				UsecaseInputComboTxt += "<option value=\"0\">*** NO USECASE ***</option>";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					// fetch info
					let TmpResultRow = UsecaseSQLRequestResultObj[i];
					let UsecaseId = TmpResultRow[0];
					let UsecaseNameTxt = TmpResultRow[1];
					if(UsecaseNameTxt == null) UsecaseNameTxt = "UNKNOWN USECASE ID " + UsecaseId;
					UsecaseNameTxt = DoSanitizeNameTxt(UsecaseNameTxt);
					// add to combo
					UsecaseInputComboTxt += "<option id=\"PlUsecasePoolId" + UsecaseId + "\" value=\"" + UsecaseId + "\" >" + UsecaseNameTxt + "</option>";
				}
			}
			// finalize
			UsecaseInputComboTxt += "</select>";
			return UsecaseInputComboTxt;
		}
		
		// build list Plante Fct
		function BuildPlanteFctListAndCombo(PlanteId)
		{
			let FctComboObj = document.getElementById("PlFctsPoolCombo");
			let PlanteFctListObj = document.getElementById("ListCheckedPlanteFcts");
			// NOTA : PlanteFctStateListObj array row is : FctId, FctName, FlgCurrentlyUsedByPlante, FlgInCheckList
			let PlanteFctStateListObj = [];

			// fetch all Fct
			console.log("Doing list Fct SQL request ...");
			let FctSQLRequestResultObj = [];
			try {
				FctSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from FCTS order by Name ASC",
					rowMode: 'array',
				});
				console.log("End of list Fct SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Fct SQL request");
			};
			
			// build list Fct state array AND Fct pool combo
			let FctPoolComboTxt = "";
			let NbResultRow = FctSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = FctSQLRequestResultObj[i];
				let FctId = TmpResultRow[0];
				let FctNameTxt = TmpResultRow[1];
				if(FctNameTxt == null) FctNameTxt = "UNKNOWN Fct ID " + FctId;
				FctNameTxt = DoSanitizeNameTxt(FctNameTxt);
				// add to Fct state array
				let PlanteFctStateObj = {FctId: FctId, FctName: FctNameTxt, FlgCurrentlyUsedByPlante: false, FlgInCheckList: false};
				PlanteFctStateListObj.push(PlanteFctStateObj);
				// add to Fct pool combo
				FctPoolComboTxt += "<option id=\"PlFctPoolId_" + FctId + "\" value=\"" + i + "\" >" + FctNameTxt + "</option>";
			}
			// fill Fct combo
			FctComboObj.innerHTML = FctPoolComboTxt;

			// fetch plante Fct
			console.log("Doing plante Fct SQL request ...");
			let PlanteFctSQLRequestResultObj = [];
			try {
				PlanteFctSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Fct from PLANTE_FCTS where Plante = $a",
					rowMode: 'array',
					bind: {$a: PlanteId},
				});
				console.log("End of plante Fct SQL request.");
			} catch(ErrorObj) {
				console.log("Echec plante Fct SQL request");
			};
			// update Fct state array AND Fct check list 
			let FctCheckListTxt = "";
			let NbFct = PlanteFctSQLRequestResultObj.length;
			for(let i = 0; i < NbFct; i++)
			{
				// fetch Fct id
				let TmpResultRow = PlanteFctSQLRequestResultObj[i];
				let FctId = TmpResultRow[0];
				// get Fct state array IDX
				let FctPoolObj = document.getElementById("PlFctPoolId_" + FctId);
				let TmpFctIdx = FctPoolObj.value;
				let PlanteFctStateObj = PlanteFctStateListObj[TmpFctIdx];
				// update check list
				FctCheckListTxt += "&emsp;<input type=\"checkbox\" id=\"PlFctCheckListId_" + FctId + "\" onclick=\"CollapseDivPlFct(" + FctId + ")\" checked>" + PlanteFctStateObj.FctName + "</input> (utilisations : " + BuildPlUsecasePoolCombo(FctId) + " <input type=\"button\" value=\"Append\" onclick=\"DoAppendPlUsecase(" + FctId + ");\" class='append' />)<br/><div id=\"ListCheckedPlanteFctUsecase_" + FctId + "\">&emsp;&emsp;Empty list checked usecase</div>";
				// update combo
				FctPoolObj.disabled = true;
				// update Plante state array
				PlanteFctStateObj.FlgCurrentlyUsedByPlante = true;
				PlanteFctStateObj.FlgInCheckList = true;
			}
			// fill Plante check list
			PlanteFctListObj.innerHTML = FctCheckListTxt;
			// save Plante state array
			globalThis.PrivatePlanteFctStateListObj = PlanteFctStateListObj;
			return;
		}
		
		// build list plante usecase
		function BuildPlanteUsecaseList(PlanteId)
		{
			//fetch plante fct
			console.log("Doing plante fct SQL request ...");
			let PlanteFctSQLRequestResultObj = [];
			try {
				PlanteFctSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Fct from PLANTE_FCTS where Plante = $a",
					rowMode: 'array',
					bind: {$a: PlanteId},
				});
				console.log("End of plante Fct SQL request.");
			} catch(ErrorObj) {
				console.log("Echec plante Fct SQL request");
			};
			
			// NOTA : PlanteUsecaseStateListObj array row is : UsecaseId, UsecaseName, FlgCurrentlyUsedByPlante, FlgInCheckList
			let PlanteUsecaseStateListObj = [];

			//pour tous les fcts affiches
			let NbResultRow = PlanteFctSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch fct id
				let TmpResultRow = PlanteFctSQLRequestResultObj[i];
				let FctId = TmpResultRow[1];
				
				//Get Div Id
				let PlanteFctListObj = document.getElementById("ListCheckedPlanteFctUsecase_" + FctId);
				//init text
				let UsecaseCheckListTxt = "";
				
				// fetch all usecase linked to fct
				console.log("Doing list usecase SQL request ...");
				let UsecaseSQLRequestResultObj = [];
				try {
					UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select Id,Name from USECASE where Fct = $a order by Name ASC",
						rowMode: 'array',
						bind: {$a: FctId},
					});
					console.log("End of list usecase SQL request.");
				} catch(ErrorObj) {
					console.log("Echec list usecase SQL request");
				};
			
				// build list usecase state array
				let CurrentUsecasesIds = [];
				let NbUsecaseResultRow = UsecaseSQLRequestResultObj.length;
				for(let j = 0; j < NbUsecaseResultRow; j++)
				{
					// fetch info
					let TmpUsecaseResultRow = UsecaseSQLRequestResultObj[j];
					let UsecaseId = TmpUsecaseResultRow[0];
					CurrentUsecasesIds.push(UsecaseId);
					let UsecaseNameTxt = TmpUsecaseResultRow[1];
					if(UsecaseNameTxt == null) UsecaseNameTxt = "UNKNOWN USECASE ID " + UsecaseId;
					UsecaseNameTxt = DoSanitizeNameTxt(UsecaseNameTxt);
					// add to usecase state array
					let PlanteUsecaseStateObj = {UsecaseId: UsecaseId, UsecaseName: UsecaseNameTxt, FlgCurrentlyUsedByPlante: false, FlgInCheckList: false};
					PlanteUsecaseStateListObj.push(PlanteUsecaseStateObj);
				}

				// fetch plante usecases
				console.log("Doing plante usecases SQL request ...");
				let PlanteUsecasesSQLRequestResultObj = [];
				try {
					PlanteUsecasesSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select Usecase from PLANTE_USECASE where Plante = $a",
						rowMode: 'array',
						bind: {$a: PlanteId},
					});
					console.log("End of plante usecases SQL request.");
				} catch(ErrorObj) {
					console.log("Echec plante usecases SQL request");
				};
				
				// update usecase state array AND usecase check list 
				let NbUsecase = PlanteUsecasesSQLRequestResultObj.length;
				for(let j = 0; j < NbUsecase; j++)
				{
					// fetch usecase id
					let TmpResultRow = PlanteUsecasesSQLRequestResultObj[j];
					let UsecaseId = TmpResultRow[0];
					let NbCurrentUsecase = CurrentUsecasesIds.length;
					for(let k=0; k < NbCurrentUsecase; k++)
					{
						if (UsecaseId == CurrentUsecasesIds[k])
						{
							// get usecase state array IDX
							let UsecasePoolObj = document.getElementById("PlUsecasePoolId" + UsecaseId);
							
							NbUsecases = PlanteUsecaseStateListObj.length;
							let PlanteUsecaseStateObj = [];
							let TmpUsecaseIdx = 0;
							for(let l=0; l < NbUsecases; l++)
							{
								if(PlanteUsecaseStateListObj[l].UsecaseId == UsecaseId)
								{
									PlanteUsecaseStateObj = PlanteUsecaseStateListObj[l];
									TmpUsecaseIdx = l;
								}
							}
							// update check list
							UsecaseCheckListTxt += "&emsp;&emsp;<input type=\"checkbox\" id=\"PlUsecaseCheckListId_" + UsecaseId + "\" checked>" + PlanteUsecaseStateObj.UsecaseName + "</input><br/>";
							// update combo
							UsecasePoolObj.disabled = true;
							// update usecase state array
							PlanteUsecaseStateObj.FlgCurrentlyUsedByPlante = true;
							PlanteUsecaseStateObj.FlgInCheckList = true;
						}
					}
				}
				// fill usecase check list
				PlanteFctListObj.innerHTML = UsecaseCheckListTxt;
			}
			// save usecase state array
			globalThis.PrivatePlanteUsecaseStateListObj = PlanteUsecaseStateListObj;			
			return;
		}

		//fill list plante espece
		function FillPlanteEspeceList(PlanteId)
		{
			//pre-build div
			let PlanteEspeceListObj = document.getElementById("ListCheckedPlanteEspece");
			
			// NOTA : PlanteEspeceStateListObj array row is : EspeceId, EspeceName, FlgCurrentlyUsedByPlante
			let PlanteEspeceStateListObj = [];
			
			// fetch all Espece
			console.log("Doing list Espece SQL request ...");
			let EspeceSQLRequestResultObj = [];
			try {
				EspeceSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from ESPECE",
					rowMode: 'array',
				});
				console.log("End of list Espece SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Espece SQL request");
			};
			
			// build list Espece state array and div
			let EspeceTxt = "<b>Espces concernes : </b>";
			let NbResultRow = EspeceSQLRequestResultObj.length;
			for(let i = 0; i < NbResultRow; i++)
			{
				// fetch info
				let TmpResultRow = EspeceSQLRequestResultObj[i];
				let EspeceId = TmpResultRow[0];
				let EspeceNameTxt = TmpResultRow[1];
				if(EspeceNameTxt == null) EspeceNameTxt = "UNKNOWN Espece ID " + EspeceId;
				EspeceNameTxt = DoSanitizeNameTxt(EspeceNameTxt);
				// add to Fct state array
				let EspeceStateListObj = {EspeceId: EspeceId, EspeceName: EspeceNameTxt, FlgCurrentlyUsedByPlante: false};
				PlanteEspeceStateListObj.push(EspeceStateListObj);
				// add to Fct pool combo
				EspeceTxt += "<input type='checkbox' id='Esp_"+ EspeceId + PlanteId + "' value='" + EspeceNameTxt +"'>" + EspeceNameTxt + "</input>";
			}
			PlanteEspeceListObj.innerHTML = EspeceTxt;
			
			//fetch plante espece
			console.log("Doing plante espece SQL request ...");
			let PlanteEspeceSQLRequestResultObj = [];
			try {
				PlanteEspeceSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select EspeceId from PLANTE_ESPECE where Plante = $a",
					rowMode: 'array',
					bind: {$a: PlanteId},
				});
				console.log("End of plante Espece SQL request.");
			} catch(ErrorObj) {
				console.log("Echec plante Espece SQL request");
			};
			
			//pour tous les especes cochees
			let NbEspece = PlanteEspeceSQLRequestResultObj.length;
			for(let i = 0; i < NbEspece; i++)
			{
				// fetch espece id
				let TmpResultRow = PlanteEspeceSQLRequestResultObj[i];
				let EspId = TmpResultRow[0];
				
				//Check the checkbox
				document.getElementById("Esp_" + EspId + PlanteId).checked = true;
				
				//change Flg
				PlanteEspeceStateListObj[EspId-1].FlgCurrentlyUsedByPlante = true;
			}
			// save usecase state array
			globalThis.PrivatePlanteEspeceStateListObj = PlanteEspeceStateListObj;
		}

		// build list plante Usecase for addition
		function BuildPlanteUsecaseListForAdd(FctId)
		{
			// fetch all Usecase
			console.log("Doing list Usecase SQL request ...");
			let UsecaseSQLRequestResultObj = [];
			try {
				UsecaseSQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from USECASE where Fct = $a order by Name ASC",
					rowMode: 'array',
					bind: {$a: FctId},
				});
				console.log("End of list Usecase SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Usecase SQL request");
			};
			
			//Get Div Id
			let PlanteUsecaseListObj = document.getElementById("ListCheckedPlanteFctUsecase_" + FctId);
			//init text
			let UsecaseCheckListTxt = "";
			// fill Usecase check list
			PlanteUsecaseListObj.innerHTML = UsecaseCheckListTxt;
			
			// build list Usecase state array
			let NbUsecaseResultRow = UsecaseSQLRequestResultObj.length;
			for(let i = 0; i < NbUsecaseResultRow; i++)
			{
				// fetch info
				let TmpUsecaseResultRow = UsecaseSQLRequestResultObj[i];
				let UsecaseId = TmpUsecaseResultRow[0];
				let UsecaseNameTxt = TmpUsecaseResultRow[1];
				if(UsecaseNameTxt == null) UsecaseNameTxt = "UNKNOWN Usecase ID " + UsecaseId;
				UsecaseNameTxt = DoSanitizeNameTxt(UsecaseNameTxt);
				// add to global Usecase state array
				let PlanteUsecaseStateObj = {UsecaseId: UsecaseId, UsecaseName: UsecaseNameTxt, FlgCurrentlyUsedByPlante: false, FlgInCheckList: false};
				globalThis.PrivatePlanteUsecaseStateListObj.push(PlanteUsecaseStateObj);
			}
			return;
		}

		// append selected fcts to plante list, and check it
		function DoAppendPlanteFcts()
		{
			let FctsComboObj = document.getElementById("PlFctsPoolCombo");
			let PlanteFctListObj = document.getElementById("ListCheckedPlanteFcts");
		
			// get combo selection
			let TmpFctIdx = FctsComboObj.value;
			if(TmpFctIdx == null) return;
			// NOTA : PlanteFctStateListObj array row is : FctId, FctName, FlgCurrentlyUsedByPlante, FlgInCheckList
			let PlanteFctStateObj = globalThis.PrivatePlanteFctStateListObj[TmpFctIdx];
			// check if already in check list (should never happen)
			if(PlanteFctStateObj.FlgInCheckList) return;
			// update check list
			FctId = PlanteFctStateObj.FctId;
			
			let UsecaseFctTab = document.createElement('text');
			UsecaseFctTab.innerHTML = "&emsp;";
			PlanteFctListObj.appendChild(UsecaseFctTab);
			
			<!-- let FctCheckListObj = document.createElement('input'); -->
			<!-- FctCheckListObj.type = 'checkbox'; -->
			<!-- FctCheckListObj.id = "PlFctCheckListId_" + FctId; -->
			<!-- //FctCheckListObj.onclick = "CollapseDivPlFct(" + FctId + ")"; -->
			<!-- FctCheckListObj.checked = true; -->
			<!-- PlanteFctListObj.appendChild(FctCheckListObj);
			<!-- //... -->
			<!-- let CheckBoxValueTxt = ""; -->
			<!-- CheckBoxValueTxt += PlanteFctStateObj.FctName; -->
			<!-- let FctCheckListTextObj = document.createTextNode(CheckBoxValueTxt); -->
			<!-- PlanteFctListObj.appendChild(FctCheckListTextObj); -->
			
			//...
			let FctCheckListTextObj = document.createElement('text');
			FctCheckListTextObj.innerHTML = "<input type=\"checkbox\" id=\"PlFctCheckListId_" + FctId + "\" onclick=\"CollapseDivPlFct(" + FctId + ")\" checked>" + PlanteFctStateObj.FctName + "</input>";
			PlanteFctListObj.appendChild(FctCheckListTextObj);
			//...
			let UsecaseFctCombo = document.createElement('text');
			UsecaseFctCombo.innerHTML = "&nbsp;(utilisations : " + BuildPlUsecasePoolCombo(FctId) + " <input type=\"button\" value=\"Append\" onclick=\"DoAppendPlUsecase(" + FctId + ");\" class='append' />)<br/><div id=\"ListCheckedPlanteFctUsecase_" + FctId + "\">&emsp;Empty list checked usecase</div>";
			PlanteFctListObj.appendChild(UsecaseFctCombo);
			
			// update combo
			let FctPoolObj = document.getElementById("PlFctPoolId_" + FctId);
			FctPoolObj.disabled = true;
			// update state array
			PlanteFctStateObj.FlgInCheckList = true;	// in check list
			globalThis.PrivatePlanteFctStateListObj[TmpFctIdx] = PlanteFctStateObj;
			BuildPlanteUsecaseListForAdd(FctId);
			return;
		}
		
		// edit Plante
		function DoEditPlante(PlanteId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");
			let FlgPlanteIsValid = false;

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = PlanteId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdatePlante(" + PlanteId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"AfterEditPlante();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeletePlante(" + PlanteId + ");\" class='Delete' ";
			if(IsPlanteUsedBySomeProduct(PlanteId) || IsPlanteUsedBySomeUsecase(PlanteId) || (PlanteId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";			
			// append Plante view
			let PlanteInfoTxt = "";
			PlanteInfoTxt += "<h1>Plante " + PlanteId + " Info :</h1>";
			// fetch Plante info
			let PlanteSQLRequestResultObj = [];
			if(PlanteId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let PlanteInfo = [0, "Plante_0", new Uint8Array(), "", "", new Uint8Array(), new Uint8Array(), new Uint8Array(), "", "", "", new Uint8Array(), new Uint8Array(), new Uint8Array(), new Uint8Array(), new Uint8Array(), new Uint8Array(), 0, 0, 0, 0, 0, new Uint8Array()];
				PlanteSQLRequestResultObj.push(PlanteInfo);
			}
			else
			{
				// existing elt
				console.log("Doing Plante info SQL request ...");
				try {
					PlanteSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from Plante where Id = $a",
						rowMode: 'array',
						bind: {$a: PlanteId},
					});
					console.log("End of Plante info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec Plante info  SQL request");
				};
			}
			// build view
			let NbResultRow = PlanteSQLRequestResultObj.length;
			let PlanteRchr = 0;
			let PlanteClin = 0;
			let PlanteReg = 0;
			let PlanteRegEQ = 0;
			let PlanteDop = 0;
			if(NbResultRow != 1)
			{
				PlanteInfoTxt += "Nb Plante (" + NbResultRow +") missmatch for id " + PlanteId + "<br/>";
			}
			else
			{
				// fetch info
				let PlanteInfo = PlanteSQLRequestResultObj[0];
				let PlanteNameTxt = PlanteInfo[1];
				if(PlanteNameTxt == null) PlanteNameTxt = "UNDEFINED";
				PlanteNameTxt = DoSanitizeNameTxt(PlanteNameTxt);
				let PlantePhotoBlob = PlanteInfo[2];
				if(PlantePhotoBlob == null) PlantePhotoBlob = new Uint8Array();
				let PlanteLatinTxt = PlanteInfo[3];
				if(PlanteLatinTxt == null) PlanteLatinTxt = "UNDEFINED";
				PlanteLatinTxt = DoSanitizeNameTxt(PlanteLatinTxt);
				let PlanteFamilleTxt = PlanteInfo[4];
				if(PlanteFamilleTxt == null) PlanteFamilleTxt = "UNDEFINED";
				PlanteFamilleTxt = DoSanitizeNameTxt(PlanteFamilleTxt);
				let PlanteBotanique = PlanteInfo[5];
				if(PlanteBotanique == null) PlanteBotanique = new Uint8Array();
				let PlanteMolecules = PlanteInfo[6];
				if(PlanteMolecules == null) PlanteMolecules = new Uint8Array();
				let PlantePDyn = PlanteInfo[7];
				if(PlantePDyn == null)
				{
					PlantePDyn = CastRichTextToBuffer("Aucune donne");
				}
				let PlanteP1 = PlanteInfo[8];
				if(PlanteP1 == null) PlanteP1 = "UNDEFINED";
				let PlanteP2 = PlanteInfo[9];
				if(PlanteP2 == null) PlanteP2 = "UNDEFINED";
				let PlanteP3 = PlanteInfo[10];
				if(PlanteP3 == null) PlanteP3 = "UNDEFINED";
				let PlantePCin = PlanteInfo[11];
				if(PlantePCin == null)
				{
					PlantePCin = CastRichTextToBuffer("Aucune donne");
				}
				let PlanteGest = PlanteInfo[12];
				if(PlanteGest == null)
				{
					PlanteGest = CastRichTextToBuffer("Aucune donne.<br/>Par prcaution ne pas utiliser.");
				}
				let PlanteSurdosage = PlanteInfo[13];
				if(PlanteSurdosage == null)
				{
					PlanteSurdosage = CastRichTextToBuffer("Aucune tude");
				}
				let PlanteSources = PlanteInfo[14];
				if(PlanteSources == null) PlanteSources = new Uint8Array();
				let PlanteInterac = PlanteInfo[15];
				if(PlanteInterac == null)
				{
					PlanteInterac = CastRichTextToBuffer("Aucune intraction rapporte ce jour.");
				}
				PlanteRchr = PlanteInfo[17];
				PlanteClin = PlanteInfo[18];
				PlanteReg = PlanteInfo[19];
				PlanteRegEQ = PlanteInfo[20];
				PlanteDop = PlanteInfo[21];
				let PlantePoso = PlanteInfo[22];
				if(PlantePoso == null)
				{
					PlantePoso = CastRichTextToBuffer("Aucune posologie renseigne.");
				}
				
				// build form
				PlanteInfoTxt += "<h2>Informations gnrales</h2><b>Nom vernaculaire : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + PlanteNameTxt + "\" onchange=\"DoCheckNameValidity()\" placeholder='Entrez le nom commun de la plante.' /><br/><br/>";
				PlanteInfoTxt += "<img id=\"PlantePhotoView\" style=\"max-height: 500px; max-width: 500px\" src=" + CastBufferToImgURLData(PlantePhotoBlob) + " /> <input id=\"SelectedPhotoInput\" type=\"file\" accept=\"image/*\" onchange=\"DoUpdatePlantePhoto()\" /><br/><br/>";
				PlanteInfoTxt += "<b>Nom scientifique : </b><input id=\"EltLatinInput\" size=\"64\" type=\"text\" value=\"" + PlanteLatinTxt + "\" onchange=\"DoCheckNameValidity()\" placeholder='Entrez le nom scientifique de la plante.' /><br/><br/>";
				PlanteInfoTxt += "<b>Famille : </b><input id=\"EltFamilleInput\" size=\"64\" type=\"text\" value=\"" + PlanteFamilleTxt + "\" onchange=\"DoCheckNameValidity()\" placeholder='Entrez la famille de la plante.' /><br/><br/>";
				PlanteInfoTxt += "<h3>Informations traitant de la botanique :</h3><textarea id=\"PlanteBotaniqueInput\" >Initializing Rich text editor ...</textarea><br/>";
				RichTextDataBotanique = CastBufferToRichText(PlanteBotanique);
				PlanteInfoTxt += "<h3>Partie(s) utilise(s)</h3>";
				PlanteInfoTxt += "&emsp;<select id=\"UsePartPlPoolCombo\" style=\"width: 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendPlUsePart();\" class='append' /><br/><div id=\"ListCheckedPlanteUsePart\">Empty list checked plante UsePart</div>";
				PlanteInfoTxt += "<h3>Donnes exprimentales</h3>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Rchr' id='Rchr0' value='0'><label for 'Rchr0'>Aucune recherche exprimentale n'a t effectue.</label><br/>&emsp;<input type='radio' name='Rchr' id='Rchr1' value='1'><label for 'Rchr1'>Des recherches ont t faites in vitro.</label><br/>&emsp;<input type='radio' name='Rchr' id='Rchr2' value='2'><label for 'Rchr2'>Quelques recherches ont t faites sur des rongeurs.</label><br/>&emsp;<input type='radio' name='Rchr' id='Rchr3' value='3'><label for 'Rchr3'>De  nombreuses recherches ont t faites sur des rongeurs.</label><br/>&emsp;<input type='radio' name='Rchr' id='Rchr4' value='4'><label for 'Rchr4'>Quelques recherches ont t faites sur des espces cibles.</label><br/>&emsp;<input type='radio' name='Rchr' id='Rchr5' value='5'><label for 'Rchr5'>De nombreuses recherches ont t faites sur des espces cibles.</label><br/>";
				PlanteInfoTxt += "<h3>Donnes cliniques</h3>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Clin' id='Clin0' value='0'><label for 'Clin0'>Aucune donne clinique n'est disponible.</label><br/>&emsp;<input type='radio' name='Clin' id='Clin1' value='1'><label for 'Clin1'>Un essai clinique a t ralis sur l'une des espces cibles.</label><br/>&emsp;<input type='radio' name='Clin' id='Clin2' value='2'><label for 'Clin2'>Plusieurs essais cliniques ont t raliss sur l'une des espces cibles.</label><br/>&emsp;<input type='radio' name='Clin' id='Clin3' value='3'><label for 'Clin3'>Un essai clinique a t ralis sur au moins 2 espces cibles.</label><br/>&emsp;<input type='radio' name='Clin' id='Clin4' value='4'><label for 'Clin4'>Plusieurs essais cliniques ont t raliss sur au moins 2 espces cibles.</label><br/>&emsp;<input type='radio' name='Clin' id='Clin5' value='5'><label for 'Clin5'>Plusieurs essai clinique ont t ralis sur toutes les espces cibles.</label><br/>";
				PlanteInfoTxt += "<h2>Informations mdicales</h2><b>Molcules constitutives :</b><br/><textarea id=\"PlanteMoleculesInput\" >Initializing Rich text editor ...</textarea><br/>";
				RichTextDataMolecules = CastBufferToRichText(PlanteMolecules);
				PlanteInfoTxt += "<h3>Proprits pharmacodynamiques :</h3><textarea id=\"PlantePDynInput\" >Initializing Rich text editor ...</textarea><br/>";
				RichTextDataPDyn = CastBufferToRichText(PlantePDyn);
				PlanteInfoTxt += "&emsp; <b>Proprits principales :</b> 1 - <input id=\"EltP1Input\" size=\"32\" type=\"text\" value=\"" + PlanteP1 + "\" onchange=\"DoCheckNameValidity()\" placeholder='Proprit 1' />&nbsp; 2 - <input id=\"EltP2Input\" size=\"32\" type=\"text\" value=\"" + PlanteP2 + "\" onchange=\"DoCheckNameValidity()\" placeholder='Proprit 2' />&nbsp; 3 - <input id=\"EltP3Input\" size=\"32\" type=\"text\" value=\"" + PlanteP3 + "\" onchange=\"DoCheckNameValidity()\" placeholder='Proprit 3' /><br/><br/>";
				PlanteInfoTxt += "<h3>Proprits pharmacocintiques :</h3><textarea id=\"PlantePCinInput\" >Initializing Rich text editor ...</textarea><br/>";
				PlanteInfoTxt += "<h3>Applications mdicales</h3>";
				PlanteInfoTxt += "&emsp;<b>Utilisation(s) pour la : </b> <select id=\"PlFctsPoolCombo\" style=\"width: 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendPlanteFcts();\" class='append' /><br/><div id=\"ListCheckedPlanteFcts\">Empty list checked product fcts</div>";
				PlanteInfoTxt += "<h3>Contre-indications</h3>";
				PlanteInfoTxt += "&emsp;<select id=\"CtrIndicPlPoolCombo\" style=\"width:CtrIndic 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendPlCtrIndic();\" class='append' /><br/><div id=\"ListCheckedPlanteCtrIndic\">Empty list checked plante CtrIndic</div>";
				PlanteInfoTxt += "<h3>Effets secondaires</h3>";
				PlanteInfoTxt += "&emsp;<select id=\"Effet2PlPoolCombo\" style=\"width: 200px;\"></select> <input type=\"button\" value=\"Append\" onclick=\"DoAppendPlEffet2();\" class='append' /><br/><div id=\"ListCheckedPlanteEffet2\">Empty list checked plante Effet2</div>";
				RichTextDataPCin = CastBufferToRichText(PlantePCin);
				
				PlanteInfoTxt += "<h3>Posologie</h3>";
				PlanteInfoTxt += "&emsp;<i>Ecrivez sous le format : \"Forme galnique : Posologie (espce)\"</i><br/><br/>";
				PlanteInfoTxt += "<textarea id=\"PlantePosoInput\" >Initializing Rich text editor ...</textarea>";
				RichTextDataPoso = CastBufferToRichText(PlantePoso);
				PlanteInfoTxt += "<div id=\"ListCheckedPlanteEspece\">Empty list checked plante Espece</div>";
				
				PlanteInfoTxt += "<h3>Toxicit :</h3><textarea id=\"PlanteSurdosageInput\" >Initializing Rich text editor ...</textarea><br/>";
				RichTextDataSurdosage = CastBufferToRichText(PlanteSurdosage);
				PlanteInfoTxt += "<b>Gestation et lactation :</b><br/><textarea id=\"PlanteGestInput\" >Initializing Rich text editor ...</textarea><br/>";
				RichTextDataGest = CastBufferToRichText(PlanteGest);
				PlanteInfoTxt += "<h3>Intractions mdicamenteuses :</h3><textarea id=\"PlanteInteracInput\" >Initializing Rich text editor ...</textarea><br/>";
				RichTextDataInterac = CastBufferToRichText(PlanteInterac);
				
				PlanteInfoTxt += "<h3>Point rglementation</h3>";
				PlanteInfoTxt += "&emsp;Inscription  l'annexe du rglement des LMR<br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Reg' id='T1' value='1'><label for 'T1'>Inscrite au tableau 1</label><br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Reg' id='T2' value='2'><label for 'T2'>Inscrite au tableau 2</label><br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Reg' id='OOS' value='3'><label for 'OOS'>Inscrite sur la liste \"Out-of-scope\".</label><br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Reg' id='Ni' value='0'><label for 'Ni'>Non inscrite</label><br/><br/>";
				
				PlanteInfoTxt += "&emsp;Inscription  la liste des \"subtances essentielles\" pour le traitement des quids.<br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='RegEQ' id='SE' value='1'><label for 'SE'>Inscrite </label><br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='RegEQ' id='No' value='0'><label for 'No'>Non inscrite</label><br/><br/>";
				
				PlanteInfoTxt += "&emsp;Informations concernant le dopage :<br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Dop' id='+' value='1'><label for '+'>Raction positive aux contrles anti-dopages.</label><br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Dop' id='-' value=''><label for '-'>Raction ngative aux contrles anti-dopages.</label><br/>";
				PlanteInfoTxt += "&emsp;<input type='radio' name='Dop' id='NoI' value='0'><label for 'NoI'>Aucune information.</label><br/>";
				
				PlanteInfoTxt += "<h2>Sources :</h2><textarea id=\"PlanteSourcesInput\" >Initializing Rich text editor ...</textarea><br/>";
				RichTextDataSources = CastBufferToRichText(PlanteSources);
				
				// say everything is ok
				FlgPlanteIsValid = true;
			}
			RowEditFormTxt += PlanteInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			
			if(FlgPlanteIsValid)
			{
				//fill ctrindic list
				BuildPlanteEffet2ListAndCombo(PlanteId);
				//fill effet2 list
				BuildPlanteCtrIndicListAndCombo(PlanteId);
				//fill UsePart list
				BuildPlanteUsePartListAndCombo(PlanteId);
				//fill Fct list
				BuildPlanteFctListAndCombo(PlanteId);
				//fill usecase list
				BuildPlanteUsecaseList(PlanteId);
				//fill espece list
				FillPlanteEspeceList(PlanteId);
				
				//check Radios
				CheckRadios(PlanteRchr,PlanteClin,PlanteReg,PlanteRegEQ,PlanteDop);
				
				//activate ritchtext area
				ActivateRichTextOnTextArea("PlanteBotaniqueInput",RichTextDataBotanique);
				ActivateRichTextOnTextArea("PlanteMoleculesInput",RichTextDataMolecules);
				ActivateRichTextOnTextArea("PlantePDynInput",RichTextDataPDyn);
				ActivateRichTextOnTextArea("PlantePCinInput",RichTextDataPCin);
				ActivateRichTextOnTextArea("PlanteGestInput",RichTextDataGest);
				ActivateRichTextOnTextArea("PlantePosoInput",RichTextDataPoso);
				ActivateRichTextOnTextArea("PlanteSurdosageInput",RichTextDataSurdosage);
				ActivateRichTextOnTextArea("PlanteInteracInput",RichTextDataInterac);
				ActivateRichTextOnTextArea("PlanteSourcesInput",RichTextDataSources);
			}
			return;
		}
		
		// add new Plante
		function GoAddNewPlante()
		{
			// use special ID 0 to indicate New elt
			DoEditPlante(0);
			return;
		}

		// edit Plante table
		function DoEditPlanteTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new Plante\" onclick=\"GoAddNewPlante();\" class='New' /> OR click a plant to edit :<br/>";
			// list all existing Plante : exec SQL request on Working DB
			console.log("Doing list Plante SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from Plante",
					rowMode: 'array',
				});
				console.log("End of list Plante SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list Plante SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO Plante";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditPlante(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// delete UsePart
		function GoDeleteUsePart(UsePartId)
		{
			// check something to do
			if(globalThis.PrivateWorkingEltId != 0)
			{
				// ask confirmation
				if(!window.confirm("Do you really want to delete this drug form ?")) return;
				// delete entry
				console.log("Doing delete UsePart SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "delete from UsePart where Id = $a",
						rowMode: 'array',
						bind: {$a: globalThis.PrivateWorkingEltId},
					});
					console.log("End of delete UsePart SQL request.");
				} catch(ErrorObj) {
					console.log("Echec delete UsePart SQL request");
					alert("Delete failled");
					return;
				};
				// update working elt id
				globalThis.PrivateWorkingEltId = 0;
				// enable save db btn
				document.getElementById("SaveDBBtn").disabled = false;
				// enable/disable btn as needed
				if(IsUsePartTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
				else document.getElementById("EditPdtBtn").disabled = false;
			}
			// back to select row
			DoEditUsePartTable();
			return;
		}
		
		// update UsePart
		function GoUpdateUsePart(UsePartId)
		{
			// fecth value to save
			let UsePartNameTxt = document.getElementById("EltNameInput").value;			
			// local save entry
			if(globalThis.PrivateWorkingEltId == 0)
			{
				// do insert
				console.log("Doing insert UsePart SQL request ...");
				let SQLRequestResultObj = [];
				try {
					SQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "insert into UsePart values(null, $a) returning Id",
						rowMode: 'array',
						bind: {$a: UsePartNameTxt},
					});
					console.log("End of insert UsePart SQL request.");
				} catch(ErrorObj) {
					console.log("Echec insert UsePart SQL request");
					alert("Insert failled");
					return;
				};
				// update working elt id
				let TmpResultRow = SQLRequestResultObj[0];
				globalThis.PrivateWorkingEltId = TmpResultRow[0];
				console.log("Inserted UsePart Id = " + globalThis.PrivateWorkingEltId);
				// notify done
				alert("Insert done");
			}
			else
			{
				// do update
				console.log("Doing update UsePart SQL request ...");
				try {
					globalThis.WorkingDB.exec({
						sql: "update UsePart set Name = $a where Id = $b",
						rowMode: 'array',
						bind: {$a: UsePartNameTxt, $b: globalThis.PrivateWorkingEltId},
					});
					console.log("End of update UsePart SQL request.");
				} catch(ErrorObj) {
					console.log("Echec update UsePart SQL request");
					alert("Update failled");
					return;
				};
				// notify done
				alert("Update done");
			}
			// enable save db btn
			document.getElementById("SaveDBBtn").disabled = false;
			// enable/disable btn as needed
			if(IsUsePartTblEmpty()) document.getElementById("EditPdtBtn").disabled = true;
			else document.getElementById("EditPdtBtn").disabled = false;
			return;
		}

		// edit UsePart
		function DoEditUsePart(UsePartId)
		{
			let RowEditFormObj = document.getElementById("RowEditForm");

			// save working elt id (used by update / delete operations)
			globalThis.PrivateWorkingEltId = UsePartId;
			// Pre build view
			let RowEditFormTxt = "";
			RowEditFormTxt += "<input type=\"button\" id=\"SaveWorkingEltBtn\" value=\"Update\" onclick=\"GoUpdateUsePart(" + UsePartId + ");\" class='Update' /> ";
			RowEditFormTxt += "<input type=\"button\" value=\"Cancel\" onclick=\"DoEditUsePartTable();\" class='Cancel' /> ";
			RowEditFormTxt += "<input type=\"button\" id=\"DeleteWorkingEltBtn\" value=\"Delete\" onclick=\"GoDeleteUsePart(" + UsePartId + ");\" class='Delete' ";
			if(IsUsePartUsedBySomeProduct(UsePartId) || (UsePartId == 0)) RowEditFormTxt += "disabled=\"true\"";
			RowEditFormTxt += " /><br/>";			
			// append UsePart view
			let UsePartInfoTxt = "";
			UsePartInfoTxt += "<h1>UsePart " + UsePartId + " Info :</h1><br/>";
			// fetch UsePart info
			let UsePartSQLRequestResultObj = [];
			if(UsePartId == 0)
			{
				// fresh new elt
				// Mimic SQL request result
				let UsePartInfo = [0, "UsePart_0"];
				UsePartSQLRequestResultObj.push(UsePartInfo);
			}
			else
			{
				// existing elt
				console.log("Doing UsePart info SQL request ...");
				try {
					UsePartSQLRequestResultObj = globalThis.WorkingDB.exec({
						sql: "select * from UsePart where Id = $a",
						rowMode: 'array',
						bind: {$a: UsePartId},
					});
					console.log("End of UsePart info  SQL request.");
				} catch(ErrorObj) {
					console.log("Echec UsePart info  SQL request");
				};
			}
			// build view
			let NbResultRow = UsePartSQLRequestResultObj.length;
			if(NbResultRow != 1)
			{
				UsePartInfoTxt += "Nb UsePart (" + NbResultRow +") missmatch for id " + UsePartId + "<br/>";
			}
			else
			{
				// fetch info
				let UsePartInfo = UsePartSQLRequestResultObj[0];
				let UsePartNameTxt = UsePartInfo[1];
				if(UsePartNameTxt == null) UsePartNameTxt = "UNDEFINED";
				UsePartNameTxt = DoSanitizeNameTxt(UsePartNameTxt);
				// build form
				UsePartInfoTxt += "<b>UsePart NAME : </b><input id=\"EltNameInput\" size=\"64\" type=\"text\" value=\"" + UsePartNameTxt + "\" onchange=\"DoCheckNameValidity()\" /><br/>";
			}
			RowEditFormTxt += UsePartInfoTxt;
			// hide row choice form
			document.getElementById("RowChoiceForm").style.display = 'none';
			// show edit form
			RowEditFormObj.innerHTML = RowEditFormTxt;
			RowEditFormObj.style.visibility = 'visible';
			return;
		}

		// add new UsePart
		function GoAddNewUsePart()
		{
			// use special ID 0 to indicate New elt
			DoEditUsePart(0);
			return;
		}

		// edit UsePart table
		function DoEditUsePartTable()
		{
			let RowChoiceFormObj = document.getElementById("RowChoiceForm");
			
			// Pre build view
			let RowChoiceFormTxt = "";
			RowChoiceFormTxt += "<input type=\"button\" value=\"Back to table choice\" onclick=\"GoBackToTableChoice();\" class='Back' /><br/><br/>";
			RowChoiceFormTxt += "Click <input type=\"button\" value=\"Add new UsePart\" onclick=\"GoAddNewUsePart();\" class='New' /> OR click a usepart to edit :<br/>";
			// list all existing UsePart : exec SQL request on Working DB
			console.log("Doing list UsePart SQL request ...");
			let SQLRequestResultObj = [];
			try {
				SQLRequestResultObj = globalThis.WorkingDB.exec({
					sql: "select Id,Name from UsePart",
					rowMode: 'array',
				});
				console.log("End of list UsePart SQL request.");
			} catch(ErrorObj) {
				console.log("Echec list UsePart SQL request");
			};
			// append list product
			let ResultList = "";
			let NbResultRow = SQLRequestResultObj.length;
			if(NbResultRow == 0)
			{
				ResultList += "NO UsePart";
			}
			else
			{			
				for(let i = 0; i < NbResultRow; i++)
				{
					let TmpResultRow = SQLRequestResultObj[i];
					
					ResultList += "<span class=\"MatchResultClass\" onclick=\"DoEditUsePart(" + TmpResultRow[0] +");\">Elt " + TmpResultRow[0] + " : " + TmpResultRow[1] + "</span><br/>";
				}
			}
			RowChoiceFormTxt += ResultList;
			// hide table choice and edit form
			document.getElementById("TableChoiceForm").style.display = 'none';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			// show edit form
			RowChoiceFormObj.innerHTML = RowChoiceFormTxt;
			RowChoiceFormObj.style.display = 'inline';
			RowChoiceFormObj.style.visibility = 'visible';
			return;
		}
		
		// go back to search page
		function GoBackToTableChoice()
		{
			// go back to dflt state
			document.getElementById("RowEditForm").style.display = 'inline';
			document.getElementById("RowEditForm").style.visibility = 'hidden';
			document.getElementById("RowChoiceForm").style.display = 'inline';
			document.getElementById("RowChoiceForm").style.visibility = 'hidden';
			document.getElementById("TableChoiceForm").style.display = 'inline';
			document.getElementById("TableChoiceForm").style.visibility = 'visible';
			return;
		}

	</script>
	
</head>
<body onload="DoInitSqlite3Module();" >
	<!-- BCG -->
	<svg width= 100% height= 100% style="position: fixed; top: 0; left: 0; z-index: -2;">
		<rect width="100%" height="100%" fill=#84FAA0 />
	</svg>

	<img src="Images/TR.png" style="position: fixed; top: 0; right: 0; z-index: -1;">
	<img src="Images/TL.png" style="position: fixed; top: 0; left: 0; z-index: -1;">
	<img src="Images/BR.png" style="position: fixed; bottom: 0; right: 0; z-index: -1;">
	<img src="Images/BL.png" style="position: fixed; bottom: 0; left: 0; z-index: -1;">

	<!-- SQLITE3 WASM module loading status -->
	<div id="LoadingWasmInfo" style="visibility: visible;">
		Loading libraries (SQLITE3 and TimyMCE) ...<br/>
	</div>
		
	<!-- Select database -->
	<div id="DatabasePathForm" style="visibility: hidden; text-align: center;">
		<img height= "100" src="Images/Icone.png">
		<br/>
		<br/>Slectionner la base de donne "PlanteVet.db" :
		<br/>
		<br/><input id="DatabasePathBtn" type="file" />
		<br/>
		<br/><input id="DatabaseImportBtn" type="button" value="Importer" onclick="DoImportDatabase();" class="Import" />
		<br/>	
		<br/>Les informations sont amenes  voluer avec le temps.
		<br/>
		<br/>Cette base de donnes a t cre dans le cadre d'une thse vtrinaire.	
		<div id="DatabaseImportProgress" style="visibility: hidden;">
			<progress max="100" value="0" id="DatabaseImportProgressBar"></progress>
			<span id="DatabaseImportProgressTxt">Progress State ...</span><br/>
		</div>
	</div>

	<!-- Select table to edit -->
	<div id="TableChoiceForm" style="visibility: hidden;">
		<span id="DatabasePath">No DB</span>
		<input type="button" value="Edit PRODUIT" id="EditPdtBtn" onclick="DoEditProductTable();" class="Product" />
		<br/><input type="button" value="Edit LABORATOIRE" onclick="DoEditLaboTable();" class="Product" />
		<br/><input type="button" value="Edit GALENIQUE" onclick="DoEditGaleniqueTable();" class="Product" />
		<br/><input type="button" value="Edit CATEGORIE" onclick="DoEditCategorieTable();" class="Product" />
		<br/>
		<br/>
		<br/><input type="button" value="Edit PLANTE" onclick="DoEditPlanteTable();" class="Plant" />
		<br/><input type="button" value="Edit PARTIE UTILISEE" onclick="DoEditUsePartTable();" class="Plant" />
		<br/>
		<br/>
		<br/><input type="button" value="Edit ESPECE" onclick="DoEditEspeceTable();" class="Species" />
		<br/>
		<br/>
		<br/><input type="button" value="Edit GRANDES FONCTIONS" onclick="DoEditFctsTable();" class="Fct" />
		<br/><input type="button" value="Edit UTILISATION" onclick="DoEditUsecaseTable();" class="Fct" />
		<br/>
		<br/>
		<br/><input type="button" value="Edit EFFET SECONDAIRE" onclick="DoEditEffet2Table();" class="Tox" />
		<br/><input type="button" value="Edit TOXICITE" onclick="DoEditToxiciteTable();" class="Tox" />
		<br/><input type="button" value="Edit CONTRE-INDICATION" onclick="DoEditCtrIndicTable();" class="Tox" />
		<br/>
		<br/>
		<br/><input type="button" value="SAVE DATABASE" onclick="DoExportDatabase();" id="SaveDBBtn" disabled="true" class="Save" />
		<br/>
	</div>

	<!-- Select Product/labo/usecase row to edit -->
	<div id="RowChoiceForm" style="visibility: hidden;">
		Empty form
	</div>
	
	<!-- Edit selected table row -->
	<div id="RowEditForm" style="visibility: hidden;">
		Empty form
	</div>
	
</body>
</html>





































































